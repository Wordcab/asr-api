
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="💬 ASR FastAPI server using faster-whisper and Multi-Scale Auto-Tuning Spectral Clustering for diarization.">
      
      
        <meta name="author" content="Wordcab">
      
      
        <link rel="canonical" href="https://github.com/Wordcab/wordcab-transcribe/reference/services/">
      
      
        <link rel="prev" href="../config/">
      
      
        <link rel="next" href="../schemas/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.5">
    
    
      
        <title>Services - Wordcab Transcribe</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6a10b989.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/timeago.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="amber">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Wordcab Transcribe" class="md-header__button md-logo" aria-label="Wordcab Transcribe" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 7a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2 2 2 0 0 1-2-2V9a2 2 0 0 1 2-2m6 7c0 2.97-2.16 5.44-5 5.92V22H7v-2.08c-2.84-.48-5-2.95-5-5.92h2a4 4 0 0 0 4 4 4 4 0 0 0 4-4h2m7.41-4.59-4.24 4.25L18.18 10H14a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v4c0 .55-.22 1.05-.59 1.41Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Wordcab Transcribe
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Services
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Wordcab/wordcab-transcribe" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Wordcab/wordcab-transcribe
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Wordcab Transcribe" class="md-nav__button md-logo" aria-label="Wordcab Transcribe" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 7a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2 2 2 0 0 1-2-2V9a2 2 0 0 1 2-2m6 7c0 2.97-2.16 5.44-5 5.92V22H7v-2.08c-2.84-.48-5-2.95-5-5.92h2a4 4 0 0 0 4 4 4 4 0 0 0 4-4h2m7.41-4.59-4.24 4.25L18.18 10H14a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v4c0 .55-.22 1.05-.59 1.41Z"/></svg>

    </a>
    Wordcab Transcribe
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Wordcab/wordcab-transcribe" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Wordcab/wordcab-transcribe
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    👋 Getting Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    📖 Usage
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            📖 Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/env/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ENV variables
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/asr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ASR Engines
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/launch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    📚 Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            📚 Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Services
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Services
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService" class="md-nav__link">
    ASRAsyncService
  </a>
  
    <nav class="md-nav" aria-label="ASRAsyncService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.add_url" class="md-nav__link">
    add_url()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.create_diarization_local_service" class="md-nav__link">
    create_diarization_local_service()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.create_local_service" class="md-nav__link">
    create_local_service()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.create_transcription_local_service" class="md-nav__link">
    create_transcription_local_service()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.get_url" class="md-nav__link">
    get_url()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.inference_warmup" class="md-nav__link">
    inference_warmup()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.process_diarization" class="md-nav__link">
    process_diarization()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.process_input" class="md-nav__link">
    process_input()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.process_post_processing" class="md-nav__link">
    process_post_processing()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.process_transcription" class="md-nav__link">
    process_transcription()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.remote_diarization" class="md-nav__link">
    remote_diarization()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.remote_transcription" class="md-nav__link">
    remote_transcription()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.remove_url" class="md-nav__link">
    remove_url()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRDiarizationOnly" class="md-nav__link">
    ASRDiarizationOnly
  </a>
  
    <nav class="md-nav" aria-label="ASRDiarizationOnly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRDiarizationOnly.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRDiarizationOnly.inference_warmup" class="md-nav__link">
    inference_warmup()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRDiarizationOnly.process_input" class="md-nav__link">
    process_input()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRLiveService" class="md-nav__link">
    ASRLiveService
  </a>
  
    <nav class="md-nav" aria-label="ASRLiveService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRLiveService.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRLiveService.inference_warmup" class="md-nav__link">
    inference_warmup()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRLiveService.process_input" class="md-nav__link">
    process_input()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRService" class="md-nav__link">
    ASRService
  </a>
  
    <nav class="md-nav" aria-label="ASRService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRService.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRService.process_input" class="md-nav__link">
    process_input()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRTask" class="md-nav__link">
    ASRTask
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRTranscriptionOnly" class="md-nav__link">
    ASRTranscriptionOnly
  </a>
  
    <nav class="md-nav" aria-label="ASRTranscriptionOnly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRTranscriptionOnly.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRTranscriptionOnly.inference_warmup" class="md-nav__link">
    inference_warmup()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRTranscriptionOnly.process_input" class="md-nav__link">
    process_input()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.DiarizationTask" class="md-nav__link">
    DiarizationTask
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ExceptionSource" class="md-nav__link">
    ExceptionSource
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.LocalExecution" class="md-nav__link">
    LocalExecution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.LocalServiceRegistry" class="md-nav__link">
    LocalServiceRegistry
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.PostProcessingTask" class="md-nav__link">
    PostProcessingTask
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ProcessException" class="md-nav__link">
    ProcessException
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.RemoteExecution" class="md-nav__link">
    RemoteExecution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.RemoteServiceConfig" class="md-nav__link">
    RemoteServiceConfig
  </a>
  
    <nav class="md-nav" aria-label="RemoteServiceConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.RemoteServiceConfig.add_url" class="md-nav__link">
    add_url()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.RemoteServiceConfig.get_queue_size" class="md-nav__link">
    get_queue_size()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.RemoteServiceConfig.get_urls" class="md-nav__link">
    get_urls()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.RemoteServiceConfig.next_url" class="md-nav__link">
    next_url()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.RemoteServiceConfig.remove_url" class="md-nav__link">
    remove_url()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.RemoteServiceRegistry" class="md-nav__link">
    RemoteServiceRegistry
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.TranscriptionOptions" class="md-nav__link">
    TranscriptionOptions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.TranscriptionTask" class="md-nav__link">
    TranscriptionTask
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.GPUService" class="md-nav__link">
    GPUService
  </a>
  
    <nav class="md-nav" aria-label="GPUService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.GPUService.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.GPUService.get_device" class="md-nav__link">
    get_device()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.GPUService.release_device" class="md-nav__link">
    release_device()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.URLService" class="md-nav__link">
    URLService
  </a>
  
    <nav class="md-nav" aria-label="URLService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.URLService.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.URLService.add_url" class="md-nav__link">
    add_url()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.URLService.get_queue_size" class="md-nav__link">
    get_queue_size()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.URLService.get_urls" class="md-nav__link">
    get_urls()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.URLService.next_url" class="md-nav__link">
    next_url()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.URLService.remove_url" class="md-nav__link">
    remove_url()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.diarization.diarize_service.DiarizationModels" class="md-nav__link">
    DiarizationModels
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.diarization.diarize_service.DiarizeService" class="md-nav__link">
    DiarizeService
  </a>
  
    <nav class="md-nav" aria-label="DiarizeService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.diarization.diarize_service.DiarizeService.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.diarization.diarize_service.DiarizeService.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.diarization.diarize_service.DiarizeService.get_contiguous_stamps" class="md-nav__link">
    get_contiguous_stamps()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.diarization.diarize_service.DiarizeService.merge_stamps" class="md-nav__link">
    merge_stamps()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.post_processing_service.PostProcessingService" class="md-nav__link">
    PostProcessingService
  </a>
  
    <nav class="md-nav" aria-label="PostProcessingService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.post_processing_service.PostProcessingService.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.post_processing_service.PostProcessingService.final_processing_before_returning" class="md-nav__link">
    final_processing_before_returning()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.post_processing_service.PostProcessingService.multi_channel_speaker_mapping" class="md-nav__link">
    multi_channel_speaker_mapping()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.post_processing_service.PostProcessingService.reconstruct_multi_channel_utterances" class="md-nav__link">
    reconstruct_multi_channel_utterances()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.post_processing_service.PostProcessingService.reconstruct_utterances" class="md-nav__link">
    reconstruct_utterances()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.post_processing_service.PostProcessingService.segments_speaker_mapping" class="md-nav__link">
    segments_speaker_mapping()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.post_processing_service.PostProcessingService.single_channel_speaker_mapping" class="md-nav__link">
    single_channel_speaker_mapping()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.transcribe_service.FasterWhisperModel" class="md-nav__link">
    FasterWhisperModel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.transcribe_service.TranscribeService" class="md-nav__link">
    TranscribeService
  </a>
  
    <nav class="md-nav" aria-label="TranscribeService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.transcribe_service.TranscribeService.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.transcribe_service.TranscribeService.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.transcribe_service.TranscribeService.async_live_transcribe" class="md-nav__link">
    async_live_transcribe()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.transcribe_service.TranscribeService.live_transcribe" class="md-nav__link">
    live_transcribe()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.transcribe_service.TranscribeService.multi_channel" class="md-nav__link">
    multi_channel()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.vad_service.VadService" class="md-nav__link">
    VadService
  </a>
  
    <nav class="md-nav" aria-label="VadService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.vad_service.VadService.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.vad_service.VadService.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.vad_service.VadService.group_timestamps" class="md-nav__link">
    group_timestamps()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.vad_service.VadService.save_audio" class="md-nav__link">
    save_audio()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../schemas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Schemas
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🚀 Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../license/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    📝 License
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService" class="md-nav__link">
    ASRAsyncService
  </a>
  
    <nav class="md-nav" aria-label="ASRAsyncService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.add_url" class="md-nav__link">
    add_url()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.create_diarization_local_service" class="md-nav__link">
    create_diarization_local_service()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.create_local_service" class="md-nav__link">
    create_local_service()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.create_transcription_local_service" class="md-nav__link">
    create_transcription_local_service()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.get_url" class="md-nav__link">
    get_url()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.inference_warmup" class="md-nav__link">
    inference_warmup()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.process_diarization" class="md-nav__link">
    process_diarization()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.process_input" class="md-nav__link">
    process_input()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.process_post_processing" class="md-nav__link">
    process_post_processing()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.process_transcription" class="md-nav__link">
    process_transcription()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.remote_diarization" class="md-nav__link">
    remote_diarization()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.remote_transcription" class="md-nav__link">
    remote_transcription()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRAsyncService.remove_url" class="md-nav__link">
    remove_url()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRDiarizationOnly" class="md-nav__link">
    ASRDiarizationOnly
  </a>
  
    <nav class="md-nav" aria-label="ASRDiarizationOnly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRDiarizationOnly.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRDiarizationOnly.inference_warmup" class="md-nav__link">
    inference_warmup()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRDiarizationOnly.process_input" class="md-nav__link">
    process_input()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRLiveService" class="md-nav__link">
    ASRLiveService
  </a>
  
    <nav class="md-nav" aria-label="ASRLiveService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRLiveService.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRLiveService.inference_warmup" class="md-nav__link">
    inference_warmup()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRLiveService.process_input" class="md-nav__link">
    process_input()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRService" class="md-nav__link">
    ASRService
  </a>
  
    <nav class="md-nav" aria-label="ASRService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRService.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRService.process_input" class="md-nav__link">
    process_input()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRTask" class="md-nav__link">
    ASRTask
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRTranscriptionOnly" class="md-nav__link">
    ASRTranscriptionOnly
  </a>
  
    <nav class="md-nav" aria-label="ASRTranscriptionOnly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRTranscriptionOnly.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRTranscriptionOnly.inference_warmup" class="md-nav__link">
    inference_warmup()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ASRTranscriptionOnly.process_input" class="md-nav__link">
    process_input()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.DiarizationTask" class="md-nav__link">
    DiarizationTask
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ExceptionSource" class="md-nav__link">
    ExceptionSource
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.LocalExecution" class="md-nav__link">
    LocalExecution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.LocalServiceRegistry" class="md-nav__link">
    LocalServiceRegistry
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.PostProcessingTask" class="md-nav__link">
    PostProcessingTask
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.ProcessException" class="md-nav__link">
    ProcessException
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.RemoteExecution" class="md-nav__link">
    RemoteExecution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.RemoteServiceConfig" class="md-nav__link">
    RemoteServiceConfig
  </a>
  
    <nav class="md-nav" aria-label="RemoteServiceConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.RemoteServiceConfig.add_url" class="md-nav__link">
    add_url()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.RemoteServiceConfig.get_queue_size" class="md-nav__link">
    get_queue_size()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.RemoteServiceConfig.get_urls" class="md-nav__link">
    get_urls()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.RemoteServiceConfig.next_url" class="md-nav__link">
    next_url()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.RemoteServiceConfig.remove_url" class="md-nav__link">
    remove_url()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.RemoteServiceRegistry" class="md-nav__link">
    RemoteServiceRegistry
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.TranscriptionOptions" class="md-nav__link">
    TranscriptionOptions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.asr_service.TranscriptionTask" class="md-nav__link">
    TranscriptionTask
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.GPUService" class="md-nav__link">
    GPUService
  </a>
  
    <nav class="md-nav" aria-label="GPUService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.GPUService.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.GPUService.get_device" class="md-nav__link">
    get_device()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.GPUService.release_device" class="md-nav__link">
    release_device()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.URLService" class="md-nav__link">
    URLService
  </a>
  
    <nav class="md-nav" aria-label="URLService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.URLService.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.URLService.add_url" class="md-nav__link">
    add_url()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.URLService.get_queue_size" class="md-nav__link">
    get_queue_size()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.URLService.get_urls" class="md-nav__link">
    get_urls()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.URLService.next_url" class="md-nav__link">
    next_url()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.concurrency_services.URLService.remove_url" class="md-nav__link">
    remove_url()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.diarization.diarize_service.DiarizationModels" class="md-nav__link">
    DiarizationModels
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.diarization.diarize_service.DiarizeService" class="md-nav__link">
    DiarizeService
  </a>
  
    <nav class="md-nav" aria-label="DiarizeService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.diarization.diarize_service.DiarizeService.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.diarization.diarize_service.DiarizeService.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.diarization.diarize_service.DiarizeService.get_contiguous_stamps" class="md-nav__link">
    get_contiguous_stamps()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.diarization.diarize_service.DiarizeService.merge_stamps" class="md-nav__link">
    merge_stamps()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.post_processing_service.PostProcessingService" class="md-nav__link">
    PostProcessingService
  </a>
  
    <nav class="md-nav" aria-label="PostProcessingService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.post_processing_service.PostProcessingService.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.post_processing_service.PostProcessingService.final_processing_before_returning" class="md-nav__link">
    final_processing_before_returning()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.post_processing_service.PostProcessingService.multi_channel_speaker_mapping" class="md-nav__link">
    multi_channel_speaker_mapping()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.post_processing_service.PostProcessingService.reconstruct_multi_channel_utterances" class="md-nav__link">
    reconstruct_multi_channel_utterances()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.post_processing_service.PostProcessingService.reconstruct_utterances" class="md-nav__link">
    reconstruct_utterances()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.post_processing_service.PostProcessingService.segments_speaker_mapping" class="md-nav__link">
    segments_speaker_mapping()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.post_processing_service.PostProcessingService.single_channel_speaker_mapping" class="md-nav__link">
    single_channel_speaker_mapping()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.transcribe_service.FasterWhisperModel" class="md-nav__link">
    FasterWhisperModel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.transcribe_service.TranscribeService" class="md-nav__link">
    TranscribeService
  </a>
  
    <nav class="md-nav" aria-label="TranscribeService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.transcribe_service.TranscribeService.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.transcribe_service.TranscribeService.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.transcribe_service.TranscribeService.async_live_transcribe" class="md-nav__link">
    async_live_transcribe()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.transcribe_service.TranscribeService.live_transcribe" class="md-nav__link">
    live_transcribe()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.transcribe_service.TranscribeService.multi_channel" class="md-nav__link">
    multi_channel()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.vad_service.VadService" class="md-nav__link">
    VadService
  </a>
  
    <nav class="md-nav" aria-label="VadService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.vad_service.VadService.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.vad_service.VadService.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.vad_service.VadService.group_timestamps" class="md-nav__link">
    group_timestamps()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.wordcab_transcribe.services.vad_service.VadService.save_audio" class="md-nav__link">
    save_audio()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Services</h1>

<div class="doc doc-object doc-module">




  <div class="doc doc-contents first">
  
      <p>ASR Service module that handle all AI interactions.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.asr_service.ASRAsyncService" class="doc doc-heading">
          <code>ASRAsyncService</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="src.wordcab_transcribe.services.asr_service.ASRService" href="#src.wordcab_transcribe.services.asr_service.ASRService">ASRService</a></code></p>

  
      <p>ASR Service module for async endpoints.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="k">class</span> <span class="nc">ASRAsyncService</span><span class="p">(</span><span class="n">ASRService</span><span class="p">):</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;ASR Service module for async endpoints.&quot;&quot;&quot;</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="n">whisper_model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="n">compute_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="n">window_lengths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="n">shift_lengths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="n">multiscale_weights</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="n">extra_languages</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="n">extra_languages_model_paths</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="n">transcribe_server_urls</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="n">diarize_server_urls</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        Initialize the ASRAsyncService class.</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">            whisper_model (str):</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">                The path to the whisper model.</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">            compute_type (str):</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">                The compute type to use for inference.</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">            window_lengths (List[float]):</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">                The window lengths to use for diarization.</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">            shift_lengths (List[float]):</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">                The shift lengths to use for diarization.</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">            multiscale_weights (List[float]):</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">                The multiscale weights to use for diarization.</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">            extra_languages (Union[List[str], None]):</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">                The list of extra languages to support.</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">            extra_languages_model_paths (Union[List[str], None]):</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">                The list of paths to the extra language models.</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">            use_remote_servers (bool):</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">                Whether to use remote servers for transcription and diarization.</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">            transcribe_server_urls (Union[List[str], None]):</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">                The list of URLs to the remote transcription servers.</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">            diarize_server_urls (Union[List[str], None]):</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">                The list of URLs to the remote diarization servers.</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">            debug_mode (bool):</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">                Whether to run in debug mode.</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">whisper_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">whisper_model</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">compute_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">compute_type</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">window_lengths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">window_lengths</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">shift_lengths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">shift_lengths</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">multiscale_weights</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">multiscale_weights</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">extra_languages</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">extra_languages</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">extra_languages_model_paths</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>            <span class="n">extra_languages_model_paths</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="p">:</span> <span class="n">LocalServiceRegistry</span> <span class="o">=</span> <span class="n">LocalServiceRegistry</span><span class="p">()</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="p">:</span> <span class="n">RemoteServiceRegistry</span> <span class="o">=</span> <span class="n">RemoteServiceRegistry</span><span class="p">()</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dual_channel_transcribe_options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>            <span class="s2">&quot;beam_size&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>            <span class="s2">&quot;patience&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>            <span class="s2">&quot;length_penalty&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="s2">&quot;suppress_blank&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>            <span class="s2">&quot;word_timestamps&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>            <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="p">}</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="k">if</span> <span class="n">transcribe_server_urls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>                <span class="s2">&quot;You provided URLs for remote transcription server, no local model will&quot;</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                <span class="s2">&quot; be used.&quot;</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>            <span class="p">)</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="o">.</span><span class="n">transcription</span> <span class="o">=</span> <span class="n">RemoteServiceConfig</span><span class="p">(</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>                <span class="n">use_remote</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>                <span class="n">url_handler</span><span class="o">=</span><span class="n">URLService</span><span class="p">(</span><span class="n">remote_urls</span><span class="o">=</span><span class="n">transcribe_server_urls</span><span class="p">),</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="p">)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>                <span class="s2">&quot;You did not provide URLs for remote transcription server, local model&quot;</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>                <span class="s2">&quot; will be used.&quot;</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="p">)</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">create_transcription_local_service</span><span class="p">()</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="k">if</span> <span class="n">diarize_server_urls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>                <span class="s2">&quot;You provided URLs for remote diarization server, no local model will&quot;</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>                <span class="s2">&quot; be used.&quot;</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>            <span class="p">)</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="o">.</span><span class="n">diarization</span> <span class="o">=</span> <span class="n">RemoteServiceConfig</span><span class="p">(</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>                <span class="n">use_remote</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>                <span class="n">url_handler</span><span class="o">=</span><span class="n">URLService</span><span class="p">(</span><span class="n">remote_urls</span><span class="o">=</span><span class="n">diarize_server_urls</span><span class="p">),</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="p">)</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>                <span class="s2">&quot;You did not provide URLs for remote diarization server, local model&quot;</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>                <span class="s2">&quot; will be used.&quot;</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>            <span class="p">)</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">create_diarization_local_service</span><span class="p">()</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span> <span class="o">=</span> <span class="n">debug_mode</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>    <span class="k">def</span> <span class="nf">create_transcription_local_service</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a local transcription service.&quot;&quot;&quot;</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="o">.</span><span class="n">transcription</span> <span class="o">=</span> <span class="n">TranscribeService</span><span class="p">(</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="n">model_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">whisper_model</span><span class="p">,</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>            <span class="n">compute_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compute_type</span><span class="p">,</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>            <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>            <span class="n">device_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_index</span><span class="p">,</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>            <span class="n">extra_languages</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">extra_languages</span><span class="p">,</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>            <span class="n">extra_languages_model_paths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">extra_languages_model_paths</span><span class="p">,</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="p">)</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>    <span class="k">def</span> <span class="nf">create_diarization_local_service</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a local diarization service.&quot;&quot;&quot;</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="o">.</span><span class="n">diarization</span> <span class="o">=</span> <span class="n">DiarizeService</span><span class="p">(</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>            <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>            <span class="n">device_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_index</span><span class="p">,</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>            <span class="n">window_lengths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_lengths</span><span class="p">,</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>            <span class="n">shift_lengths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shift_lengths</span><span class="p">,</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>            <span class="n">multiscale_weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">multiscale_weights</span><span class="p">,</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="p">)</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>    <span class="k">def</span> <span class="nf">create_local_service</span><span class="p">(</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;transcription&quot;</span><span class="p">,</span> <span class="s2">&quot;diarization&quot;</span><span class="p">]</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a local service.&quot;&quot;&quot;</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="k">if</span> <span class="n">task</span> <span class="o">==</span> <span class="s2">&quot;transcription&quot;</span><span class="p">:</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">create_transcription_local_service</span><span class="p">()</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="k">elif</span> <span class="n">task</span> <span class="o">==</span> <span class="s2">&quot;diarization&quot;</span><span class="p">:</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">create_diarization_local_service</span><span class="p">()</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;No task specified.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">inference_warmup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Warmup the GPU by loading the models.&quot;&quot;&quot;</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="n">sample_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;assets/warmup_sample.wav&quot;</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="k">for</span> <span class="n">gpu_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">device_index</span><span class="p">:</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warmup GPU </span><span class="si">{</span><span class="n">gpu_index</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_input</span><span class="p">(</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>                <span class="n">filepath</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">sample_path</span><span class="p">),</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>                <span class="n">offset_start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>                <span class="n">offset_end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>                <span class="n">num_speakers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>                <span class="n">diarization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>                <span class="n">multi_channel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                <span class="n">source_lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                <span class="n">timestamps_format</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                <span class="n">vocab</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                <span class="n">word_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                <span class="n">internal_vad</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>                <span class="n">repetition_penalty</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>                <span class="n">compression_ratio_threshold</span><span class="o">=</span><span class="mf">2.4</span><span class="p">,</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>                <span class="n">log_prob_threshold</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>                <span class="n">no_speech_threshold</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>                <span class="n">condition_on_previous_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>            <span class="p">)</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_input</span><span class="p">(</span>  <span class="c1"># noqa: C901</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>        <span class="n">filepath</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>        <span class="n">offset_start</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="n">offset_end</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>        <span class="n">num_speakers</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>        <span class="n">diarization</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span class="n">multi_channel</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="n">source_lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="n">timestamps_format</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="n">vocab</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="n">word_timestamps</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="n">internal_vad</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>        <span class="n">repetition_penalty</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>        <span class="n">compression_ratio_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="n">log_prob_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="n">no_speech_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="n">condition_on_previous_text</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">ProcessTimes</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="ne">Exception</span><span class="p">]:</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the input request and return the results.</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">        This method will create a task and add it to the appropriate queues.</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">        All tasks are added to the transcription queue, but will be added to the</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">        diarization queues only if the user requested it.</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">        Each step will be processed asynchronously and the results will be returned</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">        and stored in separated keys in the task dictionary.</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">            filepath (Union[str, List[str]]):</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">                Path to the audio file or list of paths to the audio files to process.</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">            offset_start (Union[float, None]):</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">                The start time of the audio file to process.</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">            offset_end (Union[float, None]):</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">                The end time of the audio file to process.</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">            num_speakers (int):</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">                The number of oracle speakers.</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">            diarization (bool):</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">                Whether to do diarization or not.</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">            multi_channel (bool):</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">                Whether to do multi-channel diarization or not.</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="sd">            source_lang (str):</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">                Source language of the audio file.</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">            timestamps_format (str):</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">                Timestamps format to use.</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">            vocab (Union[List[str], None]):</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="sd">                List of words to use for the vocabulary.</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="sd">            word_timestamps (bool):</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">                Whether to return word timestamps or not.</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="sd">            internal_vad (bool):</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">                Whether to use faster-whisper&#39;s VAD or not.</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">            repetition_penalty (float):</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">                The repetition penalty to use for the beam search.</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">            compression_ratio_threshold (float):</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">                If the gzip compression ratio is above this value, treat as failed.</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">            log_prob_threshold (float):</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="sd">                If the average log probability over sampled tokens is below this value, treat as failed.</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">            no_speech_threshold (float):</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">                If the no_speech probability is higher than this value AND the average log probability</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">                over sampled tokens is below `log_prob_threshold`, consider the segment as silent.</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">            condition_on_previous_text (bool):</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">                If True, the previous output of the model is provided as a prompt for the next window;</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">                disabling may make the text inconsistent across windows, but the model becomes less prone</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">                to getting stuck in a failure loop, such as repetition looping or timestamps going out of sync.</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">            Union[Tuple[List[dict], ProcessTimes, float], Exception]:</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">                The results of the ASR pipeline or an exception if something went wrong.</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">                Results are returned as a tuple of the following:</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">                    * List[dict]: The final results of the ASR pipeline.</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">                    * ProcessTimes: The process times of each step of the ASR pipeline.</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">                    * float: The audio duration</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>            <span class="n">audio</span><span class="p">,</span> <span class="n">durations</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>                <span class="n">_audio</span><span class="p">,</span> <span class="n">_duration</span> <span class="o">=</span> <span class="n">read_audio</span><span class="p">(</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>                    <span class="n">path</span><span class="p">,</span> <span class="n">offset_start</span><span class="o">=</span><span class="n">offset_start</span><span class="p">,</span> <span class="n">offset_end</span><span class="o">=</span><span class="n">offset_end</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>                <span class="p">)</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>                <span class="n">audio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_audio</span><span class="p">)</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>                <span class="n">durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_duration</span><span class="p">)</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>            <span class="n">duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>            <span class="n">audio</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">read_audio</span><span class="p">(</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>                <span class="n">filepath</span><span class="p">,</span> <span class="n">offset_start</span><span class="o">=</span><span class="n">offset_start</span><span class="p">,</span> <span class="n">offset_end</span><span class="o">=</span><span class="n">offset_end</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>            <span class="p">)</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>        <span class="n">gpu_index</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">use_remote</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>            <span class="n">_url</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">next_url</span><span class="p">()</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>            <span class="n">transcription_execution</span> <span class="o">=</span> <span class="n">RemoteExecution</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">_url</span><span class="p">)</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>            <span class="n">gpu_index</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">get_device</span><span class="p">()</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>            <span class="n">transcription_execution</span> <span class="o">=</span> <span class="n">LocalExecution</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">gpu_index</span><span class="p">)</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="k">if</span> <span class="n">diarization</span> <span class="ow">and</span> <span class="n">multi_channel</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">use_remote</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>                <span class="n">_url</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">next_url</span><span class="p">()</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>                <span class="n">diarization_execution</span> <span class="o">=</span> <span class="n">RemoteExecution</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">_url</span><span class="p">)</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>                <span class="k">if</span> <span class="n">gpu_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>                    <span class="n">gpu_index</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">get_device</span><span class="p">()</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>                <span class="n">diarization_execution</span> <span class="o">=</span> <span class="n">LocalExecution</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">gpu_index</span><span class="p">)</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>            <span class="n">diarization_execution</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="n">task</span> <span class="o">=</span> <span class="n">ASRTask</span><span class="p">(</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>            <span class="n">audio</span><span class="o">=</span><span class="n">audio</span><span class="p">,</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>            <span class="n">diarization</span><span class="o">=</span><span class="n">DiarizationTask</span><span class="p">(</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>                <span class="n">execution</span><span class="o">=</span><span class="n">diarization_execution</span><span class="p">,</span> <span class="n">num_speakers</span><span class="o">=</span><span class="n">num_speakers</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>            <span class="p">),</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>            <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>            <span class="n">multi_channel</span><span class="o">=</span><span class="n">multi_channel</span><span class="p">,</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>            <span class="n">offset_start</span><span class="o">=</span><span class="n">offset_start</span><span class="p">,</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>            <span class="n">post_processing</span><span class="o">=</span><span class="n">PostProcessingTask</span><span class="p">(),</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>            <span class="n">process_times</span><span class="o">=</span><span class="n">ProcessTimes</span><span class="p">(),</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>            <span class="n">timestamps_format</span><span class="o">=</span><span class="n">timestamps_format</span><span class="p">,</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>            <span class="n">transcription</span><span class="o">=</span><span class="n">TranscriptionTask</span><span class="p">(</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>                <span class="n">execution</span><span class="o">=</span><span class="n">transcription_execution</span><span class="p">,</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>                <span class="n">options</span><span class="o">=</span><span class="n">TranscriptionOptions</span><span class="p">(</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>                    <span class="n">compression_ratio_threshold</span><span class="o">=</span><span class="n">compression_ratio_threshold</span><span class="p">,</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>                    <span class="n">condition_on_previous_text</span><span class="o">=</span><span class="n">condition_on_previous_text</span><span class="p">,</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>                    <span class="n">internal_vad</span><span class="o">=</span><span class="n">internal_vad</span><span class="p">,</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>                    <span class="n">log_prob_threshold</span><span class="o">=</span><span class="n">log_prob_threshold</span><span class="p">,</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>                    <span class="n">no_speech_threshold</span><span class="o">=</span><span class="n">no_speech_threshold</span><span class="p">,</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>                    <span class="n">repetition_penalty</span><span class="o">=</span><span class="n">repetition_penalty</span><span class="p">,</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>                    <span class="n">source_lang</span><span class="o">=</span><span class="n">source_lang</span><span class="p">,</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>                    <span class="n">vocab</span><span class="o">=</span><span class="n">vocab</span><span class="p">,</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>                <span class="p">),</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>            <span class="p">),</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>            <span class="n">word_timestamps</span><span class="o">=</span><span class="n">word_timestamps</span><span class="p">,</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>        <span class="p">)</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>            <span class="n">start_process_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>            <span class="n">transcription_task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_transcription</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">)</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>            <span class="n">diarization_task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_diarization</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">)</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">transcription_task</span><span class="p">,</span> <span class="n">diarization_task</span><span class="p">)</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">ProcessException</span><span class="p">):</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>                <span class="k">return</span> <span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">result</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>            <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>                <span class="n">diarization</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>                <span class="ow">and</span> <span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>                <span class="ow">and</span> <span class="n">multi_channel</span> <span class="ow">is</span> <span class="kc">False</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>            <span class="p">):</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>                <span class="c1"># Empty audio early return</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>                <span class="k">return</span> <span class="n">early_return</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">)</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">ProcessException</span><span class="p">):</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>                <span class="k">return</span> <span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">result</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>                <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_post_processing</span><span class="p">,</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>                <span class="n">task</span><span class="p">,</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>            <span class="p">)</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">post_processing</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">ProcessException</span><span class="p">):</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>                <span class="k">return</span> <span class="n">task</span><span class="o">.</span><span class="n">post_processing</span><span class="o">.</span><span class="n">result</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>            <span class="n">task</span><span class="o">.</span><span class="n">process_times</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_process_time</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>            <span class="k">return</span> <span class="n">task</span><span class="o">.</span><span class="n">post_processing</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">process_times</span><span class="p">,</span> <span class="n">duration</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>            <span class="k">return</span> <span class="n">e</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>            <span class="k">del</span> <span class="n">task</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>            <span class="k">if</span> <span class="n">gpu_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">release_device</span><span class="p">(</span><span class="n">gpu_index</span><span class="p">)</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_transcription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">ASRTask</span><span class="p">,</span> <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">        Process a task of transcription and update the task with the result.</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">            task (ASRTask): The task and its parameters.</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">            debug_mode (bool): Whether to run in debug mode or not.</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">            None: The task is updated with the result.</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">execution</span><span class="p">,</span> <span class="n">LocalExecution</span><span class="p">):</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>                <span class="n">out</span> <span class="o">=</span> <span class="k">await</span> <span class="n">time_and_tell_async</span><span class="p">(</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>                    <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="o">.</span><span class="n">transcription</span><span class="p">(</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>                        <span class="n">task</span><span class="o">.</span><span class="n">audio</span><span class="p">,</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>                        <span class="n">model_index</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>                        <span class="n">suppress_blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>                        <span class="n">word_timestamps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>                        <span class="o">**</span><span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>                    <span class="p">),</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>                    <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;transcription&quot;</span><span class="p">,</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>                    <span class="n">debug_mode</span><span class="o">=</span><span class="n">debug_mode</span><span class="p">,</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>                <span class="p">)</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>                <span class="n">result</span><span class="p">,</span> <span class="n">process_time</span> <span class="o">=</span> <span class="n">out</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">execution</span><span class="p">,</span> <span class="n">RemoteExecution</span><span class="p">):</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">audio</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>                    <span class="n">ts</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>                        <span class="n">TensorShare</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s2">&quot;audio&quot;</span><span class="p">:</span> <span class="n">a</span><span class="p">},</span> <span class="n">backend</span><span class="o">=</span><span class="n">Backend</span><span class="o">.</span><span class="n">TORCH</span><span class="p">)</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>                        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">audio</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>                    <span class="p">]</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>                    <span class="n">ts</span> <span class="o">=</span> <span class="n">TensorShare</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>                        <span class="p">{</span><span class="s2">&quot;audio&quot;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">audio</span><span class="p">},</span> <span class="n">backend</span><span class="o">=</span><span class="n">Backend</span><span class="o">.</span><span class="n">TORCH</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>                    <span class="p">)</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">TranscribeRequest</span><span class="p">(</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>                    <span class="n">audio</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>                    <span class="o">**</span><span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>                <span class="p">)</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>                <span class="n">out</span> <span class="o">=</span> <span class="k">await</span> <span class="n">time_and_tell_async</span><span class="p">(</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">remote_transcription</span><span class="p">(</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>                        <span class="n">url</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>                        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>                    <span class="p">),</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>                    <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;transcription&quot;</span><span class="p">,</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>                    <span class="n">debug_mode</span><span class="o">=</span><span class="n">debug_mode</span><span class="p">,</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>                <span class="p">)</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>                <span class="n">result</span><span class="p">,</span> <span class="n">process_time</span> <span class="o">=</span> <span class="n">out</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;No execution method specified.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">ProcessException</span><span class="p">(</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>                <span class="n">source</span><span class="o">=</span><span class="n">ExceptionSource</span><span class="o">.</span><span class="n">transcription</span><span class="p">,</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error in transcription: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>            <span class="p">)</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>            <span class="n">process_time</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>            <span class="n">task</span><span class="o">.</span><span class="n">process_times</span><span class="o">.</span><span class="n">transcription</span> <span class="o">=</span> <span class="n">process_time</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>            <span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>        <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_diarization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">ASRTask</span><span class="p">,</span> <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a><span class="sd">        Process a task of diarization.</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a><span class="sd">            task (ASRTask): The task and its parameters.</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a><span class="sd">            debug_mode (bool): Whether to run in debug mode or not.</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a><span class="sd">            None: The task is updated with the result.</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">execution</span><span class="p">,</span> <span class="n">LocalExecution</span><span class="p">):</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>                <span class="n">out</span> <span class="o">=</span> <span class="k">await</span> <span class="n">time_and_tell_async</span><span class="p">(</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>                    <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="o">.</span><span class="n">diarization</span><span class="p">(</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>                        <span class="n">waveform</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">audio</span><span class="p">,</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>                        <span class="n">audio_duration</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>                        <span class="n">oracle_num_speakers</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">num_speakers</span><span class="p">,</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>                        <span class="n">model_index</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>                        <span class="n">vad_service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="o">.</span><span class="n">vad</span><span class="p">,</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>                    <span class="p">),</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>                    <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;diarization&quot;</span><span class="p">,</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>                    <span class="n">debug_mode</span><span class="o">=</span><span class="n">debug_mode</span><span class="p">,</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>                <span class="p">)</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>                <span class="n">result</span><span class="p">,</span> <span class="n">process_time</span> <span class="o">=</span> <span class="n">out</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">execution</span><span class="p">,</span> <span class="n">RemoteExecution</span><span class="p">):</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>                <span class="n">ts</span> <span class="o">=</span> <span class="n">TensorShare</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s2">&quot;audio&quot;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">audio</span><span class="p">},</span> <span class="n">backend</span><span class="o">=</span><span class="n">Backend</span><span class="o">.</span><span class="n">TORCH</span><span class="p">)</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">DiarizationRequest</span><span class="p">(</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>                    <span class="n">audio</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>                    <span class="n">duration</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>                    <span class="n">num_speakers</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">num_speakers</span><span class="p">,</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>                <span class="p">)</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>                <span class="n">out</span> <span class="o">=</span> <span class="k">await</span> <span class="n">time_and_tell_async</span><span class="p">(</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">remote_diarization</span><span class="p">(</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>                        <span class="n">url</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>                        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>                    <span class="p">),</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>                    <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;diarization&quot;</span><span class="p">,</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>                    <span class="n">debug_mode</span><span class="o">=</span><span class="n">debug_mode</span><span class="p">,</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>                <span class="p">)</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>                <span class="n">result</span><span class="p">,</span> <span class="n">process_time</span> <span class="o">=</span> <span class="n">out</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>            <span class="k">elif</span> <span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">execution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>                <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>                <span class="n">process_time</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;No execution method specified.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">ProcessException</span><span class="p">(</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>                <span class="n">source</span><span class="o">=</span><span class="n">ExceptionSource</span><span class="o">.</span><span class="n">diarization</span><span class="p">,</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error in diarization: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>            <span class="p">)</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>            <span class="n">process_time</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>            <span class="n">task</span><span class="o">.</span><span class="n">process_times</span><span class="o">.</span><span class="n">diarization</span> <span class="o">=</span> <span class="n">process_time</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>            <span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>        <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>    <span class="k">def</span> <span class="nf">process_post_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">ASRTask</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">        Process a task of post-processing.</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">            task (ASRTask): The task and its parameters.</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">            None: The task is updated with the result.</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>            <span class="n">total_post_process_time</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>            <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">multi_channel</span><span class="p">:</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>                <span class="n">utterances</span><span class="p">,</span> <span class="n">process_time</span> <span class="o">=</span> <span class="n">time_and_tell</span><span class="p">(</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="o">.</span><span class="n">post_processing</span><span class="o">.</span><span class="n">multi_channel_speaker_mapping</span><span class="p">(</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>                        <span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">result</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>                    <span class="p">),</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>                    <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;multi_channel_speaker_mapping&quot;</span><span class="p">,</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>                    <span class="n">debug_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">,</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>                <span class="p">)</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>                <span class="n">total_post_process_time</span> <span class="o">+=</span> <span class="n">process_time</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>                <span class="n">formatted_segments</span><span class="p">,</span> <span class="n">process_time</span> <span class="o">=</span> <span class="n">time_and_tell</span><span class="p">(</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>                    <span class="n">format_segments</span><span class="p">(</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>                        <span class="n">transcription_output</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">result</span><span class="p">,</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>                    <span class="p">),</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>                    <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;format_segments&quot;</span><span class="p">,</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>                    <span class="n">debug_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">,</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>                <span class="p">)</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>                <span class="n">total_post_process_time</span> <span class="o">+=</span> <span class="n">process_time</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>                <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">execution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>                    <span class="n">utterances</span><span class="p">,</span> <span class="n">process_time</span> <span class="o">=</span> <span class="n">time_and_tell</span><span class="p">(</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="o">.</span><span class="n">post_processing</span><span class="o">.</span><span class="n">single_channel_speaker_mapping</span><span class="p">(</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>                            <span class="n">transcript_segments</span><span class="o">=</span><span class="n">formatted_segments</span><span class="p">,</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>                            <span class="n">speaker_timestamps</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">result</span><span class="p">,</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>                            <span class="n">word_timestamps</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">word_timestamps</span><span class="p">,</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>                        <span class="p">),</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>                        <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;single_channel_speaker_mapping&quot;</span><span class="p">,</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>                        <span class="n">debug_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">,</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>                    <span class="p">)</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>                    <span class="n">total_post_process_time</span> <span class="o">+=</span> <span class="n">process_time</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>                    <span class="n">utterances</span> <span class="o">=</span> <span class="n">formatted_segments</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>            <span class="n">final_utterances</span><span class="p">,</span> <span class="n">process_time</span> <span class="o">=</span> <span class="n">time_and_tell</span><span class="p">(</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="o">.</span><span class="n">post_processing</span><span class="o">.</span><span class="n">final_processing_before_returning</span><span class="p">(</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>                    <span class="n">utterances</span><span class="o">=</span><span class="n">utterances</span><span class="p">,</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>                    <span class="n">offset_start</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">offset_start</span><span class="p">,</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>                    <span class="n">timestamps_format</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">timestamps_format</span><span class="p">,</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>                    <span class="n">word_timestamps</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">word_timestamps</span><span class="p">,</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>                <span class="p">),</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>                <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;final_processing_before_returning&quot;</span><span class="p">,</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>                <span class="n">debug_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">,</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>            <span class="p">)</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>            <span class="n">total_post_process_time</span> <span class="o">+=</span> <span class="n">process_time</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>            <span class="n">final_utterances</span> <span class="o">=</span> <span class="n">ProcessException</span><span class="p">(</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>                <span class="n">source</span><span class="o">=</span><span class="n">ExceptionSource</span><span class="o">.</span><span class="n">post_processing</span><span class="p">,</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error in post-processing: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>            <span class="p">)</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>            <span class="n">total_post_process_time</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>            <span class="n">task</span><span class="o">.</span><span class="n">process_times</span><span class="o">.</span><span class="n">post_processing</span> <span class="o">=</span> <span class="n">total_post_process_time</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>            <span class="n">task</span><span class="o">.</span><span class="n">post_processing</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">final_utterances</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>        <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">remote_transcription</span><span class="p">(</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>        <span class="n">data</span><span class="p">:</span> <span class="n">TranscribeRequest</span><span class="p">,</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TranscriptionOutput</span><span class="p">:</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remote transcription method.&quot;&quot;&quot;</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>        <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>                <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">/api/v1/transcribe&quot;</span><span class="p">,</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>                <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">(),</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>                <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>                    <span class="k">return</span> <span class="n">TranscriptionOutput</span><span class="p">(</span><span class="o">**</span><span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">remote_diarization</span><span class="p">(</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>        <span class="n">data</span><span class="p">:</span> <span class="n">DiarizationRequest</span><span class="p">,</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DiarizationOutput</span><span class="p">:</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remote diarization method.&quot;&quot;&quot;</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>        <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>            <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>                <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">/api/v1/diarize&quot;</span><span class="p">,</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>                <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">(),</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>                <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>                    <span class="n">r</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;detail&quot;</span><span class="p">])</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>                    <span class="k">return</span> <span class="n">DiarizationOutput</span><span class="p">(</span><span class="o">**</span><span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_url</span><span class="p">(</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;transcription&quot;</span><span class="p">,</span> <span class="s2">&quot;diarization&quot;</span><span class="p">]</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">ProcessException</span><span class="p">]:</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the list of remote URLs.&quot;&quot;&quot;</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="o">.</span><span class="n">transcription</span><span class="p">)</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="o">.</span><span class="n">diarization</span><span class="p">)</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>            <span class="n">selected_task</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">selected_task</span><span class="p">)</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>            <span class="c1"># Case 1: We are not using remote task</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>            <span class="k">if</span> <span class="n">selected_task</span><span class="o">.</span><span class="n">use_remote</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>                <span class="k">return</span> <span class="n">ProcessException</span><span class="p">(</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>                    <span class="n">source</span><span class="o">=</span><span class="n">ExceptionSource</span><span class="o">.</span><span class="n">get_url</span><span class="p">,</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;You are not using remote </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>                <span class="p">)</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>            <span class="c1"># Case 2: We are using remote task</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>                <span class="k">return</span> <span class="n">selected_task</span><span class="o">.</span><span class="n">get_urls</span><span class="p">()</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>            <span class="k">return</span> <span class="n">ProcessException</span><span class="p">(</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>                <span class="n">source</span><span class="o">=</span><span class="n">ExceptionSource</span><span class="o">.</span><span class="n">get_url</span><span class="p">,</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error in getting URL: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>            <span class="p">)</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">add_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">UrlSchema</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">UrlSchema</span><span class="p">,</span> <span class="n">ProcessException</span><span class="p">]:</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a remote URL to the list of URLs.&quot;&quot;&quot;</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>            <span class="n">selected_task</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">task</span><span class="p">)</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>            <span class="c1"># Case 1: We are not using remote task yet</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>            <span class="k">if</span> <span class="n">selected_task</span><span class="o">.</span><span class="n">use_remote</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>                <span class="nb">setattr</span><span class="p">(</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="p">,</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>                    <span class="n">data</span><span class="o">.</span><span class="n">task</span><span class="p">,</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>                    <span class="n">RemoteServiceConfig</span><span class="p">(</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>                        <span class="n">use_remote</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>                        <span class="n">url_handler</span><span class="o">=</span><span class="n">URLService</span><span class="p">(</span><span class="n">remote_urls</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">url</span><span class="p">)]),</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>                    <span class="p">),</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>                <span class="p">)</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">task</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>            <span class="c1"># Case 2: We are already using remote task</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>                <span class="k">await</span> <span class="n">selected_task</span><span class="o">.</span><span class="n">add_url</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">url</span><span class="p">))</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>            <span class="k">return</span> <span class="n">ProcessException</span><span class="p">(</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>                <span class="n">source</span><span class="o">=</span><span class="n">ExceptionSource</span><span class="o">.</span><span class="n">add_url</span><span class="p">,</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error in adding URL: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>            <span class="p">)</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>        <span class="k">return</span> <span class="n">data</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">remove_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">UrlSchema</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">UrlSchema</span><span class="p">,</span> <span class="n">ProcessException</span><span class="p">]:</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a remote URL from the list of URLs.&quot;&quot;&quot;</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>            <span class="n">selected_task</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">task</span><span class="p">)</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>            <span class="c1"># Case 1: We are not using remote task</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>            <span class="k">if</span> <span class="n">selected_task</span><span class="o">.</span><span class="n">use_remote</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You are not using remote </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">task</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>            <span class="c1"># Case 2: We are using remote task</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>                <span class="k">await</span> <span class="n">selected_task</span><span class="o">.</span><span class="n">remove_url</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">url</span><span class="p">))</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>                <span class="k">if</span> <span class="n">selected_task</span><span class="o">.</span><span class="n">get_queue_size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>                    <span class="c1"># No more remote URLs, switch to local service</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">create_local_service</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">task</span><span class="p">)</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">task</span><span class="p">,</span> <span class="n">RemoteServiceConfig</span><span class="p">())</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>            <span class="k">return</span> <span class="n">data</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>            <span class="k">return</span> <span class="n">ProcessException</span><span class="p">(</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>                <span class="n">source</span><span class="o">=</span><span class="n">ExceptionSource</span><span class="o">.</span><span class="n">remove_url</span><span class="p">,</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error in removing URL: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRAsyncService.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">whisper_model</span><span class="p">,</span> <span class="n">compute_type</span><span class="p">,</span> <span class="n">window_lengths</span><span class="p">,</span> <span class="n">shift_lengths</span><span class="p">,</span> <span class="n">multiscale_weights</span><span class="p">,</span> <span class="n">extra_languages</span><span class="p">,</span> <span class="n">extra_languages_model_paths</span><span class="p">,</span> <span class="n">transcribe_server_urls</span><span class="p">,</span> <span class="n">diarize_server_urls</span><span class="p">,</span> <span class="n">debug_mode</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize the ASRAsyncService class.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>whisper_model</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to the whisper model.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>compute_type</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The compute type to use for inference.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>window_lengths</code></td>
          <td>
                <code><span title="typing.List">List</span>[float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The window lengths to use for diarization.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>shift_lengths</code></td>
          <td>
                <code><span title="typing.List">List</span>[float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The shift lengths to use for diarization.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>multiscale_weights</code></td>
          <td>
                <code><span title="typing.List">List</span>[float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The multiscale weights to use for diarization.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>extra_languages</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[str], None]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The list of extra languages to support.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>extra_languages_model_paths</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[str], None]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The list of paths to the extra language models.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>use_remote_servers</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to use remote servers for transcription and diarization.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>transcribe_server_urls</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[str], None]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The list of URLs to the remote transcription servers.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>diarize_server_urls</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[str], None]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The list of URLs to the remote diarization servers.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>debug_mode</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to run in debug mode.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="n">whisper_model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="n">compute_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="n">window_lengths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="n">shift_lengths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="n">multiscale_weights</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="n">extra_languages</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>    <span class="n">extra_languages_model_paths</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="n">transcribe_server_urls</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>    <span class="n">diarize_server_urls</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    Initialize the ASRAsyncService class.</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">        whisper_model (str):</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">            The path to the whisper model.</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">        compute_type (str):</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">            The compute type to use for inference.</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        window_lengths (List[float]):</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">            The window lengths to use for diarization.</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">        shift_lengths (List[float]):</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">            The shift lengths to use for diarization.</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">        multiscale_weights (List[float]):</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">            The multiscale weights to use for diarization.</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">        extra_languages (Union[List[str], None]):</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">            The list of extra languages to support.</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">        extra_languages_model_paths (Union[List[str], None]):</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">            The list of paths to the extra language models.</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">        use_remote_servers (bool):</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">            Whether to use remote servers for transcription and diarization.</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">        transcribe_server_urls (Union[List[str], None]):</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">            The list of URLs to the remote transcription servers.</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">        diarize_server_urls (Union[List[str], None]):</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">            The list of URLs to the remote diarization servers.</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">        debug_mode (bool):</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">            Whether to run in debug mode.</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">whisper_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">whisper_model</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">compute_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">compute_type</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">window_lengths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">window_lengths</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">shift_lengths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">shift_lengths</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">multiscale_weights</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">multiscale_weights</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">extra_languages</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">extra_languages</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">extra_languages_model_paths</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="n">extra_languages_model_paths</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="p">:</span> <span class="n">LocalServiceRegistry</span> <span class="o">=</span> <span class="n">LocalServiceRegistry</span><span class="p">()</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="p">:</span> <span class="n">RemoteServiceRegistry</span> <span class="o">=</span> <span class="n">RemoteServiceRegistry</span><span class="p">()</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">dual_channel_transcribe_options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="s2">&quot;beam_size&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="s2">&quot;patience&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="s2">&quot;length_penalty&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="s2">&quot;suppress_blank&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="s2">&quot;word_timestamps&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>        <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="p">}</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>    <span class="k">if</span> <span class="n">transcribe_server_urls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>            <span class="s2">&quot;You provided URLs for remote transcription server, no local model will&quot;</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>            <span class="s2">&quot; be used.&quot;</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="p">)</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="o">.</span><span class="n">transcription</span> <span class="o">=</span> <span class="n">RemoteServiceConfig</span><span class="p">(</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="n">use_remote</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="n">url_handler</span><span class="o">=</span><span class="n">URLService</span><span class="p">(</span><span class="n">remote_urls</span><span class="o">=</span><span class="n">transcribe_server_urls</span><span class="p">),</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="p">)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="s2">&quot;You did not provide URLs for remote transcription server, local model&quot;</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>            <span class="s2">&quot; will be used.&quot;</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="p">)</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_transcription_local_service</span><span class="p">()</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>    <span class="k">if</span> <span class="n">diarize_server_urls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>            <span class="s2">&quot;You provided URLs for remote diarization server, no local model will&quot;</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="s2">&quot; be used.&quot;</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="p">)</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="o">.</span><span class="n">diarization</span> <span class="o">=</span> <span class="n">RemoteServiceConfig</span><span class="p">(</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>            <span class="n">use_remote</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>            <span class="n">url_handler</span><span class="o">=</span><span class="n">URLService</span><span class="p">(</span><span class="n">remote_urls</span><span class="o">=</span><span class="n">diarize_server_urls</span><span class="p">),</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="p">)</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>            <span class="s2">&quot;You did not provide URLs for remote diarization server, local model&quot;</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>            <span class="s2">&quot; will be used.&quot;</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="p">)</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_diarization_local_service</span><span class="p">()</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span> <span class="o">=</span> <span class="n">debug_mode</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRAsyncService.add_url" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_url</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Add a remote URL to the list of URLs.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-816" name="__codelineno-0-816"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">add_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">UrlSchema</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">UrlSchema</span><span class="p">,</span> <span class="n">ProcessException</span><span class="p">]:</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a remote URL to the list of URLs.&quot;&quot;&quot;</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>        <span class="n">selected_task</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">task</span><span class="p">)</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>        <span class="c1"># Case 1: We are not using remote task yet</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>        <span class="k">if</span> <span class="n">selected_task</span><span class="o">.</span><span class="n">use_remote</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>            <span class="nb">setattr</span><span class="p">(</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="p">,</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>                <span class="n">data</span><span class="o">.</span><span class="n">task</span><span class="p">,</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>                <span class="n">RemoteServiceConfig</span><span class="p">(</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>                    <span class="n">use_remote</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>                    <span class="n">url_handler</span><span class="o">=</span><span class="n">URLService</span><span class="p">(</span><span class="n">remote_urls</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">url</span><span class="p">)]),</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>                <span class="p">),</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>            <span class="p">)</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">task</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>        <span class="c1"># Case 2: We are already using remote task</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>            <span class="k">await</span> <span class="n">selected_task</span><span class="o">.</span><span class="n">add_url</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">url</span><span class="p">))</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>        <span class="k">return</span> <span class="n">ProcessException</span><span class="p">(</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>            <span class="n">source</span><span class="o">=</span><span class="n">ExceptionSource</span><span class="o">.</span><span class="n">add_url</span><span class="p">,</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error in adding URL: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>        <span class="p">)</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRAsyncService.create_diarization_local_service" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">create_diarization_local_service</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Create a local diarization service.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="k">def</span> <span class="nf">create_diarization_local_service</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a local diarization service.&quot;&quot;&quot;</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="o">.</span><span class="n">diarization</span> <span class="o">=</span> <span class="n">DiarizeService</span><span class="p">(</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="n">device_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_index</span><span class="p">,</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="n">window_lengths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window_lengths</span><span class="p">,</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="n">shift_lengths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shift_lengths</span><span class="p">,</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="n">multiscale_weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">multiscale_weights</span><span class="p">,</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRAsyncService.create_local_service" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">create_local_service</span><span class="p">(</span><span class="n">task</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Create a local service.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="k">def</span> <span class="nf">create_local_service</span><span class="p">(</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;transcription&quot;</span><span class="p">,</span> <span class="s2">&quot;diarization&quot;</span><span class="p">]</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a local service.&quot;&quot;&quot;</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="k">if</span> <span class="n">task</span> <span class="o">==</span> <span class="s2">&quot;transcription&quot;</span><span class="p">:</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_transcription_local_service</span><span class="p">()</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="k">elif</span> <span class="n">task</span> <span class="o">==</span> <span class="s2">&quot;diarization&quot;</span><span class="p">:</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_diarization_local_service</span><span class="p">()</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;No task specified.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRAsyncService.create_transcription_local_service" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">create_transcription_local_service</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Create a local transcription service.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="k">def</span> <span class="nf">create_transcription_local_service</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a local transcription service.&quot;&quot;&quot;</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="o">.</span><span class="n">transcription</span> <span class="o">=</span> <span class="n">TranscribeService</span><span class="p">(</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="n">model_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">whisper_model</span><span class="p">,</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="n">compute_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compute_type</span><span class="p">,</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="n">device_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_index</span><span class="p">,</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="n">extra_languages</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">extra_languages</span><span class="p">,</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="n">extra_languages_model_paths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">extra_languages_model_paths</span><span class="p">,</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRAsyncService.get_url" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_url</span><span class="p">(</span><span class="n">task</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get the list of remote URLs.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-791" name="__codelineno-0-791"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">get_url</span><span class="p">(</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;transcription&quot;</span><span class="p">,</span> <span class="s2">&quot;diarization&quot;</span><span class="p">]</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">ProcessException</span><span class="p">]:</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the list of remote URLs.&quot;&quot;&quot;</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="o">.</span><span class="n">transcription</span><span class="p">)</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="o">.</span><span class="n">diarization</span><span class="p">)</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>        <span class="n">selected_task</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">selected_task</span><span class="p">)</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>        <span class="c1"># Case 1: We are not using remote task</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>        <span class="k">if</span> <span class="n">selected_task</span><span class="o">.</span><span class="n">use_remote</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>            <span class="k">return</span> <span class="n">ProcessException</span><span class="p">(</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>                <span class="n">source</span><span class="o">=</span><span class="n">ExceptionSource</span><span class="o">.</span><span class="n">get_url</span><span class="p">,</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;You are not using remote </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>            <span class="p">)</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>        <span class="c1"># Case 2: We are using remote task</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>            <span class="k">return</span> <span class="n">selected_task</span><span class="o">.</span><span class="n">get_urls</span><span class="p">()</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>        <span class="k">return</span> <span class="n">ProcessException</span><span class="p">(</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>            <span class="n">source</span><span class="o">=</span><span class="n">ExceptionSource</span><span class="o">.</span><span class="n">get_url</span><span class="p">,</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error in getting URL: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRAsyncService.inference_warmup" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">inference_warmup</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Warmup the GPU by loading the models.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">inference_warmup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Warmup the GPU by loading the models.&quot;&quot;&quot;</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="n">sample_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;assets/warmup_sample.wav&quot;</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>    <span class="k">for</span> <span class="n">gpu_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">device_index</span><span class="p">:</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warmup GPU </span><span class="si">{</span><span class="n">gpu_index</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_input</span><span class="p">(</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>            <span class="n">filepath</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">sample_path</span><span class="p">),</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>            <span class="n">offset_start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>            <span class="n">offset_end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>            <span class="n">num_speakers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="n">diarization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="n">multi_channel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="n">source_lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>            <span class="n">timestamps_format</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>            <span class="n">vocab</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="n">word_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="n">internal_vad</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>            <span class="n">repetition_penalty</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>            <span class="n">compression_ratio_threshold</span><span class="o">=</span><span class="mf">2.4</span><span class="p">,</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>            <span class="n">log_prob_threshold</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>            <span class="n">no_speech_threshold</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>            <span class="n">condition_on_previous_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRAsyncService.process_diarization" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">process_diarization</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">debug_mode</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Process a task of diarization.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>task</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="src.wordcab_transcribe.services.asr_service.ASRTask" href="#src.wordcab_transcribe.services.asr_service.ASRTask">ASRTask</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The task and its parameters.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>debug_mode</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to run in debug mode or not.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>None</code></td>          <td>
                <code>None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The task is updated with the result.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-620" name="__codelineno-0-620"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">process_diarization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">ASRTask</span><span class="p">,</span> <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a><span class="sd">    Process a task of diarization.</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a><span class="sd">        task (ASRTask): The task and its parameters.</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a><span class="sd">        debug_mode (bool): Whether to run in debug mode or not.</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a><span class="sd">        None: The task is updated with the result.</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">execution</span><span class="p">,</span> <span class="n">LocalExecution</span><span class="p">):</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>            <span class="n">out</span> <span class="o">=</span> <span class="k">await</span> <span class="n">time_and_tell_async</span><span class="p">(</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>                <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="o">.</span><span class="n">diarization</span><span class="p">(</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>                    <span class="n">waveform</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">audio</span><span class="p">,</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>                    <span class="n">audio_duration</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>                    <span class="n">oracle_num_speakers</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">num_speakers</span><span class="p">,</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>                    <span class="n">model_index</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>                    <span class="n">vad_service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="o">.</span><span class="n">vad</span><span class="p">,</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>                <span class="p">),</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>                <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;diarization&quot;</span><span class="p">,</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>                <span class="n">debug_mode</span><span class="o">=</span><span class="n">debug_mode</span><span class="p">,</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>            <span class="p">)</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>            <span class="n">result</span><span class="p">,</span> <span class="n">process_time</span> <span class="o">=</span> <span class="n">out</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">execution</span><span class="p">,</span> <span class="n">RemoteExecution</span><span class="p">):</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>            <span class="n">ts</span> <span class="o">=</span> <span class="n">TensorShare</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s2">&quot;audio&quot;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">audio</span><span class="p">},</span> <span class="n">backend</span><span class="o">=</span><span class="n">Backend</span><span class="o">.</span><span class="n">TORCH</span><span class="p">)</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">DiarizationRequest</span><span class="p">(</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>                <span class="n">audio</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>                <span class="n">duration</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>                <span class="n">num_speakers</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">num_speakers</span><span class="p">,</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>            <span class="p">)</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>            <span class="n">out</span> <span class="o">=</span> <span class="k">await</span> <span class="n">time_and_tell_async</span><span class="p">(</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">remote_diarization</span><span class="p">(</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>                    <span class="n">url</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>                    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>                <span class="p">),</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>                <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;diarization&quot;</span><span class="p">,</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>                <span class="n">debug_mode</span><span class="o">=</span><span class="n">debug_mode</span><span class="p">,</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>            <span class="p">)</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>            <span class="n">result</span><span class="p">,</span> <span class="n">process_time</span> <span class="o">=</span> <span class="n">out</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>        <span class="k">elif</span> <span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">execution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>            <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>            <span class="n">process_time</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;No execution method specified.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">ProcessException</span><span class="p">(</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>            <span class="n">source</span><span class="o">=</span><span class="n">ExceptionSource</span><span class="o">.</span><span class="n">diarization</span><span class="p">,</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error in diarization: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>        <span class="p">)</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>        <span class="n">process_time</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>        <span class="n">task</span><span class="o">.</span><span class="n">process_times</span><span class="o">.</span><span class="n">diarization</span> <span class="o">=</span> <span class="n">process_time</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>        <span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRAsyncService.process_input" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">process_input</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">offset_start</span><span class="p">,</span> <span class="n">offset_end</span><span class="p">,</span> <span class="n">num_speakers</span><span class="p">,</span> <span class="n">diarization</span><span class="p">,</span> <span class="n">multi_channel</span><span class="p">,</span> <span class="n">source_lang</span><span class="p">,</span> <span class="n">timestamps_format</span><span class="p">,</span> <span class="n">vocab</span><span class="p">,</span> <span class="n">word_timestamps</span><span class="p">,</span> <span class="n">internal_vad</span><span class="p">,</span> <span class="n">repetition_penalty</span><span class="p">,</span> <span class="n">compression_ratio_threshold</span><span class="p">,</span> <span class="n">log_prob_threshold</span><span class="p">,</span> <span class="n">no_speech_threshold</span><span class="p">,</span> <span class="n">condition_on_previous_text</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Process the input request and return the results.</p>
<p>This method will create a task and add it to the appropriate queues.
All tasks are added to the transcription queue, but will be added to the
diarization queues only if the user requested it.
Each step will be processed asynchronously and the results will be returned
and stored in separated keys in the task dictionary.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>filepath</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[str, <span title="typing.List">List</span>[str]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Path to the audio file or list of paths to the audio files to process.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>offset_start</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[float, None]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The start time of the audio file to process.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>offset_end</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[float, None]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The end time of the audio file to process.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>num_speakers</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of oracle speakers.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>diarization</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to do diarization or not.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>multi_channel</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to do multi-channel diarization or not.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>source_lang</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Source language of the audio file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>timestamps_format</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Timestamps format to use.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>vocab</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[str], None]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of words to use for the vocabulary.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>word_timestamps</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to return word timestamps or not.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>internal_vad</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to use faster-whisper's VAD or not.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>repetition_penalty</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The repetition penalty to use for the beam search.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>compression_ratio_threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the gzip compression ratio is above this value, treat as failed.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>log_prob_threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the average log probability over sampled tokens is below this value, treat as failed.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>no_speech_threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the no_speech probability is higher than this value AND the average log probability
over sampled tokens is below <code>log_prob_threshold</code>, consider the segment as silent.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>condition_on_previous_text</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, the previous output of the model is provided as a prompt for the next window;
disabling may make the text inconsistent across windows, but the model becomes less prone
to getting stuck in a failure loop, such as repetition looping or timestamps going out of sync.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[dict], <span title="wordcab_transcribe.models.ProcessTimes">ProcessTimes</span>, float], Exception]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Union[Tuple[List[dict], ProcessTimes, float], Exception]:
The results of the ASR pipeline or an exception if something went wrong.
Results are returned as a tuple of the following:
    * List[dict]: The final results of the ASR pipeline.
    * ProcessTimes: The process times of each step of the ASR pipeline.
    * float: The audio duration</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">process_input</span><span class="p">(</span>  <span class="c1"># noqa: C901</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="n">filepath</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>    <span class="n">offset_start</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>    <span class="n">offset_end</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>    <span class="n">num_speakers</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>    <span class="n">diarization</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>    <span class="n">multi_channel</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>    <span class="n">source_lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>    <span class="n">timestamps_format</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>    <span class="n">vocab</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>    <span class="n">word_timestamps</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>    <span class="n">internal_vad</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>    <span class="n">repetition_penalty</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>    <span class="n">compression_ratio_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="n">log_prob_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>    <span class="n">no_speech_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>    <span class="n">condition_on_previous_text</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">ProcessTimes</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="ne">Exception</span><span class="p">]:</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Process the input request and return the results.</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">    This method will create a task and add it to the appropriate queues.</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">    All tasks are added to the transcription queue, but will be added to the</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">    diarization queues only if the user requested it.</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">    Each step will be processed asynchronously and the results will be returned</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">    and stored in separated keys in the task dictionary.</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">        filepath (Union[str, List[str]]):</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">            Path to the audio file or list of paths to the audio files to process.</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">        offset_start (Union[float, None]):</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">            The start time of the audio file to process.</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">        offset_end (Union[float, None]):</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">            The end time of the audio file to process.</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">        num_speakers (int):</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">            The number of oracle speakers.</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">        diarization (bool):</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">            Whether to do diarization or not.</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">        multi_channel (bool):</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">            Whether to do multi-channel diarization or not.</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="sd">        source_lang (str):</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">            Source language of the audio file.</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">        timestamps_format (str):</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">            Timestamps format to use.</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">        vocab (Union[List[str], None]):</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="sd">            List of words to use for the vocabulary.</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="sd">        word_timestamps (bool):</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">            Whether to return word timestamps or not.</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="sd">        internal_vad (bool):</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">            Whether to use faster-whisper&#39;s VAD or not.</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">        repetition_penalty (float):</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">            The repetition penalty to use for the beam search.</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">        compression_ratio_threshold (float):</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">            If the gzip compression ratio is above this value, treat as failed.</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">        log_prob_threshold (float):</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="sd">            If the average log probability over sampled tokens is below this value, treat as failed.</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">        no_speech_threshold (float):</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">            If the no_speech probability is higher than this value AND the average log probability</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">            over sampled tokens is below `log_prob_threshold`, consider the segment as silent.</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">        condition_on_previous_text (bool):</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">            If True, the previous output of the model is provided as a prompt for the next window;</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">            disabling may make the text inconsistent across windows, but the model becomes less prone</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">            to getting stuck in a failure loop, such as repetition looping or timestamps going out of sync.</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">        Union[Tuple[List[dict], ProcessTimes, float], Exception]:</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">            The results of the ASR pipeline or an exception if something went wrong.</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">            Results are returned as a tuple of the following:</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">                * List[dict]: The final results of the ASR pipeline.</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">                * ProcessTimes: The process times of each step of the ASR pipeline.</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">                * float: The audio duration</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>        <span class="n">audio</span><span class="p">,</span> <span class="n">durations</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>            <span class="n">_audio</span><span class="p">,</span> <span class="n">_duration</span> <span class="o">=</span> <span class="n">read_audio</span><span class="p">(</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>                <span class="n">path</span><span class="p">,</span> <span class="n">offset_start</span><span class="o">=</span><span class="n">offset_start</span><span class="p">,</span> <span class="n">offset_end</span><span class="o">=</span><span class="n">offset_end</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>            <span class="p">)</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>            <span class="n">audio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_audio</span><span class="p">)</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>            <span class="n">durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_duration</span><span class="p">)</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="n">duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="n">audio</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">read_audio</span><span class="p">(</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>            <span class="n">filepath</span><span class="p">,</span> <span class="n">offset_start</span><span class="o">=</span><span class="n">offset_start</span><span class="p">,</span> <span class="n">offset_end</span><span class="o">=</span><span class="n">offset_end</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>        <span class="p">)</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>    <span class="n">gpu_index</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">use_remote</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="n">_url</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">next_url</span><span class="p">()</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>        <span class="n">transcription_execution</span> <span class="o">=</span> <span class="n">RemoteExecution</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">_url</span><span class="p">)</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="n">gpu_index</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">get_device</span><span class="p">()</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>        <span class="n">transcription_execution</span> <span class="o">=</span> <span class="n">LocalExecution</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">gpu_index</span><span class="p">)</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="k">if</span> <span class="n">diarization</span> <span class="ow">and</span> <span class="n">multi_channel</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">use_remote</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>            <span class="n">_url</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">next_url</span><span class="p">()</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>            <span class="n">diarization_execution</span> <span class="o">=</span> <span class="n">RemoteExecution</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">_url</span><span class="p">)</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>            <span class="k">if</span> <span class="n">gpu_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>                <span class="n">gpu_index</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">get_device</span><span class="p">()</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>            <span class="n">diarization_execution</span> <span class="o">=</span> <span class="n">LocalExecution</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">gpu_index</span><span class="p">)</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="n">diarization_execution</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>    <span class="n">task</span> <span class="o">=</span> <span class="n">ASRTask</span><span class="p">(</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>        <span class="n">audio</span><span class="o">=</span><span class="n">audio</span><span class="p">,</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>        <span class="n">diarization</span><span class="o">=</span><span class="n">DiarizationTask</span><span class="p">(</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>            <span class="n">execution</span><span class="o">=</span><span class="n">diarization_execution</span><span class="p">,</span> <span class="n">num_speakers</span><span class="o">=</span><span class="n">num_speakers</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="p">),</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>        <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="n">multi_channel</span><span class="o">=</span><span class="n">multi_channel</span><span class="p">,</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>        <span class="n">offset_start</span><span class="o">=</span><span class="n">offset_start</span><span class="p">,</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="n">post_processing</span><span class="o">=</span><span class="n">PostProcessingTask</span><span class="p">(),</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>        <span class="n">process_times</span><span class="o">=</span><span class="n">ProcessTimes</span><span class="p">(),</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="n">timestamps_format</span><span class="o">=</span><span class="n">timestamps_format</span><span class="p">,</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="n">transcription</span><span class="o">=</span><span class="n">TranscriptionTask</span><span class="p">(</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>            <span class="n">execution</span><span class="o">=</span><span class="n">transcription_execution</span><span class="p">,</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>            <span class="n">options</span><span class="o">=</span><span class="n">TranscriptionOptions</span><span class="p">(</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>                <span class="n">compression_ratio_threshold</span><span class="o">=</span><span class="n">compression_ratio_threshold</span><span class="p">,</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>                <span class="n">condition_on_previous_text</span><span class="o">=</span><span class="n">condition_on_previous_text</span><span class="p">,</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>                <span class="n">internal_vad</span><span class="o">=</span><span class="n">internal_vad</span><span class="p">,</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>                <span class="n">log_prob_threshold</span><span class="o">=</span><span class="n">log_prob_threshold</span><span class="p">,</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>                <span class="n">no_speech_threshold</span><span class="o">=</span><span class="n">no_speech_threshold</span><span class="p">,</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>                <span class="n">repetition_penalty</span><span class="o">=</span><span class="n">repetition_penalty</span><span class="p">,</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>                <span class="n">source_lang</span><span class="o">=</span><span class="n">source_lang</span><span class="p">,</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>                <span class="n">vocab</span><span class="o">=</span><span class="n">vocab</span><span class="p">,</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>            <span class="p">),</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>        <span class="p">),</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>        <span class="n">word_timestamps</span><span class="o">=</span><span class="n">word_timestamps</span><span class="p">,</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>    <span class="p">)</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>        <span class="n">start_process_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>        <span class="n">transcription_task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_transcription</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">)</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>        <span class="n">diarization_task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_diarization</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">)</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">transcription_task</span><span class="p">,</span> <span class="n">diarization_task</span><span class="p">)</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">ProcessException</span><span class="p">):</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>            <span class="k">return</span> <span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">result</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>            <span class="n">diarization</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>            <span class="ow">and</span> <span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>            <span class="ow">and</span> <span class="n">multi_channel</span> <span class="ow">is</span> <span class="kc">False</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>        <span class="p">):</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>            <span class="c1"># Empty audio early return</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>            <span class="k">return</span> <span class="n">early_return</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">)</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">ProcessException</span><span class="p">):</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>            <span class="k">return</span> <span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">result</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>            <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">process_post_processing</span><span class="p">,</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>            <span class="n">task</span><span class="p">,</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>        <span class="p">)</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">post_processing</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">ProcessException</span><span class="p">):</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>            <span class="k">return</span> <span class="n">task</span><span class="o">.</span><span class="n">post_processing</span><span class="o">.</span><span class="n">result</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>        <span class="n">task</span><span class="o">.</span><span class="n">process_times</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_process_time</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>        <span class="k">return</span> <span class="n">task</span><span class="o">.</span><span class="n">post_processing</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">process_times</span><span class="p">,</span> <span class="n">duration</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>        <span class="k">return</span> <span class="n">e</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>        <span class="k">del</span> <span class="n">task</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>        <span class="k">if</span> <span class="n">gpu_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">release_device</span><span class="p">(</span><span class="n">gpu_index</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRAsyncService.process_post_processing" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">process_post_processing</span><span class="p">(</span><span class="n">task</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Process a task of post-processing.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>task</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="src.wordcab_transcribe.services.asr_service.ASRTask" href="#src.wordcab_transcribe.services.asr_service.ASRTask">ASRTask</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The task and its parameters.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>None</code></td>          <td>
                <code>None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The task is updated with the result.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="k">def</span> <span class="nf">process_post_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">ASRTask</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">    Process a task of post-processing.</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">        task (ASRTask): The task and its parameters.</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">        None: The task is updated with the result.</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>        <span class="n">total_post_process_time</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>        <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">multi_channel</span><span class="p">:</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>            <span class="n">utterances</span><span class="p">,</span> <span class="n">process_time</span> <span class="o">=</span> <span class="n">time_and_tell</span><span class="p">(</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="o">.</span><span class="n">post_processing</span><span class="o">.</span><span class="n">multi_channel_speaker_mapping</span><span class="p">(</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>                    <span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">result</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>                <span class="p">),</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>                <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;multi_channel_speaker_mapping&quot;</span><span class="p">,</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>                <span class="n">debug_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">,</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>            <span class="p">)</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>            <span class="n">total_post_process_time</span> <span class="o">+=</span> <span class="n">process_time</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>            <span class="n">formatted_segments</span><span class="p">,</span> <span class="n">process_time</span> <span class="o">=</span> <span class="n">time_and_tell</span><span class="p">(</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>                <span class="n">format_segments</span><span class="p">(</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>                    <span class="n">transcription_output</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">result</span><span class="p">,</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>                <span class="p">),</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>                <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;format_segments&quot;</span><span class="p">,</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>                <span class="n">debug_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">,</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>            <span class="p">)</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>            <span class="n">total_post_process_time</span> <span class="o">+=</span> <span class="n">process_time</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>            <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">execution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>                <span class="n">utterances</span><span class="p">,</span> <span class="n">process_time</span> <span class="o">=</span> <span class="n">time_and_tell</span><span class="p">(</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="o">.</span><span class="n">post_processing</span><span class="o">.</span><span class="n">single_channel_speaker_mapping</span><span class="p">(</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>                        <span class="n">transcript_segments</span><span class="o">=</span><span class="n">formatted_segments</span><span class="p">,</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>                        <span class="n">speaker_timestamps</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">diarization</span><span class="o">.</span><span class="n">result</span><span class="p">,</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>                        <span class="n">word_timestamps</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">word_timestamps</span><span class="p">,</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>                    <span class="p">),</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>                    <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;single_channel_speaker_mapping&quot;</span><span class="p">,</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>                    <span class="n">debug_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">,</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>                <span class="p">)</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>                <span class="n">total_post_process_time</span> <span class="o">+=</span> <span class="n">process_time</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>                <span class="n">utterances</span> <span class="o">=</span> <span class="n">formatted_segments</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>        <span class="n">final_utterances</span><span class="p">,</span> <span class="n">process_time</span> <span class="o">=</span> <span class="n">time_and_tell</span><span class="p">(</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="o">.</span><span class="n">post_processing</span><span class="o">.</span><span class="n">final_processing_before_returning</span><span class="p">(</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>                <span class="n">utterances</span><span class="o">=</span><span class="n">utterances</span><span class="p">,</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>                <span class="n">offset_start</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">offset_start</span><span class="p">,</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>                <span class="n">timestamps_format</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">timestamps_format</span><span class="p">,</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>                <span class="n">word_timestamps</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">word_timestamps</span><span class="p">,</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>            <span class="p">),</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>            <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;final_processing_before_returning&quot;</span><span class="p">,</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>            <span class="n">debug_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">,</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>        <span class="p">)</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>        <span class="n">total_post_process_time</span> <span class="o">+=</span> <span class="n">process_time</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>        <span class="n">final_utterances</span> <span class="o">=</span> <span class="n">ProcessException</span><span class="p">(</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>            <span class="n">source</span><span class="o">=</span><span class="n">ExceptionSource</span><span class="o">.</span><span class="n">post_processing</span><span class="p">,</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error in post-processing: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>        <span class="p">)</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>        <span class="n">total_post_process_time</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>        <span class="n">task</span><span class="o">.</span><span class="n">process_times</span><span class="o">.</span><span class="n">post_processing</span> <span class="o">=</span> <span class="n">total_post_process_time</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>        <span class="n">task</span><span class="o">.</span><span class="n">post_processing</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">final_utterances</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRAsyncService.process_transcription" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">process_transcription</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">debug_mode</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Process a task of transcription and update the task with the result.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>task</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="src.wordcab_transcribe.services.asr_service.ASRTask" href="#src.wordcab_transcribe.services.asr_service.ASRTask">ASRTask</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The task and its parameters.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>debug_mode</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to run in debug mode or not.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>None</code></td>          <td>
                <code>None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The task is updated with the result.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">process_transcription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">ASRTask</span><span class="p">,</span> <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">    Process a task of transcription and update the task with the result.</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">        task (ASRTask): The task and its parameters.</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">        debug_mode (bool): Whether to run in debug mode or not.</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">        None: The task is updated with the result.</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">execution</span><span class="p">,</span> <span class="n">LocalExecution</span><span class="p">):</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>            <span class="n">out</span> <span class="o">=</span> <span class="k">await</span> <span class="n">time_and_tell_async</span><span class="p">(</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>                <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_services</span><span class="o">.</span><span class="n">transcription</span><span class="p">(</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>                    <span class="n">task</span><span class="o">.</span><span class="n">audio</span><span class="p">,</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>                    <span class="n">model_index</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>                    <span class="n">suppress_blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>                    <span class="n">word_timestamps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>                    <span class="o">**</span><span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>                <span class="p">),</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>                <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;transcription&quot;</span><span class="p">,</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>                <span class="n">debug_mode</span><span class="o">=</span><span class="n">debug_mode</span><span class="p">,</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>            <span class="p">)</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>            <span class="n">result</span><span class="p">,</span> <span class="n">process_time</span> <span class="o">=</span> <span class="n">out</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">execution</span><span class="p">,</span> <span class="n">RemoteExecution</span><span class="p">):</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">audio</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>                <span class="n">ts</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>                    <span class="n">TensorShare</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s2">&quot;audio&quot;</span><span class="p">:</span> <span class="n">a</span><span class="p">},</span> <span class="n">backend</span><span class="o">=</span><span class="n">Backend</span><span class="o">.</span><span class="n">TORCH</span><span class="p">)</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">audio</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>                <span class="p">]</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>                <span class="n">ts</span> <span class="o">=</span> <span class="n">TensorShare</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>                    <span class="p">{</span><span class="s2">&quot;audio&quot;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">audio</span><span class="p">},</span> <span class="n">backend</span><span class="o">=</span><span class="n">Backend</span><span class="o">.</span><span class="n">TORCH</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>                <span class="p">)</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">TranscribeRequest</span><span class="p">(</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>                <span class="n">audio</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>                <span class="o">**</span><span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>            <span class="p">)</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>            <span class="n">out</span> <span class="o">=</span> <span class="k">await</span> <span class="n">time_and_tell_async</span><span class="p">(</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">remote_transcription</span><span class="p">(</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>                    <span class="n">url</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>                    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>                <span class="p">),</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>                <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;transcription&quot;</span><span class="p">,</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>                <span class="n">debug_mode</span><span class="o">=</span><span class="n">debug_mode</span><span class="p">,</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>            <span class="p">)</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="n">result</span><span class="p">,</span> <span class="n">process_time</span> <span class="o">=</span> <span class="n">out</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;No execution method specified.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">ProcessException</span><span class="p">(</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>            <span class="n">source</span><span class="o">=</span><span class="n">ExceptionSource</span><span class="o">.</span><span class="n">transcription</span><span class="p">,</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error in transcription: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>        <span class="p">)</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>        <span class="n">process_time</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>        <span class="n">task</span><span class="o">.</span><span class="n">process_times</span><span class="o">.</span><span class="n">transcription</span> <span class="o">=</span> <span class="n">process_time</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>        <span class="n">task</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRAsyncService.remote_diarization" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">remote_diarization</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Remote diarization method.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-773" name="__codelineno-0-773"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">remote_diarization</span><span class="p">(</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>    <span class="n">data</span><span class="p">:</span> <span class="n">DiarizationRequest</span><span class="p">,</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DiarizationOutput</span><span class="p">:</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Remote diarization method.&quot;&quot;&quot;</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">/api/v1/diarize&quot;</span><span class="p">,</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">(),</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>                <span class="n">r</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;detail&quot;</span><span class="p">])</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>                <span class="k">return</span> <span class="n">DiarizationOutput</span><span class="p">(</span><span class="o">**</span><span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRAsyncService.remote_transcription" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">remote_transcription</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Remote transcription method.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-756" name="__codelineno-0-756"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">remote_transcription</span><span class="p">(</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>    <span class="n">data</span><span class="p">:</span> <span class="n">TranscribeRequest</span><span class="p">,</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TranscriptionOutput</span><span class="p">:</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Remote transcription method.&quot;&quot;&quot;</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>            <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">/api/v1/transcribe&quot;</span><span class="p">,</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">(),</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>                <span class="k">return</span> <span class="n">TranscriptionOutput</span><span class="p">(</span><span class="o">**</span><span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRAsyncService.remove_url" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">remove_url</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Remove a remote URL from the list of URLs.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-843" name="__codelineno-0-843"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">remove_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">UrlSchema</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">UrlSchema</span><span class="p">,</span> <span class="n">ProcessException</span><span class="p">]:</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove a remote URL from the list of URLs.&quot;&quot;&quot;</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>        <span class="n">selected_task</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">task</span><span class="p">)</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>        <span class="c1"># Case 1: We are not using remote task</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>        <span class="k">if</span> <span class="n">selected_task</span><span class="o">.</span><span class="n">use_remote</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You are not using remote </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">task</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>        <span class="c1"># Case 2: We are using remote task</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>            <span class="k">await</span> <span class="n">selected_task</span><span class="o">.</span><span class="n">remove_url</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">url</span><span class="p">))</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>            <span class="k">if</span> <span class="n">selected_task</span><span class="o">.</span><span class="n">get_queue_size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>                <span class="c1"># No more remote URLs, switch to local service</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">create_local_service</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">task</span><span class="p">)</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_services</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">task</span><span class="p">,</span> <span class="n">RemoteServiceConfig</span><span class="p">())</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>        <span class="k">return</span> <span class="n">data</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>        <span class="k">return</span> <span class="n">ProcessException</span><span class="p">(</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>            <span class="n">source</span><span class="o">=</span><span class="n">ExceptionSource</span><span class="o">.</span><span class="n">remove_url</span><span class="p">,</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error in removing URL: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.asr_service.ASRDiarizationOnly" class="doc doc-heading">
          <code>ASRDiarizationOnly</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="src.wordcab_transcribe.services.asr_service.ASRService" href="#src.wordcab_transcribe.services.asr_service.ASRService">ASRService</a></code></p>

  
      <p>ASR Service module for diarization-only endpoint.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1015" name="__codelineno-0-1015"></a><span class="k">class</span> <span class="nc">ASRDiarizationOnly</span><span class="p">(</span><span class="n">ASRService</span><span class="p">):</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;ASR Service module for diarization-only endpoint.&quot;&quot;&quot;</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>        <span class="n">window_lengths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>        <span class="n">shift_lengths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>        <span class="n">multiscale_weights</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>        <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the ASRDiarizationOnly class.&quot;&quot;&quot;</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">diarization_service</span> <span class="o">=</span> <span class="n">DiarizeService</span><span class="p">(</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>            <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>            <span class="n">device_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_index</span><span class="p">,</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>            <span class="n">window_lengths</span><span class="o">=</span><span class="n">window_lengths</span><span class="p">,</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>            <span class="n">shift_lengths</span><span class="o">=</span><span class="n">shift_lengths</span><span class="p">,</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>            <span class="n">multiscale_weights</span><span class="o">=</span><span class="n">multiscale_weights</span><span class="p">,</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>        <span class="p">)</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vad_service</span> <span class="o">=</span> <span class="n">VadService</span><span class="p">()</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span> <span class="o">=</span> <span class="n">debug_mode</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">inference_warmup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Warmup the GPU by doing one inference.&quot;&quot;&quot;</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>        <span class="n">sample_audio</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;assets/warmup_sample.wav&quot;</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>        <span class="n">audio</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">read_audio</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sample_audio</span><span class="p">))</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">TensorShare</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s2">&quot;audio&quot;</span><span class="p">:</span> <span class="n">audio</span><span class="p">},</span> <span class="n">backend</span><span class="o">=</span><span class="n">Backend</span><span class="o">.</span><span class="n">TORCH</span><span class="p">)</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">DiarizationRequest</span><span class="p">(</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>            <span class="n">audio</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>            <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>            <span class="n">num_speakers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>        <span class="p">)</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>        <span class="k">for</span> <span class="n">gpu_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">device_index</span><span class="p">:</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warmup GPU </span><span class="si">{</span><span class="n">gpu_index</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_input</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DiarizationRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DiarizationOutput</span><span class="p">:</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><span class="sd">        Process the input data and return the results as a list of segments.</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><span class="sd">            data (DiarizationRequest):</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><span class="sd">                The input data to process.</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a><span class="sd">            DiarizationOutput:</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a><span class="sd">                The results of the ASR pipeline.</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>        <span class="n">gpu_index</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">get_device</span><span class="p">()</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diarization_service</span><span class="p">(</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>                <span class="n">waveform</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">audio</span><span class="p">,</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>                <span class="n">audio_duration</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>                <span class="n">oracle_num_speakers</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">num_speakers</span><span class="p">,</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>                <span class="n">model_index</span><span class="o">=</span><span class="n">gpu_index</span><span class="p">,</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>                <span class="n">vad_service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vad_service</span><span class="p">,</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>            <span class="p">)</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">ProcessException</span><span class="p">(</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>                <span class="n">source</span><span class="o">=</span><span class="n">ExceptionSource</span><span class="o">.</span><span class="n">diarization</span><span class="p">,</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error in diarization: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>            <span class="p">)</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">release_device</span><span class="p">(</span><span class="n">gpu_index</span><span class="p">)</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRDiarizationOnly.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">window_lengths</span><span class="p">,</span> <span class="n">shift_lengths</span><span class="p">,</span> <span class="n">multiscale_weights</span><span class="p">,</span> <span class="n">debug_mode</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize the ASRDiarizationOnly class.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1018" name="__codelineno-0-1018"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>    <span class="n">window_lengths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>    <span class="n">shift_lengths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>    <span class="n">multiscale_weights</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>    <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the ASRDiarizationOnly class.&quot;&quot;&quot;</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">diarization_service</span> <span class="o">=</span> <span class="n">DiarizeService</span><span class="p">(</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>        <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>        <span class="n">device_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_index</span><span class="p">,</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>        <span class="n">window_lengths</span><span class="o">=</span><span class="n">window_lengths</span><span class="p">,</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>        <span class="n">shift_lengths</span><span class="o">=</span><span class="n">shift_lengths</span><span class="p">,</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>        <span class="n">multiscale_weights</span><span class="o">=</span><span class="n">multiscale_weights</span><span class="p">,</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>    <span class="p">)</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vad_service</span> <span class="o">=</span> <span class="n">VadService</span><span class="p">()</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span> <span class="o">=</span> <span class="n">debug_mode</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRDiarizationOnly.inference_warmup" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">inference_warmup</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Warmup the GPU by doing one inference.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1038" name="__codelineno-0-1038"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">inference_warmup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Warmup the GPU by doing one inference.&quot;&quot;&quot;</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>    <span class="n">sample_audio</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;assets/warmup_sample.wav&quot;</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>    <span class="n">audio</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">read_audio</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sample_audio</span><span class="p">))</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>    <span class="n">ts</span> <span class="o">=</span> <span class="n">TensorShare</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s2">&quot;audio&quot;</span><span class="p">:</span> <span class="n">audio</span><span class="p">},</span> <span class="n">backend</span><span class="o">=</span><span class="n">Backend</span><span class="o">.</span><span class="n">TORCH</span><span class="p">)</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">DiarizationRequest</span><span class="p">(</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>        <span class="n">audio</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>        <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>        <span class="n">num_speakers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>    <span class="p">)</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>    <span class="k">for</span> <span class="n">gpu_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">device_index</span><span class="p">:</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warmup GPU </span><span class="si">{</span><span class="n">gpu_index</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_input</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRDiarizationOnly.process_input" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">process_input</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Process the input data and return the results as a list of segments.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="wordcab_transcribe.models.DiarizationRequest">DiarizationRequest</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input data to process.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>DiarizationOutput</code></td>          <td>
                <code><span title="wordcab_transcribe.models.DiarizationOutput">DiarizationOutput</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The results of the ASR pipeline.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1055" name="__codelineno-0-1055"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">process_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DiarizationRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DiarizationOutput</span><span class="p">:</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><span class="sd">    Process the input data and return the results as a list of segments.</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><span class="sd">        data (DiarizationRequest):</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><span class="sd">            The input data to process.</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a><span class="sd">        DiarizationOutput:</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a><span class="sd">            The results of the ASR pipeline.</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>    <span class="n">gpu_index</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">get_device</span><span class="p">()</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diarization_service</span><span class="p">(</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>            <span class="n">waveform</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">audio</span><span class="p">,</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>            <span class="n">audio_duration</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>            <span class="n">oracle_num_speakers</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">num_speakers</span><span class="p">,</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>            <span class="n">model_index</span><span class="o">=</span><span class="n">gpu_index</span><span class="p">,</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>            <span class="n">vad_service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vad_service</span><span class="p">,</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>        <span class="p">)</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">ProcessException</span><span class="p">(</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>            <span class="n">source</span><span class="o">=</span><span class="n">ExceptionSource</span><span class="o">.</span><span class="n">diarization</span><span class="p">,</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error in diarization: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>        <span class="p">)</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">release_device</span><span class="p">(</span><span class="n">gpu_index</span><span class="p">)</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.asr_service.ASRLiveService" class="doc doc-heading">
          <code>ASRLiveService</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="src.wordcab_transcribe.services.asr_service.ASRService" href="#src.wordcab_transcribe.services.asr_service.ASRService">ASRService</a></code></p>

  
      <p>ASR Service module for live endpoints.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span>
<span class="normal"><a href="#__codelineno-0-918">918</a></span>
<span class="normal"><a href="#__codelineno-0-919">919</a></span>
<span class="normal"><a href="#__codelineno-0-920">920</a></span>
<span class="normal"><a href="#__codelineno-0-921">921</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-867" name="__codelineno-0-867"></a><span class="k">class</span> <span class="nc">ASRLiveService</span><span class="p">(</span><span class="n">ASRService</span><span class="p">):</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;ASR Service module for live endpoints.&quot;&quot;&quot;</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">whisper_model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">compute_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the ASRLiveService class.&quot;&quot;&quot;</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transcription_service</span> <span class="o">=</span> <span class="n">TranscribeService</span><span class="p">(</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>            <span class="n">model_path</span><span class="o">=</span><span class="n">whisper_model</span><span class="p">,</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>            <span class="n">compute_type</span><span class="o">=</span><span class="n">compute_type</span><span class="p">,</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>            <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>            <span class="n">device_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_index</span><span class="p">,</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>        <span class="p">)</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span> <span class="o">=</span> <span class="n">debug_mode</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">inference_warmup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Warmup the GPU by loading the models.&quot;&quot;&quot;</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>        <span class="n">sample_audio</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;assets/warmup_sample.wav&quot;</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sample_audio</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">audio_file</span><span class="p">:</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>            <span class="k">async</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_input</span><span class="p">(</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>                <span class="n">data</span><span class="o">=</span><span class="n">audio_file</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>                <span class="n">source_lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>            <span class="p">):</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>                <span class="k">pass</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">source_lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a><span class="sd">        Process the input data and return the results as a tuple of text and duration.</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a><span class="sd">            data (bytes):</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a><span class="sd">                The raw audio bytes to process.</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a><span class="sd">            source_lang (str):</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a><span class="sd">                The source language of the audio data.</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a><span class="sd">        Yields:</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a><span class="sd">            Iterable[dict]: The results of the ASR pipeline.</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>        <span class="n">gpu_index</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">get_device</span><span class="p">()</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>            <span class="n">waveform</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">read_audio</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>            <span class="k">async</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transcription_service</span><span class="o">.</span><span class="n">async_live_transcribe</span><span class="p">(</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>                <span class="n">audio</span><span class="o">=</span><span class="n">waveform</span><span class="p">,</span> <span class="n">source_lang</span><span class="o">=</span><span class="n">source_lang</span><span class="p">,</span> <span class="n">model_index</span><span class="o">=</span><span class="n">gpu_index</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>            <span class="p">):</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>                <span class="k">yield</span> <span class="n">result</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>                <span class="sa">f</span><span class="s2">&quot;Error in transcription gpu </span><span class="si">{</span><span class="n">gpu_index</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>            <span class="p">)</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">release_device</span><span class="p">(</span><span class="n">gpu_index</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRLiveService.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">whisper_model</span><span class="p">,</span> <span class="n">compute_type</span><span class="p">,</span> <span class="n">debug_mode</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize the ASRLiveService class.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-870" name="__codelineno-0-870"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">whisper_model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">compute_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the ASRLiveService class.&quot;&quot;&quot;</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">transcription_service</span> <span class="o">=</span> <span class="n">TranscribeService</span><span class="p">(</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>        <span class="n">model_path</span><span class="o">=</span><span class="n">whisper_model</span><span class="p">,</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>        <span class="n">compute_type</span><span class="o">=</span><span class="n">compute_type</span><span class="p">,</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>        <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>        <span class="n">device_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_index</span><span class="p">,</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>    <span class="p">)</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span> <span class="o">=</span> <span class="n">debug_mode</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRLiveService.inference_warmup" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">inference_warmup</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Warmup the GPU by loading the models.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-882" name="__codelineno-0-882"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">inference_warmup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Warmup the GPU by loading the models.&quot;&quot;&quot;</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>    <span class="n">sample_audio</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;assets/warmup_sample.wav&quot;</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sample_audio</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">audio_file</span><span class="p">:</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>        <span class="k">async</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_input</span><span class="p">(</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>            <span class="n">data</span><span class="o">=</span><span class="n">audio_file</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>            <span class="n">source_lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>        <span class="p">):</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>            <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRLiveService.process_input" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">process_input</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">source_lang</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Process the input data and return the results as a tuple of text and duration.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code>bytes</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The raw audio bytes to process.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>source_lang</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The source language of the audio data.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Yields:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Iterable">Iterable</span>[dict]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Iterable[dict]: The results of the ASR pipeline.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span>
<span class="normal"><a href="#__codelineno-0-918">918</a></span>
<span class="normal"><a href="#__codelineno-0-919">919</a></span>
<span class="normal"><a href="#__codelineno-0-920">920</a></span>
<span class="normal"><a href="#__codelineno-0-921">921</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-892" name="__codelineno-0-892"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">process_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">source_lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a><span class="sd">    Process the input data and return the results as a tuple of text and duration.</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a><span class="sd">        data (bytes):</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a><span class="sd">            The raw audio bytes to process.</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a><span class="sd">        source_lang (str):</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a><span class="sd">            The source language of the audio data.</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a><span class="sd">    Yields:</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a><span class="sd">        Iterable[dict]: The results of the ASR pipeline.</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>    <span class="n">gpu_index</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">get_device</span><span class="p">()</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>        <span class="n">waveform</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">read_audio</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>        <span class="k">async</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transcription_service</span><span class="o">.</span><span class="n">async_live_transcribe</span><span class="p">(</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>            <span class="n">audio</span><span class="o">=</span><span class="n">waveform</span><span class="p">,</span> <span class="n">source_lang</span><span class="o">=</span><span class="n">source_lang</span><span class="p">,</span> <span class="n">model_index</span><span class="o">=</span><span class="n">gpu_index</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>        <span class="p">):</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>            <span class="k">yield</span> <span class="n">result</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>            <span class="sa">f</span><span class="s2">&quot;Error in transcription gpu </span><span class="si">{</span><span class="n">gpu_index</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>        <span class="p">)</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">release_device</span><span class="p">(</span><span class="n">gpu_index</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.asr_service.ASRService" class="doc doc-heading">
          <code>ASRService</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="abc.ABC">ABC</span></code></p>

  
      <p>Base ASR Service module that handle all AI interactions and batch processing.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="k">class</span> <span class="nc">ASRService</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Base ASR Service module that handle all AI interactions and batch processing.&quot;&quot;&quot;</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the ASR Service.</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">        This class is not meant to be instantiated. Use the subclasses instead.</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="p">)</span>  <span class="c1"># Do we have a GPU? If so, use it!</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">device_count</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="s2">&quot;cuda&quot;</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NVIDIA GPUs available: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_gpus</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="s2">&quot;cuda&quot;</span><span class="p">:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">device_index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_gpus</span><span class="p">))</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">device_index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span> <span class="o">=</span> <span class="n">GPUService</span><span class="p">(</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>            <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">device_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_index</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="p">)</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_input</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the input request by creating a task and adding it to the appropriate queues.&quot;&quot;&quot;</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;This method should be implemented in subclasses.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRService.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize the ASR Service.</p>
<p>This class is not meant to be instantiated. Use the subclasses instead.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the ASR Service.</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    This class is not meant to be instantiated. Use the subclasses instead.</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="p">)</span>  <span class="c1"># Do we have a GPU? If so, use it!</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">device_count</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="s2">&quot;cuda&quot;</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NVIDIA GPUs available: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_gpus</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="s2">&quot;cuda&quot;</span><span class="p">:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device_index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_gpus</span><span class="p">))</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device_index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span> <span class="o">=</span> <span class="n">GPUService</span><span class="p">(</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">device_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_index</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRService.process_input" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">process_input</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Process the input request by creating a task and adding it to the appropriate queues.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="nd">@abstractmethod</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">process_input</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Process the input request by creating a task and adding it to the appropriate queues.&quot;&quot;&quot;</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;This method should be implemented in subclasses.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.asr_service.ASRTask" class="doc doc-heading">
          <code>ASRTask</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>

  
      <p>ASR Task model.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="k">class</span> <span class="nc">ASRTask</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;ASR Task model.&quot;&quot;&quot;</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="n">audio</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="n">diarization</span><span class="p">:</span> <span class="s2">&quot;DiarizationTask&quot;</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="n">multi_channel</span><span class="p">:</span> <span class="nb">bool</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="n">offset_start</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">post_processing</span><span class="p">:</span> <span class="s2">&quot;PostProcessingTask&quot;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="n">process_times</span><span class="p">:</span> <span class="n">ProcessTimes</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">timestamps_format</span><span class="p">:</span> <span class="n">Timestamps</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="n">transcription</span><span class="p">:</span> <span class="s2">&quot;TranscriptionTask&quot;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">word_timestamps</span><span class="p">:</span> <span class="nb">bool</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.asr_service.ASRTranscriptionOnly" class="doc doc-heading">
          <code>ASRTranscriptionOnly</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="src.wordcab_transcribe.services.asr_service.ASRService" href="#src.wordcab_transcribe.services.asr_service.ASRService">ASRService</a></code></p>

  
      <p>ASR Service module for transcription-only endpoint.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-924" name="__codelineno-0-924"></a><span class="k">class</span> <span class="nc">ASRTranscriptionOnly</span><span class="p">(</span><span class="n">ASRService</span><span class="p">):</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;ASR Service module for transcription-only endpoint.&quot;&quot;&quot;</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>        <span class="n">whisper_model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>        <span class="n">compute_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>        <span class="n">extra_languages</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>        <span class="n">extra_languages_model_paths</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>        <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the ASRTranscriptionOnly class.&quot;&quot;&quot;</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transcription_service</span> <span class="o">=</span> <span class="n">TranscribeService</span><span class="p">(</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>            <span class="n">model_path</span><span class="o">=</span><span class="n">whisper_model</span><span class="p">,</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>            <span class="n">compute_type</span><span class="o">=</span><span class="n">compute_type</span><span class="p">,</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>            <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>            <span class="n">device_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_index</span><span class="p">,</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>            <span class="n">extra_languages</span><span class="o">=</span><span class="n">extra_languages</span><span class="p">,</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>            <span class="n">extra_languages_model_paths</span><span class="o">=</span><span class="n">extra_languages_model_paths</span><span class="p">,</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>        <span class="p">)</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span> <span class="o">=</span> <span class="n">debug_mode</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">inference_warmup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Warmup the GPU by doing one inference.&quot;&quot;&quot;</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>        <span class="n">sample_audio</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;assets/warmup_sample.wav&quot;</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>        <span class="n">audio</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">read_audio</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sample_audio</span><span class="p">))</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">TensorShare</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s2">&quot;audio&quot;</span><span class="p">:</span> <span class="n">audio</span><span class="p">},</span> <span class="n">backend</span><span class="o">=</span><span class="n">Backend</span><span class="o">.</span><span class="n">TORCH</span><span class="p">)</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">TranscribeRequest</span><span class="p">(</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>            <span class="n">audio</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>            <span class="n">source_lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>            <span class="n">compression_ratio_threshold</span><span class="o">=</span><span class="mf">2.4</span><span class="p">,</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>            <span class="n">condition_on_previous_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>            <span class="n">internal_vad</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>            <span class="n">log_prob_threshold</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>            <span class="n">no_speech_threshold</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>            <span class="n">repetition_penalty</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>            <span class="n">vocab</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>        <span class="p">)</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>        <span class="k">for</span> <span class="n">gpu_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">device_index</span><span class="p">:</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warmup GPU </span><span class="si">{</span><span class="n">gpu_index</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_input</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_input</span><span class="p">(</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">TranscribeRequest</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">TranscriptionOutput</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">TranscriptionOutput</span><span class="p">]]:</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a><span class="sd">        Process the input data and return the results as a list of segments.</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a><span class="sd">            data (TranscribeRequest):</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a><span class="sd">                The input data to process.</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a><span class="sd">            Union[TranscriptionOutput, List[TranscriptionOutput]]:</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a><span class="sd">                The results of the ASR pipeline.</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>        <span class="n">gpu_index</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">get_device</span><span class="p">()</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transcription_service</span><span class="p">(</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>                <span class="n">audio</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">audio</span><span class="p">,</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>                <span class="n">source_lang</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">source_lang</span><span class="p">,</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>                <span class="n">model_index</span><span class="o">=</span><span class="n">gpu_index</span><span class="p">,</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>                <span class="n">suppress_blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>                <span class="n">word_timestamps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>                <span class="n">compression_ratio_threshold</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">compression_ratio_threshold</span><span class="p">,</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>                <span class="n">condition_on_previous_text</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">condition_on_previous_text</span><span class="p">,</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>                <span class="n">internal_vad</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">internal_vad</span><span class="p">,</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>                <span class="n">log_prob_threshold</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">log_prob_threshold</span><span class="p">,</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>                <span class="n">repetition_penalty</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">repetition_penalty</span><span class="p">,</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>                <span class="n">no_speech_threshold</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">no_speech_threshold</span><span class="p">,</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>                <span class="n">vocab</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">vocab</span><span class="p">,</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>            <span class="p">)</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">ProcessException</span><span class="p">(</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>                <span class="n">source</span><span class="o">=</span><span class="n">ExceptionSource</span><span class="o">.</span><span class="n">transcription</span><span class="p">,</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error in transcription: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>            <span class="p">)</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">release_device</span><span class="p">(</span><span class="n">gpu_index</span><span class="p">)</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRTranscriptionOnly.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">whisper_model</span><span class="p">,</span> <span class="n">compute_type</span><span class="p">,</span> <span class="n">extra_languages</span><span class="p">,</span> <span class="n">extra_languages_model_paths</span><span class="p">,</span> <span class="n">debug_mode</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize the ASRTranscriptionOnly class.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-927">927</a></span>
<span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-927" name="__codelineno-0-927"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>    <span class="n">whisper_model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>    <span class="n">compute_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>    <span class="n">extra_languages</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>    <span class="n">extra_languages_model_paths</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>    <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the ASRTranscriptionOnly class.&quot;&quot;&quot;</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">transcription_service</span> <span class="o">=</span> <span class="n">TranscribeService</span><span class="p">(</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>        <span class="n">model_path</span><span class="o">=</span><span class="n">whisper_model</span><span class="p">,</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>        <span class="n">compute_type</span><span class="o">=</span><span class="n">compute_type</span><span class="p">,</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>        <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>        <span class="n">device_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_index</span><span class="p">,</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>        <span class="n">extra_languages</span><span class="o">=</span><span class="n">extra_languages</span><span class="p">,</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>        <span class="n">extra_languages_model_paths</span><span class="o">=</span><span class="n">extra_languages_model_paths</span><span class="p">,</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>    <span class="p">)</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span> <span class="o">=</span> <span class="n">debug_mode</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRTranscriptionOnly.inference_warmup" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">inference_warmup</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Warmup the GPU by doing one inference.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span>
<span class="normal"><a href="#__codelineno-0-953">953</a></span>
<span class="normal"><a href="#__codelineno-0-954">954</a></span>
<span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span>
<span class="normal"><a href="#__codelineno-0-960">960</a></span>
<span class="normal"><a href="#__codelineno-0-961">961</a></span>
<span class="normal"><a href="#__codelineno-0-962">962</a></span>
<span class="normal"><a href="#__codelineno-0-963">963</a></span>
<span class="normal"><a href="#__codelineno-0-964">964</a></span>
<span class="normal"><a href="#__codelineno-0-965">965</a></span>
<span class="normal"><a href="#__codelineno-0-966">966</a></span>
<span class="normal"><a href="#__codelineno-0-967">967</a></span>
<span class="normal"><a href="#__codelineno-0-968">968</a></span>
<span class="normal"><a href="#__codelineno-0-969">969</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-948" name="__codelineno-0-948"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">inference_warmup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Warmup the GPU by doing one inference.&quot;&quot;&quot;</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>    <span class="n">sample_audio</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;assets/warmup_sample.wav&quot;</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>    <span class="n">audio</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">read_audio</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sample_audio</span><span class="p">))</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>    <span class="n">ts</span> <span class="o">=</span> <span class="n">TensorShare</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s2">&quot;audio&quot;</span><span class="p">:</span> <span class="n">audio</span><span class="p">},</span> <span class="n">backend</span><span class="o">=</span><span class="n">Backend</span><span class="o">.</span><span class="n">TORCH</span><span class="p">)</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">TranscribeRequest</span><span class="p">(</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>        <span class="n">audio</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>        <span class="n">source_lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>        <span class="n">compression_ratio_threshold</span><span class="o">=</span><span class="mf">2.4</span><span class="p">,</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>        <span class="n">condition_on_previous_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>        <span class="n">internal_vad</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>        <span class="n">log_prob_threshold</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>        <span class="n">no_speech_threshold</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>        <span class="n">repetition_penalty</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>        <span class="n">vocab</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>    <span class="p">)</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>    <span class="k">for</span> <span class="n">gpu_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">device_index</span><span class="p">:</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warmup GPU </span><span class="si">{</span><span class="n">gpu_index</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_input</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.ASRTranscriptionOnly.process_input" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">process_input</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Process the input data and return the results as a list of segments.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="wordcab_transcribe.models.TranscribeRequest">TranscribeRequest</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input data to process.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="wordcab_transcribe.models.TranscriptionOutput">TranscriptionOutput</span>, <span title="typing.List">List</span>[<span title="wordcab_transcribe.models.TranscriptionOutput">TranscriptionOutput</span>]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Union[TranscriptionOutput, List[TranscriptionOutput]]:
The results of the ASR pipeline.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-971" name="__codelineno-0-971"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">process_input</span><span class="p">(</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">TranscribeRequest</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">TranscriptionOutput</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">TranscriptionOutput</span><span class="p">]]:</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a><span class="sd">    Process the input data and return the results as a list of segments.</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a><span class="sd">        data (TranscribeRequest):</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a><span class="sd">            The input data to process.</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a><span class="sd">        Union[TranscriptionOutput, List[TranscriptionOutput]]:</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a><span class="sd">            The results of the ASR pipeline.</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>    <span class="n">gpu_index</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">get_device</span><span class="p">()</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transcription_service</span><span class="p">(</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>            <span class="n">audio</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">audio</span><span class="p">,</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>            <span class="n">source_lang</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">source_lang</span><span class="p">,</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>            <span class="n">model_index</span><span class="o">=</span><span class="n">gpu_index</span><span class="p">,</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>            <span class="n">suppress_blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>            <span class="n">word_timestamps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>            <span class="n">compression_ratio_threshold</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">compression_ratio_threshold</span><span class="p">,</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>            <span class="n">condition_on_previous_text</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">condition_on_previous_text</span><span class="p">,</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>            <span class="n">internal_vad</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">internal_vad</span><span class="p">,</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>            <span class="n">log_prob_threshold</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">log_prob_threshold</span><span class="p">,</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>            <span class="n">repetition_penalty</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">repetition_penalty</span><span class="p">,</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>            <span class="n">no_speech_threshold</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">no_speech_threshold</span><span class="p">,</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>            <span class="n">vocab</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">vocab</span><span class="p">,</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>        <span class="p">)</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">ProcessException</span><span class="p">(</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>            <span class="n">source</span><span class="o">=</span><span class="n">ExceptionSource</span><span class="o">.</span><span class="n">transcription</span><span class="p">,</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error in transcription: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>        <span class="p">)</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gpu_handler</span><span class="o">.</span><span class="n">release_device</span><span class="p">(</span><span class="n">gpu_index</span><span class="p">)</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.asr_service.DiarizationTask" class="doc doc-heading">
          <code>DiarizationTask</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>

  
      <p>Diarization Task model.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="k">class</span> <span class="nc">DiarizationTask</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Diarization Task model.&quot;&quot;&quot;</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="n">execution</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">LocalExecution</span><span class="p">,</span> <span class="n">RemoteExecution</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="n">num_speakers</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="n">result</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ProcessException</span><span class="p">,</span> <span class="n">DiarizationOutput</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.asr_service.ExceptionSource" class="doc doc-heading">
          <code>ExceptionSource</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code>str</code>, <code><span title="enum.Enum">Enum</span></code></p>

  
      <p>Exception source enum.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="k">class</span> <span class="nc">ExceptionSource</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Exception source enum.&quot;&quot;&quot;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="n">add_url</span> <span class="o">=</span> <span class="s2">&quot;add_url&quot;</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="n">diarization</span> <span class="o">=</span> <span class="s2">&quot;diarization&quot;</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="n">get_url</span> <span class="o">=</span> <span class="s2">&quot;get_url&quot;</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="n">post_processing</span> <span class="o">=</span> <span class="s2">&quot;post_processing&quot;</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="n">remove_url</span> <span class="o">=</span> <span class="s2">&quot;remove_url&quot;</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">transcription</span> <span class="o">=</span> <span class="s2">&quot;transcription&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.asr_service.LocalExecution" class="doc doc-heading">
          <code>LocalExecution</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>

  
      <p>Local execution model.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="k">class</span> <span class="nc">LocalExecution</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Local execution model.&quot;&quot;&quot;</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.asr_service.LocalServiceRegistry" class="doc doc-heading">
          <code>LocalServiceRegistry</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>Registry for local services.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="nd">@dataclass</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="k">class</span> <span class="nc">LocalServiceRegistry</span><span class="p">:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Registry for local services.&quot;&quot;&quot;</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="n">diarization</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DiarizeService</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="n">post_processing</span><span class="p">:</span> <span class="n">PostProcessingService</span> <span class="o">=</span> <span class="n">PostProcessingService</span><span class="p">()</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="n">transcription</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TranscribeService</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="n">vad</span><span class="p">:</span> <span class="n">VadService</span> <span class="o">=</span> <span class="n">VadService</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.asr_service.PostProcessingTask" class="doc doc-heading">
          <code>PostProcessingTask</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>

  
      <p>Post Processing Task model.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="k">class</span> <span class="nc">PostProcessingTask</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Post Processing Task model.&quot;&quot;&quot;</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="n">result</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ProcessException</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.asr_service.ProcessException" class="doc doc-heading">
          <code>ProcessException</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>

  
      <p>Process exception model.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="k">class</span> <span class="nc">ProcessException</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Process exception model.&quot;&quot;&quot;</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">source</span><span class="p">:</span> <span class="n">ExceptionSource</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.asr_service.RemoteExecution" class="doc doc-heading">
          <code>RemoteExecution</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>

  
      <p>Remote execution model.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="k">class</span> <span class="nc">RemoteExecution</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Remote execution model.&quot;&quot;&quot;</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.asr_service.RemoteServiceConfig" class="doc doc-heading">
          <code>RemoteServiceConfig</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>Remote service config.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="nd">@dataclass</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="k">class</span> <span class="nc">RemoteServiceConfig</span><span class="p">:</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Remote service config.&quot;&quot;&quot;</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="n">url_handler</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">URLService</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="n">use_remote</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="k">def</span> <span class="nf">get_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the list of URLs.&quot;&quot;&quot;</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_handler</span><span class="o">.</span><span class="n">get_urls</span><span class="p">()</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="k">def</span> <span class="nf">get_queue_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the queue size.&quot;&quot;&quot;</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_handler</span><span class="o">.</span><span class="n">get_queue_size</span><span class="p">()</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">add_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a URL to the list of URLs.&quot;&quot;&quot;</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_handler</span><span class="o">.</span><span class="n">add_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">next_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the next URL.&quot;&quot;&quot;</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_handler</span><span class="o">.</span><span class="n">next_url</span><span class="p">()</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">remove_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a URL from the list of URLs.&quot;&quot;&quot;</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_handler</span><span class="o">.</span><span class="n">remove_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.RemoteServiceConfig.add_url" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Add a URL to the list of URLs.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">add_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a URL to the list of URLs.&quot;&quot;&quot;</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_handler</span><span class="o">.</span><span class="n">add_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.RemoteServiceConfig.get_queue_size" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_queue_size</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get the queue size.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="k">def</span> <span class="nf">get_queue_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the queue size.&quot;&quot;&quot;</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_handler</span><span class="o">.</span><span class="n">get_queue_size</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.RemoteServiceConfig.get_urls" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_urls</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get the list of URLs.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="k">def</span> <span class="nf">get_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the list of URLs.&quot;&quot;&quot;</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_handler</span><span class="o">.</span><span class="n">get_urls</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.RemoteServiceConfig.next_url" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">next_url</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get the next URL.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">next_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the next URL.&quot;&quot;&quot;</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_handler</span><span class="o">.</span><span class="n">next_url</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.asr_service.RemoteServiceConfig.remove_url" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">remove_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Remove a URL from the list of URLs.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">remove_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove a URL from the list of URLs.&quot;&quot;&quot;</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_handler</span><span class="o">.</span><span class="n">remove_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.asr_service.RemoteServiceRegistry" class="doc doc-heading">
          <code>RemoteServiceRegistry</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>Registry for remote services.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="nd">@dataclass</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="k">class</span> <span class="nc">RemoteServiceRegistry</span><span class="p">:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Registry for remote services.&quot;&quot;&quot;</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="n">diarization</span><span class="p">:</span> <span class="n">RemoteServiceConfig</span> <span class="o">=</span> <span class="n">RemoteServiceConfig</span><span class="p">()</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>    <span class="n">transcription</span><span class="p">:</span> <span class="n">RemoteServiceConfig</span> <span class="o">=</span> <span class="n">RemoteServiceConfig</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.asr_service.TranscriptionOptions" class="doc doc-heading">
          <code>TranscriptionOptions</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>

  
      <p>Transcription options model.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="k">class</span> <span class="nc">TranscriptionOptions</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Transcription options model.&quot;&quot;&quot;</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="n">compression_ratio_threshold</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="n">condition_on_previous_text</span><span class="p">:</span> <span class="nb">bool</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="n">internal_vad</span><span class="p">:</span> <span class="nb">bool</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="n">log_prob_threshold</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="n">no_speech_threshold</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="n">repetition_penalty</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="n">source_lang</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="n">vocab</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.asr_service.TranscriptionTask" class="doc doc-heading">
          <code>TranscriptionTask</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>

  
      <p>Transcription Task model.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/asr_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="k">class</span> <span class="nc">TranscriptionTask</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Transcription Task model.&quot;&quot;&quot;</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="n">execution</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">LocalExecution</span><span class="p">,</span> <span class="n">RemoteExecution</span><span class="p">]</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">options</span><span class="p">:</span> <span class="n">TranscriptionOptions</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="n">result</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="n">ProcessException</span><span class="p">,</span> <span class="n">TranscriptionOutput</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">TranscriptionOutput</span><span class="p">],</span> <span class="kc">None</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">




  <div class="doc doc-contents first">
  
      <p>GPU service class to handle gpu availability for models.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.concurrency_services.GPUService" class="doc doc-heading">
          <code>GPUService</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>GPU service class to handle gpu availability for models.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/concurrency_services.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="k">class</span> <span class="nc">GPUService</span><span class="p">:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;GPU service class to handle gpu availability for models.&quot;&quot;&quot;</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">device_index</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        Initialize the GPU service.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">            device (str): Device to use for inference. Can be &quot;cpu&quot; or &quot;cuda&quot;.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">            device_index (List[int]): Index of the device to use for inference.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">device</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device_index</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_index</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device_index</span><span class="p">))</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_index</span><span class="p">:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        Get the next available device.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">            int: Index of the next available device.</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>                <span class="n">device_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">()</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>                <span class="k">return</span> <span class="n">device_index</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>            <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">QueueEmpty</span><span class="p">:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="k">def</span> <span class="nf">release_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        Return a device to the available devices list.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">            device_index (int): Index of the device to add to the available devices list.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">item</span> <span class="o">==</span> <span class="n">device_index</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">_queue</span><span class="p">):</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">(</span><span class="n">device_index</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.concurrency_services.GPUService.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">device_index</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize the GPU service.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>device</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Device to use for inference. Can be "cpu" or "cuda".</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>device_index</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Index of the device to use for inference.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/concurrency_services.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">device_index</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    Initialize the GPU service.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        device (str): Device to use for inference. Can be &quot;cpu&quot; or &quot;cuda&quot;.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        device_index (List[int]): Index of the device to use for inference.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">device</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">device_index</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_index</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device_index</span><span class="p">))</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_index</span><span class="p">:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.concurrency_services.GPUService.get_device" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_device</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get the next available device.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>int</code></td>          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Index of the next available device.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/concurrency_services.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">get_device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    Get the next available device.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        int: Index of the next available device.</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>            <span class="n">device_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">()</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>            <span class="k">return</span> <span class="n">device_index</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">QueueEmpty</span><span class="p">:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.concurrency_services.GPUService.release_device" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">release_device</span><span class="p">(</span><span class="n">device_index</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return a device to the available devices list.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>device_index</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Index of the device to add to the available devices list.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/concurrency_services.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="k">def</span> <span class="nf">release_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    Return a device to the available devices list.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        device_index (int): Index of the device to add to the available devices list.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">item</span> <span class="o">==</span> <span class="n">device_index</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">_queue</span><span class="p">):</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">(</span><span class="n">device_index</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.concurrency_services.URLService" class="doc doc-heading">
          <code>URLService</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>URL service class to handle multiple remote URLs.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/concurrency_services.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="k">class</span> <span class="nc">URLService</span><span class="p">:</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;URL service class to handle multiple remote URLs.&quot;&quot;&quot;</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">remote_urls</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        Initialize the URL service.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">            remote_urls (List[str]): List of remote URLs to use.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remote_urls</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">remote_urls</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_init_queue</span><span class="p">()</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="k">def</span> <span class="nf">_init_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the queue with the available URLs.&quot;&quot;&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_urls</span><span class="p">))</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_urls</span><span class="p">:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="k">def</span> <span class="nf">get_queue_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        Get the current queue size.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">            int: Current queue size.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">qsize</span><span class="p">()</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="k">def</span> <span class="nf">get_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        Get the list of available URLs.</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">            List[str]: List of available URLs.</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_urls</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">next_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        We use this to iterate equally over the available URLs.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">            str: Next available URL.</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">()</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="c1"># Unlike GPU we don&#39;t want to block remote ASR requests.</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="c1"># So we re-insert the URL back into the queue after getting it.</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="k">return</span> <span class="n">url</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">add_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        Add a URL to the pool of available URLs.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">            url (str): URL to add to the queue.</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="k">if</span> <span class="n">url</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_urls</span><span class="p">:</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remote_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="c1"># Re-initialize the queue with the new URL.</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_init_queue</span><span class="p">()</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">remove_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        Remove a URL from the pool of available URLs.</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">            url (str): URL to remove from the queue.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="k">if</span> <span class="n">url</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_urls</span><span class="p">:</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remote_urls</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="c1"># Re-initialize the queue without the removed URL.</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_init_queue</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.concurrency_services.URLService.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">remote_urls</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize the URL service.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>remote_urls</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of remote URLs to use.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/concurrency_services.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">remote_urls</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    Initialize the URL service.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        remote_urls (List[str]): List of remote URLs to use.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">remote_urls</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">remote_urls</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_init_queue</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.concurrency_services.URLService.add_url" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Add a URL to the pool of available URLs.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>url</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>URL to add to the queue.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/concurrency_services.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">add_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    Add a URL to the pool of available URLs.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        url (str): URL to add to the queue.</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="k">if</span> <span class="n">url</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_urls</span><span class="p">:</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remote_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="c1"># Re-initialize the queue with the new URL.</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_init_queue</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.concurrency_services.URLService.get_queue_size" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_queue_size</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get the current queue size.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>int</code></td>          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Current queue size.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/concurrency_services.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="k">def</span> <span class="nf">get_queue_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    Get the current queue size.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        int: Current queue size.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">qsize</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.concurrency_services.URLService.get_urls" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_urls</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get the list of available URLs.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List[str]: List of available URLs.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/concurrency_services.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="k">def</span> <span class="nf">get_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    Get the list of available URLs.</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">        List[str]: List of available URLs.</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_urls</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.concurrency_services.URLService.next_url" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">next_url</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>We use this to iterate equally over the available URLs.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Next available URL.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/concurrency_services.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">next_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    We use this to iterate equally over the available URLs.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        str: Next available URL.</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">()</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="c1"># Unlike GPU we don&#39;t want to block remote ASR requests.</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="c1"># So we re-insert the URL back into the queue after getting it.</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="k">return</span> <span class="n">url</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.concurrency_services.URLService.remove_url" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">remove_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Remove a URL from the pool of available URLs.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>url</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>URL to remove from the queue.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/concurrency_services.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">remove_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">    Remove a URL from the pool of available URLs.</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        url (str): URL to remove from the queue.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="k">if</span> <span class="n">url</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_urls</span><span class="p">:</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remote_urls</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="c1"># Re-initialize the queue without the removed URL.</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_init_queue</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">




  <div class="doc doc-contents first">
  
      <p>Diarization Service for audio files.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.diarization.diarize_service.DiarizationModels" class="doc doc-heading">
          <code>DiarizationModels</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="typing.NamedTuple">NamedTuple</span></code></p>

  
      <p>Diarization Models.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/diarization/diarize_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="k">class</span> <span class="nc">DiarizationModels</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Diarization Models.&quot;&quot;&quot;</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="n">segmentation</span><span class="p">:</span> <span class="n">SegmentationModule</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="n">clustering</span><span class="p">:</span> <span class="n">ClusteringModule</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.diarization.diarize_service.DiarizeService" class="doc doc-heading">
          <code>DiarizeService</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Diarize Service for audio files.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/diarization/diarize_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="k">class</span> <span class="nc">DiarizeService</span><span class="p">:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Diarize Service for audio files.&quot;&quot;&quot;</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="n">device</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="n">device_index</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="n">window_lengths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="n">shift_lengths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="n">multiscale_weights</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="n">max_num_speakers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the Diarize Service.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        This service uses the NVIDIA NeMo diarization models.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">            device (str): Device to use for inference. Can be &quot;cpu&quot; or &quot;cuda&quot;.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">            device_index (Union[int, List[int]]): Index of the device to use for inference.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">            window_lengths (List[float]): List of window lengths.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">            shift_lengths (List[float]): List of shift lengths.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">            multiscale_weights (List[int]): List of weights for each scale.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">            max_num_speakers (int): Maximum number of speakers. Defaults to 8.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_num_speakers</span> <span class="o">=</span> <span class="n">max_num_speakers</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_window_lengths</span> <span class="o">=</span> <span class="n">window_lengths</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_shift_lengths</span> <span class="o">=</span> <span class="n">shift_lengths</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_multiscale_weights</span> <span class="o">=</span> <span class="n">multiscale_weights</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_multiscale_weights</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">default_segmentation_batch_size</span> <span class="o">=</span> <span class="mi">64</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_multiscale_weights</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">default_segmentation_batch_size</span> <span class="o">=</span> <span class="mi">128</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">default_segmentation_batch_size</span> <span class="o">=</span> <span class="mi">256</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_scale_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">window_lengths</span><span class="p">,</span> <span class="n">shift_lengths</span><span class="p">)))</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">device_index</span><span class="p">:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="n">_device</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;cuda:</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="s2">&quot;cuda&quot;</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">segmentation_module</span> <span class="o">=</span> <span class="n">SegmentationModule</span><span class="p">(</span><span class="n">_device</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">clustering_module</span> <span class="o">=</span> <span class="n">ClusteringModule</span><span class="p">(</span><span class="n">_device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_num_speakers</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">DiarizationModels</span><span class="p">(</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>                <span class="n">segmentation</span><span class="o">=</span><span class="n">segmentation_module</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>                <span class="n">clustering</span><span class="o">=</span><span class="n">clustering_module</span><span class="p">,</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>                <span class="n">device</span><span class="o">=</span><span class="n">_device</span><span class="p">,</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">waveform</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">TensorShare</span><span class="p">],</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="n">audio_duration</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="n">oracle_num_speakers</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="n">model_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="n">vad_service</span><span class="p">:</span> <span class="n">VadService</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DiarizationOutput</span><span class="p">:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        Run inference with the diarization model.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">            waveform (Union[torch.Tensor, TensorShare]):</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">                Waveform to run inference on.</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">            audio_duration (float):</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">                Duration of the audio file in seconds.</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">            oracle_num_speakers (int):</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">                Number of speakers in the audio file.</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">            model_index (int):</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">                Index of the model to use for inference.</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">            vad_service (VadService):</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">                VAD service instance to use for Voice Activity Detection.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">            DiarizationOutput:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">                List of segments with the following keys: &quot;start&quot;, &quot;end&quot;, &quot;speaker&quot;.</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">TensorShare</span><span class="p">):</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="n">ts</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">to_tensors</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">Backend</span><span class="o">.</span><span class="n">TORCH</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="n">waveform</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="s2">&quot;audio&quot;</span><span class="p">]</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="n">vad_outputs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">vad_service</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">group_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vad_outputs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Empty audio</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="k">if</span> <span class="n">audio_duration</span> <span class="o">&lt;</span> <span class="mi">3600</span><span class="p">:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="n">scale_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_scale_dict</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="n">segmentation_batch_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_segmentation_batch_size</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="n">multiscale_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_multiscale_weights</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="k">elif</span> <span class="n">audio_duration</span> <span class="o">&lt;</span> <span class="mi">10800</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="n">scale_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>                <span class="nb">enumerate</span><span class="p">(</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>                    <span class="nb">zip</span><span class="p">(</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                        <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">default_shift_lengths</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>                    <span class="p">)</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                <span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="n">segmentation_batch_size</span> <span class="o">=</span> <span class="mi">64</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="n">multiscale_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_multiscale_weights</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="n">scale_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">])))</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>            <span class="n">segmentation_batch_size</span> <span class="o">=</span> <span class="mi">32</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="n">multiscale_weights</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="n">ms_emb_ts</span><span class="p">:</span> <span class="n">MultiscaleEmbeddingsAndTimestamps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="n">model_index</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="p">]</span><span class="o">.</span><span class="n">segmentation</span><span class="p">(</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="n">waveform</span><span class="o">=</span><span class="n">waveform</span><span class="p">,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>            <span class="n">batch_size</span><span class="o">=</span><span class="n">segmentation_batch_size</span><span class="p">,</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="n">vad_outputs</span><span class="o">=</span><span class="n">vad_outputs</span><span class="p">,</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="n">scale_dict</span><span class="o">=</span><span class="n">scale_dict</span><span class="p">,</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="n">multiscale_weights</span><span class="o">=</span><span class="n">multiscale_weights</span><span class="p">,</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="p">)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="n">clustering_outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">model_index</span><span class="p">]</span><span class="o">.</span><span class="n">clustering</span><span class="p">(</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="n">ms_emb_ts</span><span class="p">,</span> <span class="n">oracle_num_speakers</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="n">_outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contiguous_stamps</span><span class="p">(</span><span class="n">clustering_outputs</span><span class="p">)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_stamps</span><span class="p">(</span><span class="n">_outputs</span><span class="p">)</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="k">return</span> <span class="n">DiarizationOutput</span><span class="p">(</span><span class="n">segments</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="k">def</span> <span class="nf">get_contiguous_stamps</span><span class="p">(</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="n">stamps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">        Return contiguous timestamps.</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">            stamps (List[Tuple[float, float, int]]): List of segments containing the start time, end time and speaker.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">            List[Tuple[float, float, int]]: List of segments containing the start time, end time and speaker.</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="n">contiguous_stamps</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stamps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>            <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span> <span class="o">=</span> <span class="n">stamps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="n">next_start</span><span class="p">,</span> <span class="n">next_end</span><span class="p">,</span> <span class="n">next_speaker</span> <span class="o">=</span> <span class="n">stamps</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>            <span class="k">if</span> <span class="n">end</span> <span class="o">&gt;</span> <span class="n">next_start</span><span class="p">:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>                <span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">next_start</span> <span class="o">+</span> <span class="n">end</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>                <span class="n">stamps</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">avg</span><span class="p">,</span> <span class="n">next_end</span><span class="p">,</span> <span class="n">next_speaker</span><span class="p">)</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>                <span class="n">contiguous_stamps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">avg</span><span class="p">,</span> <span class="n">speaker</span><span class="p">))</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>                <span class="n">contiguous_stamps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span><span class="p">))</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span> <span class="o">=</span> <span class="n">stamps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="n">contiguous_stamps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span><span class="p">))</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="k">return</span> <span class="n">contiguous_stamps</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="k">def</span> <span class="nf">merge_stamps</span><span class="p">(</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="n">stamps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">        Merge timestamps of the same speaker.</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">            stamps (List[Tuple[float, float, int]]): List of segments containing the start time, end time and speaker.</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">            List[Tuple[float, float, int]]: List of segments containing the start time, end time and speaker.</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="n">overlap_stamps</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stamps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>            <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span> <span class="o">=</span> <span class="n">stamps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="n">next_start</span><span class="p">,</span> <span class="n">next_end</span><span class="p">,</span> <span class="n">next_speaker</span> <span class="o">=</span> <span class="n">stamps</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>            <span class="k">if</span> <span class="n">end</span> <span class="o">==</span> <span class="n">next_start</span> <span class="ow">and</span> <span class="n">speaker</span> <span class="o">==</span> <span class="n">next_speaker</span><span class="p">:</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>                <span class="n">stamps</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">next_end</span><span class="p">,</span> <span class="n">next_speaker</span><span class="p">)</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>                <span class="n">overlap_stamps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span><span class="p">))</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span> <span class="o">=</span> <span class="n">stamps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="n">overlap_stamps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span><span class="p">))</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="k">return</span> <span class="n">overlap_stamps</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.diarization.diarize_service.DiarizeService.__call__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">audio_duration</span><span class="p">,</span> <span class="n">oracle_num_speakers</span><span class="p">,</span> <span class="n">model_index</span><span class="p">,</span> <span class="n">vad_service</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Run inference with the diarization model.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>waveform</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="torch.Tensor">Tensor</span>, <span title="tensorshare.TensorShare">TensorShare</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Waveform to run inference on.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>audio_duration</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Duration of the audio file in seconds.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>oracle_num_speakers</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Number of speakers in the audio file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model_index</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Index of the model to use for inference.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>vad_service</code></td>
          <td>
                <code><span title="wordcab_transcribe.services.vad_service.VadService">VadService</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>VAD service instance to use for Voice Activity Detection.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>DiarizationOutput</code></td>          <td>
                <code><span title="wordcab_transcribe.models.DiarizationOutput">DiarizationOutput</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of segments with the following keys: "start", "end", "speaker".</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/diarization/diarize_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">waveform</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">TensorShare</span><span class="p">],</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="n">audio_duration</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="n">oracle_num_speakers</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="n">model_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="n">vad_service</span><span class="p">:</span> <span class="n">VadService</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DiarizationOutput</span><span class="p">:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    Run inference with the diarization model.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        waveform (Union[torch.Tensor, TensorShare]):</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">            Waveform to run inference on.</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        audio_duration (float):</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">            Duration of the audio file in seconds.</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">        oracle_num_speakers (int):</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">            Number of speakers in the audio file.</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        model_index (int):</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">            Index of the model to use for inference.</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        vad_service (VadService):</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">            VAD service instance to use for Voice Activity Detection.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        DiarizationOutput:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">            List of segments with the following keys: &quot;start&quot;, &quot;end&quot;, &quot;speaker&quot;.</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">TensorShare</span><span class="p">):</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">to_tensors</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">Backend</span><span class="o">.</span><span class="n">TORCH</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="n">waveform</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="s2">&quot;audio&quot;</span><span class="p">]</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="n">vad_outputs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">vad_service</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">group_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vad_outputs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Empty audio</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">if</span> <span class="n">audio_duration</span> <span class="o">&lt;</span> <span class="mi">3600</span><span class="p">:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="n">scale_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_scale_dict</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="n">segmentation_batch_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_segmentation_batch_size</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="n">multiscale_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_multiscale_weights</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="k">elif</span> <span class="n">audio_duration</span> <span class="o">&lt;</span> <span class="mi">10800</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="n">scale_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="nb">enumerate</span><span class="p">(</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>                <span class="nb">zip</span><span class="p">(</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                    <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">default_shift_lengths</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>                <span class="p">)</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="n">segmentation_batch_size</span> <span class="o">=</span> <span class="mi">64</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="n">multiscale_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_multiscale_weights</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="n">scale_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">])))</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="n">segmentation_batch_size</span> <span class="o">=</span> <span class="mi">32</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="n">multiscale_weights</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="n">ms_emb_ts</span><span class="p">:</span> <span class="n">MultiscaleEmbeddingsAndTimestamps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="n">model_index</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>    <span class="p">]</span><span class="o">.</span><span class="n">segmentation</span><span class="p">(</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="n">waveform</span><span class="o">=</span><span class="n">waveform</span><span class="p">,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="n">batch_size</span><span class="o">=</span><span class="n">segmentation_batch_size</span><span class="p">,</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="n">vad_outputs</span><span class="o">=</span><span class="n">vad_outputs</span><span class="p">,</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="n">scale_dict</span><span class="o">=</span><span class="n">scale_dict</span><span class="p">,</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="n">multiscale_weights</span><span class="o">=</span><span class="n">multiscale_weights</span><span class="p">,</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="p">)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="n">clustering_outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">model_index</span><span class="p">]</span><span class="o">.</span><span class="n">clustering</span><span class="p">(</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="n">ms_emb_ts</span><span class="p">,</span> <span class="n">oracle_num_speakers</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="n">_outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contiguous_stamps</span><span class="p">(</span><span class="n">clustering_outputs</span><span class="p">)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_stamps</span><span class="p">(</span><span class="n">_outputs</span><span class="p">)</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="k">return</span> <span class="n">DiarizationOutput</span><span class="p">(</span><span class="n">segments</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.diarization.diarize_service.DiarizeService.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">device_index</span><span class="p">,</span> <span class="n">window_lengths</span><span class="p">,</span> <span class="n">shift_lengths</span><span class="p">,</span> <span class="n">multiscale_weights</span><span class="p">,</span> <span class="n">max_num_speakers</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize the Diarize Service.</p>
<p>This service uses the NVIDIA NeMo diarization models.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>device</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Device to use for inference. Can be "cpu" or "cuda".</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>device_index</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, <span title="typing.List">List</span>[int]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Index of the device to use for inference.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>window_lengths</code></td>
          <td>
                <code><span title="typing.List">List</span>[float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of window lengths.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>shift_lengths</code></td>
          <td>
                <code><span title="typing.List">List</span>[float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of shift lengths.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>multiscale_weights</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of weights for each scale.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>max_num_speakers</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Maximum number of speakers. Defaults to 8.</p>
            </div>
          </td>
          <td>
                <code>8</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/diarization/diarize_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span>
<span class="normal"><a href="#__codelineno-0-97">97</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="n">device_index</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="n">window_lengths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="n">shift_lengths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="n">multiscale_weights</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="n">max_num_speakers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the Diarize Service.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    This service uses the NVIDIA NeMo diarization models.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        device (str): Device to use for inference. Can be &quot;cpu&quot; or &quot;cuda&quot;.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        device_index (Union[int, List[int]]): Index of the device to use for inference.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        window_lengths (List[float]): List of window lengths.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        shift_lengths (List[float]): List of shift lengths.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        multiscale_weights (List[int]): List of weights for each scale.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        max_num_speakers (int): Maximum number of speakers. Defaults to 8.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">max_num_speakers</span> <span class="o">=</span> <span class="n">max_num_speakers</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">default_window_lengths</span> <span class="o">=</span> <span class="n">window_lengths</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">default_shift_lengths</span> <span class="o">=</span> <span class="n">shift_lengths</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">default_multiscale_weights</span> <span class="o">=</span> <span class="n">multiscale_weights</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_multiscale_weights</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_segmentation_batch_size</span> <span class="o">=</span> <span class="mi">64</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_multiscale_weights</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_segmentation_batch_size</span> <span class="o">=</span> <span class="mi">128</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_segmentation_batch_size</span> <span class="o">=</span> <span class="mi">256</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">default_scale_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">window_lengths</span><span class="p">,</span> <span class="n">shift_lengths</span><span class="p">)))</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">device_index</span><span class="p">:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="n">_device</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;cuda:</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="s2">&quot;cuda&quot;</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="n">segmentation_module</span> <span class="o">=</span> <span class="n">SegmentationModule</span><span class="p">(</span><span class="n">_device</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="n">clustering_module</span> <span class="o">=</span> <span class="n">ClusteringModule</span><span class="p">(</span><span class="n">_device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_num_speakers</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">DiarizationModels</span><span class="p">(</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">segmentation</span><span class="o">=</span><span class="n">segmentation_module</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="n">clustering</span><span class="o">=</span><span class="n">clustering_module</span><span class="p">,</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="n">device</span><span class="o">=</span><span class="n">_device</span><span class="p">,</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.diarization.diarize_service.DiarizeService.get_contiguous_stamps" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_contiguous_stamps</span><span class="p">(</span><span class="n">stamps</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return contiguous timestamps.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>stamps</code></td>
          <td>
                <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[float, float, int]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of segments containing the start time, end time and speaker.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[float, float, int]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List[Tuple[float, float, int]]: List of segments containing the start time, end time and speaker.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/diarization/diarize_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="k">def</span> <span class="nf">get_contiguous_stamps</span><span class="p">(</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="n">stamps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">    Return contiguous timestamps.</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">        stamps (List[Tuple[float, float, int]]): List of segments containing the start time, end time and speaker.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        List[Tuple[float, float, int]]: List of segments containing the start time, end time and speaker.</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="n">contiguous_stamps</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stamps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span> <span class="o">=</span> <span class="n">stamps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="n">next_start</span><span class="p">,</span> <span class="n">next_end</span><span class="p">,</span> <span class="n">next_speaker</span> <span class="o">=</span> <span class="n">stamps</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="k">if</span> <span class="n">end</span> <span class="o">&gt;</span> <span class="n">next_start</span><span class="p">:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>            <span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">next_start</span> <span class="o">+</span> <span class="n">end</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="n">stamps</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">avg</span><span class="p">,</span> <span class="n">next_end</span><span class="p">,</span> <span class="n">next_speaker</span><span class="p">)</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>            <span class="n">contiguous_stamps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">avg</span><span class="p">,</span> <span class="n">speaker</span><span class="p">))</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>            <span class="n">contiguous_stamps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span><span class="p">))</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span> <span class="o">=</span> <span class="n">stamps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="n">contiguous_stamps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span><span class="p">))</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="k">return</span> <span class="n">contiguous_stamps</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.diarization.diarize_service.DiarizeService.merge_stamps" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">merge_stamps</span><span class="p">(</span><span class="n">stamps</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Merge timestamps of the same speaker.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>stamps</code></td>
          <td>
                <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[float, float, int]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of segments containing the start time, end time and speaker.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[float, float, int]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List[Tuple[float, float, int]]: List of segments containing the start time, end time and speaker.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/diarization/diarize_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="k">def</span> <span class="nf">merge_stamps</span><span class="p">(</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="n">stamps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">    Merge timestamps of the same speaker.</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">        stamps (List[Tuple[float, float, int]]): List of segments containing the start time, end time and speaker.</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">        List[Tuple[float, float, int]]: List of segments containing the start time, end time and speaker.</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="n">overlap_stamps</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stamps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span> <span class="o">=</span> <span class="n">stamps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="n">next_start</span><span class="p">,</span> <span class="n">next_end</span><span class="p">,</span> <span class="n">next_speaker</span> <span class="o">=</span> <span class="n">stamps</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="k">if</span> <span class="n">end</span> <span class="o">==</span> <span class="n">next_start</span> <span class="ow">and</span> <span class="n">speaker</span> <span class="o">==</span> <span class="n">next_speaker</span><span class="p">:</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>            <span class="n">stamps</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">next_end</span><span class="p">,</span> <span class="n">next_speaker</span><span class="p">)</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>            <span class="n">overlap_stamps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span><span class="p">))</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>    <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span> <span class="o">=</span> <span class="n">stamps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="n">overlap_stamps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span><span class="p">))</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="k">return</span> <span class="n">overlap_stamps</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">




  <div class="doc doc-contents first">
  
      <p>Post-Processing Service for audio files.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.post_processing_service.PostProcessingService" class="doc doc-heading">
          <code>PostProcessingService</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Post-Processing Service for audio files.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/post_processing_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="k">class</span> <span class="nc">PostProcessingService</span><span class="p">:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Post-Processing Service for audio files.&quot;&quot;&quot;</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the PostProcessingService.&quot;&quot;&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sample_rate</span> <span class="o">=</span> <span class="mi">16000</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="k">def</span> <span class="nf">single_channel_speaker_mapping</span><span class="p">(</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="n">transcript_segments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">],</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="n">speaker_timestamps</span><span class="p">:</span> <span class="n">DiarizationOutput</span><span class="p">,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="n">word_timestamps</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">]:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the post-processing functions on the inputs.</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        The postprocessing pipeline is as follows:</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        1. Map each transcript segment to its corresponding speaker.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        2. Group utterances of the same speaker together.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">            transcript_segments (List[Utterance]):</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                List of transcript utterances.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">            speaker_timestamps (DiarizationOutput):</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">                List of speaker timestamps.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">            word_timestamps (bool):</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">                Whether to include word timestamps.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">            List[Utterance]:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">                List of utterances with speaker mapping.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="n">segments_with_speaker_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segments_speaker_mapping</span><span class="p">(</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>            <span class="n">transcript_segments</span><span class="p">,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>            <span class="n">speaker_timestamps</span><span class="o">.</span><span class="n">segments</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="p">)</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="n">utterances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_utterances</span><span class="p">(</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>            <span class="n">segments_with_speaker_mapping</span><span class="p">,</span> <span class="n">word_timestamps</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="p">)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="k">return</span> <span class="n">utterances</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="k">def</span> <span class="nf">multi_channel_speaker_mapping</span><span class="p">(</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">multi_channel_segments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MultiChannelTranscriptionOutput</span><span class="p">]</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TranscriptionOutput</span><span class="p">:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        Run the multi-channel post-processing functions on the inputs by merging the segments based on the timestamps.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            multi_channel_segments (List[MultiChannelTranscriptionOutput]):</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">                List of segments from multi speakers.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">            TranscriptionOutput: List of sentences with speaker mapping.</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="n">words_with_speaker_mapping</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">speaker</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">multi_channel_segments</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">segments</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">segment</span><span class="o">.</span><span class="n">words</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="p">]</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="n">words_with_speaker_mapping</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="n">utterances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_multi_channel_utterances</span><span class="p">(</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="n">words_with_speaker_mapping</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="k">return</span> <span class="n">utterances</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="k">def</span> <span class="nf">segments_speaker_mapping</span><span class="p">(</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="n">transcript_segments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">],</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="n">speaker_timestamps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DiarizationSegment</span><span class="p">],</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to map transcription and diarization results.</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">        Map each segment to its corresponding speaker based on the speaker timestamps and reconstruct the utterances</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        when the speaker changes in the middle of a segment.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">            transcript_segments (List[dict]): List of transcript segments.</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">            speaker_timestamps (List[dict]): List of speaker timestamps.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">            List[dict]: List of sentences with speaker mapping.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="k">def</span> <span class="nf">_assign_speaker</span><span class="p">(</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">mapping</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="n">seg_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>            <span class="n">split</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="n">current_speaker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="n">current_split_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="p">):</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Assign speaker to the segment.&quot;&quot;&quot;</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="k">if</span> <span class="n">split</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>                <span class="n">last_split_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mapping</span><span class="p">[</span><span class="n">seg_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>                <span class="k">if</span> <span class="n">last_split_len</span> <span class="o">&gt;</span> <span class="n">current_split_len</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>                    <span class="n">current_speaker</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">seg_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">speaker</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>                <span class="k">elif</span> <span class="n">last_split_len</span> <span class="o">&lt;</span> <span class="n">current_split_len</span><span class="p">:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>                    <span class="n">mapping</span><span class="p">[</span><span class="n">seg_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">speaker</span> <span class="o">=</span> <span class="n">current_speaker</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="k">return</span> <span class="n">current_speaker</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.3</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="n">turn_idx</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">was_split</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span> <span class="o">=</span> <span class="n">speaker_timestamps</span><span class="p">[</span><span class="n">turn_idx</span><span class="p">]</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">segment_index</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="n">segment_speaker_mapping</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="k">while</span> <span class="n">segment_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">transcript_segments</span><span class="p">):</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="n">segment</span><span class="p">:</span> <span class="n">Utterance</span> <span class="o">=</span> <span class="n">transcript_segments</span><span class="p">[</span><span class="n">segment_index</span><span class="p">]</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="n">segment_start</span><span class="p">,</span> <span class="n">segment_end</span><span class="p">,</span> <span class="n">segment_text</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>                <span class="n">segment</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>                <span class="n">segment</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>                <span class="n">segment</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>            <span class="p">)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="k">while</span> <span class="p">(</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                <span class="n">segment_start</span> <span class="o">&gt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">segment_start</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">end</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">threshold</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="p">):</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                <span class="n">turn_idx</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                <span class="n">turn_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">turn_idx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">speaker_timestamps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="n">_</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span> <span class="o">=</span> <span class="n">speaker_timestamps</span><span class="p">[</span><span class="n">turn_idx</span><span class="p">]</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>                <span class="k">if</span> <span class="n">turn_idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">speaker_timestamps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                    <span class="n">end</span> <span class="o">=</span> <span class="n">segment_end</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                    <span class="k">break</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="k">if</span> <span class="n">segment_end</span> <span class="o">&gt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">end</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">segment_end</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">end</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                <span class="n">words</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">words</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                <span class="n">word_index</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                    <span class="p">(</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>                        <span class="n">i</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>                        <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">start</span> <span class="o">&gt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>                        <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">end</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">threshold</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                    <span class="p">),</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                    <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                <span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>                <span class="k">if</span> <span class="n">word_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>                    <span class="n">_split_segment</span> <span class="o">=</span> <span class="n">segment_text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>                    <span class="k">if</span> <span class="n">word_index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_split_segment</span><span class="p">[:</span><span class="n">word_index</span><span class="p">])</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>                        <span class="n">speaker</span> <span class="o">=</span> <span class="n">_assign_speaker</span><span class="p">(</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>                            <span class="n">segment_speaker_mapping</span><span class="p">,</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>                            <span class="n">segment_index</span><span class="p">,</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>                            <span class="n">was_split</span><span class="p">,</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>                            <span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>                            <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>                        <span class="p">)</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>                        <span class="n">_segment_to_add</span> <span class="o">=</span> <span class="n">Utterance</span><span class="p">(</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>                            <span class="n">start</span><span class="o">=</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>                            <span class="n">end</span><span class="o">=</span><span class="n">words</span><span class="p">[</span><span class="n">word_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>                            <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>                            <span class="n">speaker</span><span class="o">=</span><span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>                            <span class="n">words</span><span class="o">=</span><span class="n">words</span><span class="p">[:</span><span class="n">word_index</span><span class="p">],</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>                        <span class="p">)</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>                        <span class="n">text</span> <span class="o">=</span> <span class="n">_split_segment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>                        <span class="n">speaker</span> <span class="o">=</span> <span class="n">_assign_speaker</span><span class="p">(</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>                            <span class="n">segment_speaker_mapping</span><span class="p">,</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>                            <span class="n">segment_index</span><span class="p">,</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>                            <span class="n">was_split</span><span class="p">,</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>                            <span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>                            <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                        <span class="p">)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>                        <span class="n">_segment_to_add</span> <span class="o">=</span> <span class="n">Utterance</span><span class="p">(</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                            <span class="n">start</span><span class="o">=</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>                            <span class="n">end</span><span class="o">=</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>                            <span class="n">text</span><span class="o">=</span><span class="n">_split_segment</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                            <span class="n">speaker</span><span class="o">=</span><span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                            <span class="n">words</span><span class="o">=</span><span class="n">words</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>                        <span class="p">)</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>                    <span class="n">segment_speaker_mapping</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_segment_to_add</span><span class="p">)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>                    <span class="n">transcript_segments</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                        <span class="n">segment_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>                        <span class="n">Utterance</span><span class="p">(</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>                            <span class="n">start</span><span class="o">=</span><span class="n">words</span><span class="p">[</span><span class="n">word_index</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>                            <span class="n">end</span><span class="o">=</span><span class="n">segment_end</span><span class="p">,</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>                            <span class="n">text</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_split_segment</span><span class="p">[</span><span class="n">word_index</span><span class="p">:]),</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>                            <span class="n">words</span><span class="o">=</span><span class="n">words</span><span class="p">[</span><span class="n">word_index</span><span class="p">:],</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>                        <span class="p">),</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>                    <span class="p">)</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>                    <span class="n">was_split</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>                    <span class="n">speaker</span> <span class="o">=</span> <span class="n">_assign_speaker</span><span class="p">(</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>                        <span class="n">segment_speaker_mapping</span><span class="p">,</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>                        <span class="n">segment_index</span><span class="p">,</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>                        <span class="n">was_split</span><span class="p">,</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>                        <span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                        <span class="nb">len</span><span class="p">(</span><span class="n">segment_text</span><span class="p">),</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>                    <span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>                    <span class="n">was_split</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>                    <span class="n">segment_speaker_mapping</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>                        <span class="n">Utterance</span><span class="p">(</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>                            <span class="n">start</span><span class="o">=</span><span class="n">segment_start</span><span class="p">,</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>                            <span class="n">end</span><span class="o">=</span><span class="n">segment_end</span><span class="p">,</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>                            <span class="n">text</span><span class="o">=</span><span class="n">segment_text</span><span class="p">,</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>                            <span class="n">speaker</span><span class="o">=</span><span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>                            <span class="n">words</span><span class="o">=</span><span class="n">words</span><span class="p">,</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                        <span class="p">)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>                    <span class="p">)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>                <span class="n">speaker</span> <span class="o">=</span> <span class="n">_assign_speaker</span><span class="p">(</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>                    <span class="n">segment_speaker_mapping</span><span class="p">,</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>                    <span class="n">segment_index</span><span class="p">,</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>                    <span class="n">was_split</span><span class="p">,</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>                    <span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">segment_text</span><span class="p">),</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>                <span class="p">)</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>                <span class="n">was_split</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>                <span class="n">segment_speaker_mapping</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>                    <span class="n">Utterance</span><span class="p">(</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                        <span class="n">start</span><span class="o">=</span><span class="n">segment_start</span><span class="p">,</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>                        <span class="n">end</span><span class="o">=</span><span class="n">segment_end</span><span class="p">,</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>                        <span class="n">text</span><span class="o">=</span><span class="n">segment_text</span><span class="p">,</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>                        <span class="n">speaker</span><span class="o">=</span><span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>                        <span class="n">words</span><span class="o">=</span><span class="n">segment</span><span class="o">.</span><span class="n">words</span><span class="p">,</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>                    <span class="p">)</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>                <span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="n">segment_index</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="k">return</span> <span class="n">segment_speaker_mapping</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>    <span class="k">def</span> <span class="nf">reconstruct_utterances</span><span class="p">(</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="n">transcript_segments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">],</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="n">word_timestamps</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">]:</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">        Reconstruct the utterances based on the speaker mapping.</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">            transcript_words (List[Utterance]):</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">                List of transcript segments.</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">            word_timestamps (bool):</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">                Whether to include word timestamps.</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">            List[Utterance]:</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">                List of sentences with speaker mapping.</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="n">start_t0</span><span class="p">,</span> <span class="n">end_t0</span><span class="p">,</span> <span class="n">speaker_t0</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>            <span class="n">transcript_segments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>            <span class="n">transcript_segments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="n">transcript_segments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="p">)</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="n">previous_speaker</span> <span class="o">=</span> <span class="n">speaker_t0</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="n">current_sentence</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>            <span class="s2">&quot;speaker&quot;</span><span class="p">:</span> <span class="n">speaker_t0</span><span class="p">,</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start_t0</span><span class="p">,</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>            <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">end_t0</span><span class="p">,</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="p">}</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="k">if</span> <span class="n">word_timestamps</span><span class="p">:</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>            <span class="n">current_sentence</span><span class="p">[</span><span class="s2">&quot;words&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="n">sentences</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">transcript_segments</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>            <span class="n">text</span><span class="p">,</span> <span class="n">speaker</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">segment</span><span class="o">.</span><span class="n">speaker</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="n">start_t</span><span class="p">,</span> <span class="n">end_t</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">segment</span><span class="o">.</span><span class="n">end</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>            <span class="k">if</span> <span class="n">speaker</span> <span class="o">!=</span> <span class="n">previous_speaker</span><span class="p">:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>                <span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Utterance</span><span class="p">(</span><span class="o">**</span><span class="n">current_sentence</span><span class="p">))</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>                <span class="n">current_sentence</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>                    <span class="s2">&quot;speaker&quot;</span><span class="p">:</span> <span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>                    <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start_t</span><span class="p">,</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>                    <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">end_t</span><span class="p">,</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>                    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>                <span class="p">}</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>                <span class="k">if</span> <span class="n">word_timestamps</span><span class="p">:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>                    <span class="n">current_sentence</span><span class="p">[</span><span class="s2">&quot;words&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                <span class="n">current_sentence</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_t</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>            <span class="n">current_sentence</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">text</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="n">previous_speaker</span> <span class="o">=</span> <span class="n">speaker</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>            <span class="k">if</span> <span class="n">word_timestamps</span><span class="p">:</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>                <span class="n">current_sentence</span><span class="p">[</span><span class="s2">&quot;words&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">words</span><span class="p">)</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="c1"># Catch the last sentence</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Utterance</span><span class="p">(</span><span class="o">**</span><span class="n">current_sentence</span><span class="p">))</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="k">return</span> <span class="n">sentences</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>    <span class="k">def</span> <span class="nf">reconstruct_multi_channel_utterances</span><span class="p">(</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="n">transcript_words</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Word</span><span class="p">]],</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">]:</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">        Reconstruct multi-channel utterances based on the speaker mapping.</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">            transcript_words (List[Tuple[int, Word]]):</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">                List of tuples containing the speaker and the word.</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">            List[Utterance]: List of sentences with speaker mapping.</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="n">speaker_t0</span><span class="p">,</span> <span class="n">word</span> <span class="o">=</span> <span class="n">transcript_words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="n">start_t0</span><span class="p">,</span> <span class="n">end_t0</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">word</span><span class="o">.</span><span class="n">end</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="n">previous_speaker</span> <span class="o">=</span> <span class="n">speaker_t0</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>        <span class="n">current_sentence</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>            <span class="s2">&quot;speaker&quot;</span><span class="p">:</span> <span class="n">speaker_t0</span><span class="p">,</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start_t0</span><span class="p">,</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>            <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">end_t0</span><span class="p">,</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>            <span class="s2">&quot;words&quot;</span><span class="p">:</span> <span class="p">[],</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="p">}</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="n">sentences</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="k">for</span> <span class="n">speaker</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">transcript_words</span><span class="p">:</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>            <span class="n">start_t</span><span class="p">,</span> <span class="n">end_t</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">word</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">word</span><span class="o">.</span><span class="n">word</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>            <span class="k">if</span> <span class="n">speaker</span> <span class="o">!=</span> <span class="n">previous_speaker</span><span class="p">:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>                <span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_sentence</span><span class="p">)</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>                <span class="n">current_sentence</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                    <span class="s2">&quot;speaker&quot;</span><span class="p">:</span> <span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                    <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start_t</span><span class="p">,</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                    <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">end_t</span><span class="p">,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                <span class="p">}</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>                <span class="n">current_sentence</span><span class="p">[</span><span class="s2">&quot;words&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>                <span class="n">current_sentence</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_t</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>            <span class="n">current_sentence</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">text</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>            <span class="n">previous_speaker</span> <span class="o">=</span> <span class="n">speaker</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>            <span class="n">current_sentence</span><span class="p">[</span><span class="s2">&quot;words&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="c1"># Catch the last sentence</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>        <span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_sentence</span><span class="p">)</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">:</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>            <span class="n">sentence</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span class="k">return</span> <span class="p">[</span><span class="n">Utterance</span><span class="p">(</span><span class="o">**</span><span class="n">sentence</span><span class="p">)</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">]</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>    <span class="k">def</span> <span class="nf">final_processing_before_returning</span><span class="p">(</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="n">utterances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">],</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="n">offset_start</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>        <span class="n">timestamps_format</span><span class="p">:</span> <span class="n">Timestamps</span><span class="p">,</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>        <span class="n">word_timestamps</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">]:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">        Do final processing before returning the utterances to the API.</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">            utterances (List[Utterance]):</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">                List of utterances.</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">            offset_start (Union[float, None]):</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">                Offset start.</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">            timestamps_format (Timestamps):</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">                Timestamps format. Can be `s`, `ms`, or `hms`.</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">            word_timestamps (bool):</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">                Whether to include word timestamps.</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">            List[Utterance]:</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">                List of utterances after final processing.</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>        <span class="k">if</span> <span class="n">offset_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>            <span class="n">offset_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">offset_start</span><span class="p">)</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>            <span class="n">offset_start</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>        <span class="n">final_utterances</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="k">for</span> <span class="n">utterance</span> <span class="ow">in</span> <span class="n">utterances</span><span class="p">:</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>            <span class="c1"># Check if the utterance is not empty</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>            <span class="k">if</span> <span class="n">utterance</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>                <span class="n">utterance</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">format_punct</span><span class="p">(</span><span class="n">utterance</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>                <span class="n">utterance</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">convert_timestamp</span><span class="p">(</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>                    <span class="p">(</span><span class="n">utterance</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="n">offset_start</span><span class="p">),</span> <span class="n">timestamps_format</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>                <span class="p">)</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>                <span class="n">utterance</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">convert_timestamp</span><span class="p">(</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>                    <span class="p">(</span><span class="n">utterance</span><span class="o">.</span><span class="n">end</span> <span class="o">+</span> <span class="n">offset_start</span><span class="p">),</span> <span class="n">timestamps_format</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>                <span class="p">)</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>                <span class="n">utterance</span><span class="o">.</span><span class="n">words</span> <span class="o">=</span> <span class="n">utterance</span><span class="o">.</span><span class="n">words</span> <span class="k">if</span> <span class="n">word_timestamps</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>                <span class="n">final_utterances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">utterance</span><span class="p">)</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>        <span class="k">return</span> <span class="n">final_utterances</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.post_processing_service.PostProcessingService.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize the PostProcessingService.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/post_processing_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the PostProcessingService.&quot;&quot;&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sample_rate</span> <span class="o">=</span> <span class="mi">16000</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.post_processing_service.PostProcessingService.final_processing_before_returning" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">final_processing_before_returning</span><span class="p">(</span><span class="n">utterances</span><span class="p">,</span> <span class="n">offset_start</span><span class="p">,</span> <span class="n">timestamps_format</span><span class="p">,</span> <span class="n">word_timestamps</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Do final processing before returning the utterances to the API.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>utterances</code></td>
          <td>
                <code><span title="typing.List">List</span>[<span title="wordcab_transcribe.models.Utterance">Utterance</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of utterances.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>offset_start</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[float, None]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Offset start.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>timestamps_format</code></td>
          <td>
                <code><span title="wordcab_transcribe.models.Timestamps">Timestamps</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Timestamps format. Can be <code>s</code>, <code>ms</code>, or <code>hms</code>.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>word_timestamps</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to include word timestamps.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[<span title="wordcab_transcribe.models.Utterance">Utterance</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List[Utterance]:
List of utterances after final processing.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/post_processing_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="k">def</span> <span class="nf">final_processing_before_returning</span><span class="p">(</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>    <span class="n">utterances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">],</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>    <span class="n">offset_start</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>    <span class="n">timestamps_format</span><span class="p">:</span> <span class="n">Timestamps</span><span class="p">,</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>    <span class="n">word_timestamps</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">]:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">    Do final processing before returning the utterances to the API.</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">        utterances (List[Utterance]):</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">            List of utterances.</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">        offset_start (Union[float, None]):</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">            Offset start.</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">        timestamps_format (Timestamps):</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">            Timestamps format. Can be `s`, `ms`, or `hms`.</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">        word_timestamps (bool):</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">            Whether to include word timestamps.</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">        List[Utterance]:</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">            List of utterances after final processing.</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>    <span class="k">if</span> <span class="n">offset_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>        <span class="n">offset_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">offset_start</span><span class="p">)</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>        <span class="n">offset_start</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>    <span class="n">final_utterances</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>    <span class="k">for</span> <span class="n">utterance</span> <span class="ow">in</span> <span class="n">utterances</span><span class="p">:</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="c1"># Check if the utterance is not empty</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>        <span class="k">if</span> <span class="n">utterance</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>            <span class="n">utterance</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">format_punct</span><span class="p">(</span><span class="n">utterance</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>            <span class="n">utterance</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">convert_timestamp</span><span class="p">(</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>                <span class="p">(</span><span class="n">utterance</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="n">offset_start</span><span class="p">),</span> <span class="n">timestamps_format</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>            <span class="p">)</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>            <span class="n">utterance</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">convert_timestamp</span><span class="p">(</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>                <span class="p">(</span><span class="n">utterance</span><span class="o">.</span><span class="n">end</span> <span class="o">+</span> <span class="n">offset_start</span><span class="p">),</span> <span class="n">timestamps_format</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>            <span class="p">)</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>            <span class="n">utterance</span><span class="o">.</span><span class="n">words</span> <span class="o">=</span> <span class="n">utterance</span><span class="o">.</span><span class="n">words</span> <span class="k">if</span> <span class="n">word_timestamps</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>            <span class="n">final_utterances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">utterance</span><span class="p">)</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>    <span class="k">return</span> <span class="n">final_utterances</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.post_processing_service.PostProcessingService.multi_channel_speaker_mapping" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">multi_channel_speaker_mapping</span><span class="p">(</span><span class="n">multi_channel_segments</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Run the multi-channel post-processing functions on the inputs by merging the segments based on the timestamps.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>multi_channel_segments</code></td>
          <td>
                <code><span title="typing.List">List</span>[<span title="wordcab_transcribe.models.MultiChannelTranscriptionOutput">MultiChannelTranscriptionOutput</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of segments from multi speakers.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>TranscriptionOutput</code></td>          <td>
                <code><span title="wordcab_transcribe.models.TranscriptionOutput">TranscriptionOutput</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of sentences with speaker mapping.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/post_processing_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span> <span class="nf">multi_channel_speaker_mapping</span><span class="p">(</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">multi_channel_segments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MultiChannelTranscriptionOutput</span><span class="p">]</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TranscriptionOutput</span><span class="p">:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    Run the multi-channel post-processing functions on the inputs by merging the segments based on the timestamps.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        multi_channel_segments (List[MultiChannelTranscriptionOutput]):</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">            List of segments from multi speakers.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">        TranscriptionOutput: List of sentences with speaker mapping.</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="n">words_with_speaker_mapping</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">speaker</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">multi_channel_segments</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">segments</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">segment</span><span class="o">.</span><span class="n">words</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="p">]</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">words_with_speaker_mapping</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">utterances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_multi_channel_utterances</span><span class="p">(</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="n">words_with_speaker_mapping</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="k">return</span> <span class="n">utterances</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.post_processing_service.PostProcessingService.reconstruct_multi_channel_utterances" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">reconstruct_multi_channel_utterances</span><span class="p">(</span><span class="n">transcript_words</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Reconstruct multi-channel utterances based on the speaker mapping.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>transcript_words</code></td>
          <td>
                <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, <span title="wordcab_transcribe.models.Word">Word</span>]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of tuples containing the speaker and the word.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[<span title="wordcab_transcribe.models.Utterance">Utterance</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List[Utterance]: List of sentences with speaker mapping.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/post_processing_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="k">def</span> <span class="nf">reconstruct_multi_channel_utterances</span><span class="p">(</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>    <span class="n">transcript_words</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Word</span><span class="p">]],</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">]:</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">    Reconstruct multi-channel utterances based on the speaker mapping.</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">        transcript_words (List[Tuple[int, Word]]):</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">            List of tuples containing the speaker and the word.</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">        List[Utterance]: List of sentences with speaker mapping.</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="n">speaker_t0</span><span class="p">,</span> <span class="n">word</span> <span class="o">=</span> <span class="n">transcript_words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="n">start_t0</span><span class="p">,</span> <span class="n">end_t0</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">word</span><span class="o">.</span><span class="n">end</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>    <span class="n">previous_speaker</span> <span class="o">=</span> <span class="n">speaker_t0</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="n">current_sentence</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="s2">&quot;speaker&quot;</span><span class="p">:</span> <span class="n">speaker_t0</span><span class="p">,</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start_t0</span><span class="p">,</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">end_t0</span><span class="p">,</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="s2">&quot;words&quot;</span><span class="p">:</span> <span class="p">[],</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>    <span class="p">}</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>    <span class="n">sentences</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>    <span class="k">for</span> <span class="n">speaker</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">transcript_words</span><span class="p">:</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="n">start_t</span><span class="p">,</span> <span class="n">end_t</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">word</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">word</span><span class="o">.</span><span class="n">word</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="k">if</span> <span class="n">speaker</span> <span class="o">!=</span> <span class="n">previous_speaker</span><span class="p">:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_sentence</span><span class="p">)</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="n">current_sentence</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                <span class="s2">&quot;speaker&quot;</span><span class="p">:</span> <span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start_t</span><span class="p">,</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">end_t</span><span class="p">,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="p">}</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>            <span class="n">current_sentence</span><span class="p">[</span><span class="s2">&quot;words&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>            <span class="n">current_sentence</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_t</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="n">current_sentence</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">text</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="n">previous_speaker</span> <span class="o">=</span> <span class="n">speaker</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="n">current_sentence</span><span class="p">[</span><span class="s2">&quot;words&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="c1"># Catch the last sentence</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_sentence</span><span class="p">)</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>    <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">:</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>        <span class="n">sentence</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">Utterance</span><span class="p">(</span><span class="o">**</span><span class="n">sentence</span><span class="p">)</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.post_processing_service.PostProcessingService.reconstruct_utterances" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">reconstruct_utterances</span><span class="p">(</span><span class="n">transcript_segments</span><span class="p">,</span> <span class="n">word_timestamps</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Reconstruct the utterances based on the speaker mapping.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>transcript_words</code></td>
          <td>
                <code><span title="typing.List">List</span>[<span title="wordcab_transcribe.models.Utterance">Utterance</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of transcript segments.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>word_timestamps</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to include word timestamps.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[<span title="wordcab_transcribe.models.Utterance">Utterance</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List[Utterance]:
List of sentences with speaker mapping.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/post_processing_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="k">def</span> <span class="nf">reconstruct_utterances</span><span class="p">(</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>    <span class="n">transcript_segments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">],</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="n">word_timestamps</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">]:</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">    Reconstruct the utterances based on the speaker mapping.</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">        transcript_words (List[Utterance]):</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">            List of transcript segments.</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">        word_timestamps (bool):</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">            Whether to include word timestamps.</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">        List[Utterance]:</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">            List of sentences with speaker mapping.</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>    <span class="n">start_t0</span><span class="p">,</span> <span class="n">end_t0</span><span class="p">,</span> <span class="n">speaker_t0</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="n">transcript_segments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="n">transcript_segments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>        <span class="n">transcript_segments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>    <span class="p">)</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>    <span class="n">previous_speaker</span> <span class="o">=</span> <span class="n">speaker_t0</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>    <span class="n">current_sentence</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="s2">&quot;speaker&quot;</span><span class="p">:</span> <span class="n">speaker_t0</span><span class="p">,</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start_t0</span><span class="p">,</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">end_t0</span><span class="p">,</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="p">}</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>    <span class="k">if</span> <span class="n">word_timestamps</span><span class="p">:</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="n">current_sentence</span><span class="p">[</span><span class="s2">&quot;words&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>    <span class="n">sentences</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">transcript_segments</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="n">text</span><span class="p">,</span> <span class="n">speaker</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">segment</span><span class="o">.</span><span class="n">speaker</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="n">start_t</span><span class="p">,</span> <span class="n">end_t</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">segment</span><span class="o">.</span><span class="n">end</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="k">if</span> <span class="n">speaker</span> <span class="o">!=</span> <span class="n">previous_speaker</span><span class="p">:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Utterance</span><span class="p">(</span><span class="o">**</span><span class="n">current_sentence</span><span class="p">))</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>            <span class="n">current_sentence</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>                <span class="s2">&quot;speaker&quot;</span><span class="p">:</span> <span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>                <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start_t</span><span class="p">,</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>                <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">end_t</span><span class="p">,</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>            <span class="p">}</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>            <span class="k">if</span> <span class="n">word_timestamps</span><span class="p">:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>                <span class="n">current_sentence</span><span class="p">[</span><span class="s2">&quot;words&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>            <span class="n">current_sentence</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_t</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="n">current_sentence</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">text</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="n">previous_speaker</span> <span class="o">=</span> <span class="n">speaker</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="k">if</span> <span class="n">word_timestamps</span><span class="p">:</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>            <span class="n">current_sentence</span><span class="p">[</span><span class="s2">&quot;words&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">words</span><span class="p">)</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>    <span class="c1"># Catch the last sentence</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Utterance</span><span class="p">(</span><span class="o">**</span><span class="n">current_sentence</span><span class="p">))</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>    <span class="k">return</span> <span class="n">sentences</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.post_processing_service.PostProcessingService.segments_speaker_mapping" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">segments_speaker_mapping</span><span class="p">(</span><span class="n">transcript_segments</span><span class="p">,</span> <span class="n">speaker_timestamps</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Function to map transcription and diarization results.</p>
<p>Map each segment to its corresponding speaker based on the speaker timestamps and reconstruct the utterances
when the speaker changes in the middle of a segment.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>transcript_segments</code></td>
          <td>
                <code><span title="typing.List">List</span>[dict]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of transcript segments.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>speaker_timestamps</code></td>
          <td>
                <code><span title="typing.List">List</span>[dict]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of speaker timestamps.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[dict]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List[dict]: List of sentences with speaker mapping.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/post_processing_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="k">def</span> <span class="nf">segments_speaker_mapping</span><span class="p">(</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="n">transcript_segments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">],</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="n">speaker_timestamps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DiarizationSegment</span><span class="p">],</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to map transcription and diarization results.</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    Map each segment to its corresponding speaker based on the speaker timestamps and reconstruct the utterances</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    when the speaker changes in the middle of a segment.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">        transcript_segments (List[dict]): List of transcript segments.</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        speaker_timestamps (List[dict]): List of speaker timestamps.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">        List[dict]: List of sentences with speaker mapping.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="k">def</span> <span class="nf">_assign_speaker</span><span class="p">(</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="n">mapping</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="n">seg_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="n">split</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">current_speaker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="n">current_split_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="p">):</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign speaker to the segment.&quot;&quot;&quot;</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="k">if</span> <span class="n">split</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>            <span class="n">last_split_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mapping</span><span class="p">[</span><span class="n">seg_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="k">if</span> <span class="n">last_split_len</span> <span class="o">&gt;</span> <span class="n">current_split_len</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>                <span class="n">current_speaker</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">seg_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">speaker</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="k">elif</span> <span class="n">last_split_len</span> <span class="o">&lt;</span> <span class="n">current_split_len</span><span class="p">:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>                <span class="n">mapping</span><span class="p">[</span><span class="n">seg_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">speaker</span> <span class="o">=</span> <span class="n">current_speaker</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="k">return</span> <span class="n">current_speaker</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.3</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="n">turn_idx</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="n">was_split</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="n">_</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span> <span class="o">=</span> <span class="n">speaker_timestamps</span><span class="p">[</span><span class="n">turn_idx</span><span class="p">]</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="n">segment_index</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="n">segment_speaker_mapping</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="k">while</span> <span class="n">segment_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">transcript_segments</span><span class="p">):</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="n">segment</span><span class="p">:</span> <span class="n">Utterance</span> <span class="o">=</span> <span class="n">transcript_segments</span><span class="p">[</span><span class="n">segment_index</span><span class="p">]</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="n">segment_start</span><span class="p">,</span> <span class="n">segment_end</span><span class="p">,</span> <span class="n">segment_text</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="n">segment</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="n">segment</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="n">segment</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="p">)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="k">while</span> <span class="p">(</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="n">segment_start</span> <span class="o">&gt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">segment_start</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">end</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">threshold</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="p">):</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="n">turn_idx</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="n">turn_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">turn_idx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">speaker_timestamps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>            <span class="n">_</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">speaker</span> <span class="o">=</span> <span class="n">speaker_timestamps</span><span class="p">[</span><span class="n">turn_idx</span><span class="p">]</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="k">if</span> <span class="n">turn_idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">speaker_timestamps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                <span class="n">end</span> <span class="o">=</span> <span class="n">segment_end</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                <span class="k">break</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="k">if</span> <span class="n">segment_end</span> <span class="o">&gt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">end</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">segment_end</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">end</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="n">words</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">words</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="n">word_index</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                <span class="p">(</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>                    <span class="n">i</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>                    <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">start</span> <span class="o">&gt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>                    <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">end</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">threshold</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                <span class="p">),</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="k">if</span> <span class="n">word_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>                <span class="n">_split_segment</span> <span class="o">=</span> <span class="n">segment_text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>                <span class="k">if</span> <span class="n">word_index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_split_segment</span><span class="p">[:</span><span class="n">word_index</span><span class="p">])</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>                    <span class="n">speaker</span> <span class="o">=</span> <span class="n">_assign_speaker</span><span class="p">(</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>                        <span class="n">segment_speaker_mapping</span><span class="p">,</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>                        <span class="n">segment_index</span><span class="p">,</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>                        <span class="n">was_split</span><span class="p">,</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>                        <span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>                        <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>                    <span class="p">)</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>                    <span class="n">_segment_to_add</span> <span class="o">=</span> <span class="n">Utterance</span><span class="p">(</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>                        <span class="n">start</span><span class="o">=</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>                        <span class="n">end</span><span class="o">=</span><span class="n">words</span><span class="p">[</span><span class="n">word_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>                        <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>                        <span class="n">speaker</span><span class="o">=</span><span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>                        <span class="n">words</span><span class="o">=</span><span class="n">words</span><span class="p">[:</span><span class="n">word_index</span><span class="p">],</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>                    <span class="p">)</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>                    <span class="n">text</span> <span class="o">=</span> <span class="n">_split_segment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>                    <span class="n">speaker</span> <span class="o">=</span> <span class="n">_assign_speaker</span><span class="p">(</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>                        <span class="n">segment_speaker_mapping</span><span class="p">,</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>                        <span class="n">segment_index</span><span class="p">,</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>                        <span class="n">was_split</span><span class="p">,</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>                        <span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>                        <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                    <span class="p">)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>                    <span class="n">_segment_to_add</span> <span class="o">=</span> <span class="n">Utterance</span><span class="p">(</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                        <span class="n">start</span><span class="o">=</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>                        <span class="n">end</span><span class="o">=</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>                        <span class="n">text</span><span class="o">=</span><span class="n">_split_segment</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                        <span class="n">speaker</span><span class="o">=</span><span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                        <span class="n">words</span><span class="o">=</span><span class="n">words</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>                    <span class="p">)</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>                <span class="n">segment_speaker_mapping</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_segment_to_add</span><span class="p">)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>                <span class="n">transcript_segments</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                    <span class="n">segment_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>                    <span class="n">Utterance</span><span class="p">(</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>                        <span class="n">start</span><span class="o">=</span><span class="n">words</span><span class="p">[</span><span class="n">word_index</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>                        <span class="n">end</span><span class="o">=</span><span class="n">segment_end</span><span class="p">,</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>                        <span class="n">text</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_split_segment</span><span class="p">[</span><span class="n">word_index</span><span class="p">:]),</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>                        <span class="n">words</span><span class="o">=</span><span class="n">words</span><span class="p">[</span><span class="n">word_index</span><span class="p">:],</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>                    <span class="p">),</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>                <span class="p">)</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>                <span class="n">was_split</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>                <span class="n">speaker</span> <span class="o">=</span> <span class="n">_assign_speaker</span><span class="p">(</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>                    <span class="n">segment_speaker_mapping</span><span class="p">,</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>                    <span class="n">segment_index</span><span class="p">,</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>                    <span class="n">was_split</span><span class="p">,</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>                    <span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">segment_text</span><span class="p">),</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>                <span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>                <span class="n">was_split</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>                <span class="n">segment_speaker_mapping</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>                    <span class="n">Utterance</span><span class="p">(</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>                        <span class="n">start</span><span class="o">=</span><span class="n">segment_start</span><span class="p">,</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>                        <span class="n">end</span><span class="o">=</span><span class="n">segment_end</span><span class="p">,</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>                        <span class="n">text</span><span class="o">=</span><span class="n">segment_text</span><span class="p">,</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>                        <span class="n">speaker</span><span class="o">=</span><span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>                        <span class="n">words</span><span class="o">=</span><span class="n">words</span><span class="p">,</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                    <span class="p">)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>                <span class="p">)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>            <span class="n">speaker</span> <span class="o">=</span> <span class="n">_assign_speaker</span><span class="p">(</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>                <span class="n">segment_speaker_mapping</span><span class="p">,</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>                <span class="n">segment_index</span><span class="p">,</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>                <span class="n">was_split</span><span class="p">,</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>                <span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>                <span class="nb">len</span><span class="p">(</span><span class="n">segment_text</span><span class="p">),</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>            <span class="p">)</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="n">was_split</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>            <span class="n">segment_speaker_mapping</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>                <span class="n">Utterance</span><span class="p">(</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                    <span class="n">start</span><span class="o">=</span><span class="n">segment_start</span><span class="p">,</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>                    <span class="n">end</span><span class="o">=</span><span class="n">segment_end</span><span class="p">,</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>                    <span class="n">text</span><span class="o">=</span><span class="n">segment_text</span><span class="p">,</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>                    <span class="n">speaker</span><span class="o">=</span><span class="n">speaker</span><span class="p">,</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>                    <span class="n">words</span><span class="o">=</span><span class="n">segment</span><span class="o">.</span><span class="n">words</span><span class="p">,</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>                <span class="p">)</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="n">segment_index</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="k">return</span> <span class="n">segment_speaker_mapping</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.post_processing_service.PostProcessingService.single_channel_speaker_mapping" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">single_channel_speaker_mapping</span><span class="p">(</span><span class="n">transcript_segments</span><span class="p">,</span> <span class="n">speaker_timestamps</span><span class="p">,</span> <span class="n">word_timestamps</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Run the post-processing functions on the inputs.</p>
<p>The postprocessing pipeline is as follows:
1. Map each transcript segment to its corresponding speaker.
2. Group utterances of the same speaker together.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>transcript_segments</code></td>
          <td>
                <code><span title="typing.List">List</span>[<span title="wordcab_transcribe.models.Utterance">Utterance</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of transcript utterances.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>speaker_timestamps</code></td>
          <td>
                <code><span title="wordcab_transcribe.models.DiarizationOutput">DiarizationOutput</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of speaker timestamps.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>word_timestamps</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to include word timestamps.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[<span title="wordcab_transcribe.models.Utterance">Utterance</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List[Utterance]:
List of utterances with speaker mapping.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/post_processing_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="k">def</span> <span class="nf">single_channel_speaker_mapping</span><span class="p">(</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="n">transcript_segments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">],</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="n">speaker_timestamps</span><span class="p">:</span> <span class="n">DiarizationOutput</span><span class="p">,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="n">word_timestamps</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">]:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the post-processing functions on the inputs.</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    The postprocessing pipeline is as follows:</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    1. Map each transcript segment to its corresponding speaker.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    2. Group utterances of the same speaker together.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        transcript_segments (List[Utterance]):</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">            List of transcript utterances.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        speaker_timestamps (DiarizationOutput):</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">            List of speaker timestamps.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        word_timestamps (bool):</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">            Whether to include word timestamps.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        List[Utterance]:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">            List of utterances with speaker mapping.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">segments_with_speaker_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segments_speaker_mapping</span><span class="p">(</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="n">transcript_segments</span><span class="p">,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">speaker_timestamps</span><span class="o">.</span><span class="n">segments</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="p">)</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">utterances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_utterances</span><span class="p">(</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="n">segments_with_speaker_mapping</span><span class="p">,</span> <span class="n">word_timestamps</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="p">)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="k">return</span> <span class="n">utterances</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">




  <div class="doc doc-contents first">
  
      <p>Transcribe Service for audio files.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.transcribe_service.FasterWhisperModel" class="doc doc-heading">
          <code>FasterWhisperModel</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="typing.NamedTuple">NamedTuple</span></code></p>

  
      <p>Faster Whisper Model.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/transcribe_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="k">class</span> <span class="nc">FasterWhisperModel</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Faster Whisper Model.&quot;&quot;&quot;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="n">model</span><span class="p">:</span> <span class="n">WhisperModel</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="n">lang</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.transcribe_service.TranscribeService" class="doc doc-heading">
          <code>TranscribeService</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Transcribe Service for audio files.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/transcribe_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="k">class</span> <span class="nc">TranscribeService</span><span class="p">:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Transcribe Service for audio files.&quot;&quot;&quot;</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="n">model_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="n">compute_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="n">device</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="n">device_index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="n">extra_languages</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="n">extra_languages_model_paths</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the Transcribe Service.</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        This service uses the WhisperModel from faster-whisper to transcribe audio files.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">            model_path (str):</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">                Path to the model checkpoint. This can be a local path or a URL.</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">            compute_type (str):</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">                Compute type to use for inference. Can be &quot;int8&quot;, &quot;int8_float16&quot;, &quot;int16&quot; or &quot;float_16&quot;.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">            device (str):</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">                Device to use for inference. Can be &quot;cpu&quot; or &quot;cuda&quot;.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">            device_index (Union[int, List[int]]):</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">                Index of the device to use for inference.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">            extra_languages (Union[List[str], None]):</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">                List of extra languages to transcribe. Defaults to None.</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">            extra_languages_model_paths (Union[List[str], None]):</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">                List of paths to the extra language models. Defaults to None.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">compute_type</span> <span class="o">=</span> <span class="n">compute_type</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span> <span class="o">=</span> <span class="n">model_path</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">WhisperModel</span><span class="p">(</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">,</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">device_index</span><span class="o">=</span><span class="n">device_index</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="n">compute_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compute_type</span><span class="p">,</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="p">)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">extra_lang</span> <span class="o">=</span> <span class="n">extra_languages</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">extra_lang_models</span> <span class="o">=</span> <span class="n">extra_languages_model_paths</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="n">audio</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="n">TensorShare</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="n">List</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="n">List</span><span class="p">[</span><span class="n">TensorShare</span><span class="p">],</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="p">],</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="n">source_lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="n">model_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="n">suppress_blank</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">vocab</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="n">word_timestamps</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="n">internal_vad</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="n">repetition_penalty</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="n">compression_ratio_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.4</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">log_prob_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="n">no_speech_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="n">condition_on_previous_text</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">TranscriptionOutput</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">TranscriptionOutput</span><span class="p">]]:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        Run inference with the transcribe model.</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">            audio (Union[str, torch.Tensor, TensorShare, List[str], List[torch.Tensor], List[TensorShare]]):</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">                Audio file path or audio tensor. If a tuple is passed, the task is assumed</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">                to be a multi_channel task and the list of audio files or tensors is passed.</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">            source_lang (str):</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">                Language of the audio file.</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">            model_index (int):</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">                Index of the model to use.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">            suppress_blank (bool):</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">                Whether to suppress blank at the beginning of the sampling.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">            vocab (Union[List[str], None]):</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">                Vocabulary to use during generation if not None. Defaults to None.</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">            word_timestamps (bool):</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">                Whether to return word timestamps.</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">            internal_vad (bool):</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">                Whether to use faster-whisper&#39;s VAD or not.</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">            repetition_penalty (float):</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">                Repetition penalty to use during generation beamed search.</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">            compression_ratio_threshold (float):</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">                If the gzip compression ratio is above this value, treat as failed.</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">            log_prob_threshold (float):</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">                If the average log probability over sampled tokens is below this value, treat as failed.</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">            no_speech_threshold (float):</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">                If the no_speech probability is higher than this value AND the average log probability</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">                over sampled tokens is below `log_prob_threshold`, consider the segment as silent.</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">            condition_on_previous_text (bool):</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">                If True, the previous output of the model is provided as a prompt for the next window;</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">                disabling may make the text inconsistent across windows, but the model becomes less prone</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">                to getting stuck in a failure loop, such as repetition looping or timestamps going out of sync.</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">            Union[TranscriptionOutput, List[TranscriptionOutput]]:</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">                Transcription output. If the task is a multi_channel task, a list of TranscriptionOutput is returned.</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="c1"># Extra language models are disabled until we can handle an index mapping</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="c1"># if (</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="c1">#     source_lang in self.extra_lang</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="c1">#     and self.models[model_index].lang != source_lang</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="c1"># ):</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="c1">#     logger.debug(f&quot;Loading model for language {source_lang} on GPU {model_index}.&quot;)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="c1">#     self.models[model_index] = FasterWhisperModel(</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="c1">#         model=WhisperModel(</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="c1">#             self.extra_lang_models[source_lang],</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="c1">#             device=self.device,</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="c1">#             device_index=model_index,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="c1">#             compute_type=self.compute_type,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="c1">#         ),</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="c1">#         lang=source_lang,</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="c1">#     )</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="c1">#     self.loaded_model_lang = source_lang</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="c1"># elif source_lang not in self.extra_lang and self.models[model_index].lang != &quot;multi&quot;:</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="c1">#     logger.debug(f&quot;Re-loading multi-language model on GPU {model_index}.&quot;)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="c1">#     self.models[model_index] = FasterWhisperModel(</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="c1">#         model=WhisperModel(</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="c1">#             self.model_path,</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="c1">#             device=self.device,</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="c1">#             device_index=model_index,</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="c1">#             compute_type=self.compute_type,</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="c1">#         ),</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="c1">#         lang=source_lang,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="c1">#     )</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="n">vocab</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vocab</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>            <span class="ow">and</span> <span class="n">vocab</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="p">):</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="n">words</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Vocab: </span><span class="si">{</span><span class="n">words</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="n">prompt</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>                <span class="n">audio</span> <span class="o">=</span> <span class="n">audio</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">TensorShare</span><span class="p">):</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>                <span class="n">ts</span> <span class="o">=</span> <span class="n">audio</span><span class="o">.</span><span class="n">to_tensors</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">Backend</span><span class="o">.</span><span class="n">NUMPY</span><span class="p">)</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>                <span class="n">audio</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="s2">&quot;audio&quot;</span><span class="p">]</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="n">segments</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>                <span class="n">audio</span><span class="p">,</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>                <span class="n">language</span><span class="o">=</span><span class="n">source_lang</span><span class="p">,</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>                <span class="n">initial_prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>                <span class="n">repetition_penalty</span><span class="o">=</span><span class="n">repetition_penalty</span><span class="p">,</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>                <span class="n">compression_ratio_threshold</span><span class="o">=</span><span class="n">compression_ratio_threshold</span><span class="p">,</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>                <span class="n">log_prob_threshold</span><span class="o">=</span><span class="n">log_prob_threshold</span><span class="p">,</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>                <span class="n">no_speech_threshold</span><span class="o">=</span><span class="n">no_speech_threshold</span><span class="p">,</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>                <span class="n">condition_on_previous_text</span><span class="o">=</span><span class="n">condition_on_previous_text</span><span class="p">,</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>                <span class="n">suppress_blank</span><span class="o">=</span><span class="n">suppress_blank</span><span class="p">,</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                <span class="n">word_timestamps</span><span class="o">=</span><span class="n">word_timestamps</span><span class="p">,</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>                <span class="n">vad_filter</span><span class="o">=</span><span class="n">internal_vad</span><span class="p">,</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>                <span class="n">vad_parameters</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                    <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>                    <span class="s2">&quot;min_speech_duration_ms&quot;</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>                    <span class="s2">&quot;min_silence_duration_ms&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                    <span class="s2">&quot;speech_pad_ms&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                    <span class="s2">&quot;window_size_samples&quot;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>                <span class="p">},</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="p">)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>            <span class="n">segments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">segments</span><span class="p">:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>                    <span class="s2">&quot;Empty transcription result. Trying with vad_filter=True.&quot;</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>                <span class="p">)</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>                <span class="n">segments</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>                    <span class="n">audio</span><span class="p">,</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>                    <span class="n">language</span><span class="o">=</span><span class="n">source_lang</span><span class="p">,</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>                    <span class="n">initial_prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>                    <span class="n">repetition_penalty</span><span class="o">=</span><span class="n">repetition_penalty</span><span class="p">,</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>                    <span class="n">compression_ratio_threshold</span><span class="o">=</span><span class="n">compression_ratio_threshold</span><span class="p">,</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>                    <span class="n">log_prob_threshold</span><span class="o">=</span><span class="n">log_prob_threshold</span><span class="p">,</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>                    <span class="n">no_speech_threshold</span><span class="o">=</span><span class="n">no_speech_threshold</span><span class="p">,</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>                    <span class="n">condition_on_previous_text</span><span class="o">=</span><span class="n">condition_on_previous_text</span><span class="p">,</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>                    <span class="n">suppress_blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                    <span class="n">word_timestamps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>                    <span class="n">vad_filter</span><span class="o">=</span><span class="kc">False</span> <span class="k">if</span> <span class="n">internal_vad</span> <span class="k">else</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>                <span class="p">)</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>            <span class="n">_outputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">segment</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span> <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">]</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>            <span class="n">outputs</span> <span class="o">=</span> <span class="n">TranscriptionOutput</span><span class="p">(</span><span class="n">segments</span><span class="o">=</span><span class="n">_outputs</span><span class="p">)</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="k">for</span> <span class="n">audio_index</span><span class="p">,</span> <span class="n">audio_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">audio</span><span class="p">):</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>                <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">multi_channel</span><span class="p">(</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>                        <span class="n">audio_file</span><span class="p">,</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>                        <span class="n">source_lang</span><span class="o">=</span><span class="n">source_lang</span><span class="p">,</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>                        <span class="n">speaker_id</span><span class="o">=</span><span class="n">audio_index</span><span class="p">,</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>                        <span class="n">suppress_blank</span><span class="o">=</span><span class="n">suppress_blank</span><span class="p">,</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>                        <span class="n">word_timestamps</span><span class="o">=</span><span class="n">word_timestamps</span><span class="p">,</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>                        <span class="n">internal_vad</span><span class="o">=</span><span class="n">internal_vad</span><span class="p">,</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>                        <span class="n">repetition_penalty</span><span class="o">=</span><span class="n">repetition_penalty</span><span class="p">,</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>                        <span class="n">compression_ratio_threshold</span><span class="o">=</span><span class="n">compression_ratio_threshold</span><span class="p">,</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>                        <span class="n">log_prob_threshold</span><span class="o">=</span><span class="n">log_prob_threshold</span><span class="p">,</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>                        <span class="n">no_speech_threshold</span><span class="o">=</span><span class="n">no_speech_threshold</span><span class="p">,</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>                        <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>                    <span class="p">)</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>                <span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="k">return</span> <span class="n">outputs</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">async_live_transcribe</span><span class="p">(</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="n">audio</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="n">source_lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="n">model_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Async generator for live transcriptions.</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">        This method wraps the live_transcribe method to make it async.</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">            audio (torch.Tensor): Audio tensor.</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">            source_lang (str): Language of the audio file.</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">            model_index (int): Index of the model to use.</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">        Yields:</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">            Iterable[dict]: Iterable of transcribed segments.</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">live_transcribe</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">source_lang</span><span class="p">,</span> <span class="n">model_index</span><span class="p">):</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="k">yield</span> <span class="n">result</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="k">def</span> <span class="nf">live_transcribe</span><span class="p">(</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="n">audio</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="n">source_lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>        <span class="n">model_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">        Transcribe audio from a WebSocket connection.</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">            audio (torch.Tensor): Audio tensor.</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">            source_lang (str): Language of the audio file.</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">            model_index (int): Index of the model to use.</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">        Yields:</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">            Iterable[dict]: Iterable of transcribed segments.</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="n">segments</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="n">audio</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>            <span class="n">language</span><span class="o">=</span><span class="n">source_lang</span><span class="p">,</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>            <span class="n">suppress_blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>            <span class="n">word_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="p">)</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>            <span class="k">yield</span> <span class="n">segment</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>    <span class="k">def</span> <span class="nf">multi_channel</span><span class="p">(</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="n">audio</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">TensorShare</span><span class="p">],</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="n">source_lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="n">speaker_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="n">suppress_blank</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="n">word_timestamps</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="n">internal_vad</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="n">repetition_penalty</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>        <span class="n">compression_ratio_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.4</span><span class="p">,</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="n">log_prob_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="n">no_speech_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="n">condition_on_previous_text</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="n">prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MultiChannelTranscriptionOutput</span><span class="p">:</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">        Transcribe an audio file using the faster-whisper original pipeline.</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">            audio (Union[str, torch.Tensor, TensorShare]): Audio file path or loaded audio.</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">            source_lang (str): Language of the audio file.</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">            speaker_id (int): Speaker ID used in the diarization.</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">            suppress_blank (bool):</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">                Whether to suppress blank at the beginning of the sampling.</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">            word_timestamps (bool):</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">                Whether to return word timestamps.</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">            internal_vad (bool):</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">                Whether to use faster-whisper&#39;s VAD or not.</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">            repetition_penalty (float):</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">                Repetition penalty to use during generation beamed search.</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">            compression_ratio_threshold (float):</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">                If the gzip compression ratio is above this value, treat as failed.</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">            log_prob_threshold (float):</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">                If the average log probability over sampled tokens is below this value, treat as failed.</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">            no_speech_threshold (float):</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">                If the no_speech probability is higher than this value AND the average log probability</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">                over sampled tokens is below `log_prob_threshold`, consider the segment as silent.</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">            condition_on_previous_text (bool):</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">                If True, the previous output of the model is provided as a prompt for the next window;</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">                disabling may make the text inconsistent across windows, but the model becomes less prone</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">                to getting stuck in a failure loop, such as repetition looping or timestamps going out of sync.</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">            prompt (Optional[str]): Initial prompt to use for the generation.</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">            MultiChannelTranscriptionOutput: Multi-channel transcription segments in a list.</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>            <span class="n">_audio</span> <span class="o">=</span> <span class="n">audio</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">TensorShare</span><span class="p">):</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>            <span class="n">ts</span> <span class="o">=</span> <span class="n">audio</span><span class="o">.</span><span class="n">to_tensors</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">Backend</span><span class="o">.</span><span class="n">NUMPY</span><span class="p">)</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>            <span class="n">_audio</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="s2">&quot;audio&quot;</span><span class="p">]</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="n">final_segments</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="n">segments</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="n">_audio</span><span class="p">,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>            <span class="n">language</span><span class="o">=</span><span class="n">source_lang</span><span class="p">,</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>            <span class="n">initial_prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="n">repetition_penalty</span><span class="o">=</span><span class="n">repetition_penalty</span><span class="p">,</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="n">compression_ratio_threshold</span><span class="o">=</span><span class="n">compression_ratio_threshold</span><span class="p">,</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>            <span class="n">log_prob_threshold</span><span class="o">=</span><span class="n">log_prob_threshold</span><span class="p">,</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>            <span class="n">no_speech_threshold</span><span class="o">=</span><span class="n">no_speech_threshold</span><span class="p">,</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>            <span class="n">condition_on_previous_text</span><span class="o">=</span><span class="n">condition_on_previous_text</span><span class="p">,</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>            <span class="n">suppress_blank</span><span class="o">=</span><span class="n">suppress_blank</span><span class="p">,</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>            <span class="n">word_timestamps</span><span class="o">=</span><span class="n">word_timestamps</span><span class="p">,</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>            <span class="n">vad_filter</span><span class="o">=</span><span class="n">internal_vad</span><span class="p">,</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>            <span class="n">vad_parameters</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>                <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>                <span class="s2">&quot;min_speech_duration_ms&quot;</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>                <span class="s2">&quot;min_silence_duration_ms&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>                <span class="s2">&quot;speech_pad_ms&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>                <span class="s2">&quot;window_size_samples&quot;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>            <span class="p">},</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>        <span class="p">)</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>            <span class="n">_segment</span> <span class="o">=</span> <span class="n">MultiChannelSegment</span><span class="p">(</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>                <span class="n">start</span><span class="o">=</span><span class="n">segment</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>                <span class="n">end</span><span class="o">=</span><span class="n">segment</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>                <span class="n">text</span><span class="o">=</span><span class="n">segment</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>                <span class="n">words</span><span class="o">=</span><span class="p">[</span><span class="n">Word</span><span class="p">(</span><span class="o">**</span><span class="n">word</span><span class="o">.</span><span class="n">_asdict</span><span class="p">())</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">segment</span><span class="o">.</span><span class="n">words</span><span class="p">],</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>                <span class="n">speaker</span><span class="o">=</span><span class="n">speaker_id</span><span class="p">,</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>            <span class="p">)</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>            <span class="n">final_segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_segment</span><span class="p">)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>        <span class="k">return</span> <span class="n">MultiChannelTranscriptionOutput</span><span class="p">(</span><span class="n">segments</span><span class="o">=</span><span class="n">final_segments</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.transcribe_service.TranscribeService.__call__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">source_lang</span><span class="p">,</span> <span class="n">model_index</span><span class="p">,</span> <span class="n">suppress_blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vocab</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">word_timestamps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">internal_vad</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">repetition_penalty</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">compression_ratio_threshold</span><span class="o">=</span><span class="mf">2.4</span><span class="p">,</span> <span class="n">log_prob_threshold</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">no_speech_threshold</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">condition_on_previous_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Run inference with the transcribe model.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>audio</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[str, <span title="torch.Tensor">Tensor</span>, <span title="tensorshare.TensorShare">TensorShare</span>, <span title="typing.List">List</span>[str], <span title="typing.List">List</span>[<span title="torch.Tensor">Tensor</span>], <span title="typing.List">List</span>[<span title="tensorshare.TensorShare">TensorShare</span>]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Audio file path or audio tensor. If a tuple is passed, the task is assumed
to be a multi_channel task and the list of audio files or tensors is passed.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>source_lang</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Language of the audio file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model_index</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Index of the model to use.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>suppress_blank</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to suppress blank at the beginning of the sampling.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>vocab</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[str], None]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Vocabulary to use during generation if not None. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>word_timestamps</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to return word timestamps.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>internal_vad</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to use faster-whisper's VAD or not.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>repetition_penalty</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Repetition penalty to use during generation beamed search.</p>
            </div>
          </td>
          <td>
                <code>1.0</code>
          </td>
        </tr>
        <tr>
          <td><code>compression_ratio_threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the gzip compression ratio is above this value, treat as failed.</p>
            </div>
          </td>
          <td>
                <code>2.4</code>
          </td>
        </tr>
        <tr>
          <td><code>log_prob_threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the average log probability over sampled tokens is below this value, treat as failed.</p>
            </div>
          </td>
          <td>
                <code>-1.0</code>
          </td>
        </tr>
        <tr>
          <td><code>no_speech_threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the no_speech probability is higher than this value AND the average log probability
over sampled tokens is below <code>log_prob_threshold</code>, consider the segment as silent.</p>
            </div>
          </td>
          <td>
                <code>0.6</code>
          </td>
        </tr>
        <tr>
          <td><code>condition_on_previous_text</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, the previous output of the model is provided as a prompt for the next window;
disabling may make the text inconsistent across windows, but the model becomes less prone
to getting stuck in a failure loop, such as repetition looping or timestamps going out of sync.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="wordcab_transcribe.models.TranscriptionOutput">TranscriptionOutput</span>, <span title="typing.List">List</span>[<span title="wordcab_transcribe.models.TranscriptionOutput">TranscriptionOutput</span>]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Union[TranscriptionOutput, List[TranscriptionOutput]]:
Transcription output. If the task is a multi_channel task, a list of TranscriptionOutput is returned.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/transcribe_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="n">audio</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="n">TensorShare</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="n">List</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="n">List</span><span class="p">[</span><span class="n">TensorShare</span><span class="p">],</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="p">],</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="n">source_lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">model_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="n">suppress_blank</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">vocab</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="n">word_timestamps</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="n">internal_vad</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="n">repetition_penalty</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="n">compression_ratio_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.4</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="n">log_prob_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="n">no_speech_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="n">condition_on_previous_text</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">TranscriptionOutput</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">TranscriptionOutput</span><span class="p">]]:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    Run inference with the transcribe model.</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        audio (Union[str, torch.Tensor, TensorShare, List[str], List[torch.Tensor], List[TensorShare]]):</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">            Audio file path or audio tensor. If a tuple is passed, the task is assumed</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">            to be a multi_channel task and the list of audio files or tensors is passed.</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        source_lang (str):</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">            Language of the audio file.</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        model_index (int):</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">            Index of the model to use.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        suppress_blank (bool):</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">            Whether to suppress blank at the beginning of the sampling.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        vocab (Union[List[str], None]):</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">            Vocabulary to use during generation if not None. Defaults to None.</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        word_timestamps (bool):</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">            Whether to return word timestamps.</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">        internal_vad (bool):</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">            Whether to use faster-whisper&#39;s VAD or not.</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        repetition_penalty (float):</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">            Repetition penalty to use during generation beamed search.</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        compression_ratio_threshold (float):</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">            If the gzip compression ratio is above this value, treat as failed.</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        log_prob_threshold (float):</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">            If the average log probability over sampled tokens is below this value, treat as failed.</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        no_speech_threshold (float):</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">            If the no_speech probability is higher than this value AND the average log probability</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">            over sampled tokens is below `log_prob_threshold`, consider the segment as silent.</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        condition_on_previous_text (bool):</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">            If True, the previous output of the model is provided as a prompt for the next window;</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">            disabling may make the text inconsistent across windows, but the model becomes less prone</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">            to getting stuck in a failure loop, such as repetition looping or timestamps going out of sync.</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        Union[TranscriptionOutput, List[TranscriptionOutput]]:</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">            Transcription output. If the task is a multi_channel task, a list of TranscriptionOutput is returned.</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="c1"># Extra language models are disabled until we can handle an index mapping</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="c1"># if (</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="c1">#     source_lang in self.extra_lang</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="c1">#     and self.models[model_index].lang != source_lang</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="c1"># ):</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="c1">#     logger.debug(f&quot;Loading model for language {source_lang} on GPU {model_index}.&quot;)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="c1">#     self.models[model_index] = FasterWhisperModel(</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="c1">#         model=WhisperModel(</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="c1">#             self.extra_lang_models[source_lang],</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="c1">#             device=self.device,</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>    <span class="c1">#             device_index=model_index,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="c1">#             compute_type=self.compute_type,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="c1">#         ),</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="c1">#         lang=source_lang,</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>    <span class="c1">#     )</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="c1">#     self.loaded_model_lang = source_lang</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="c1"># elif source_lang not in self.extra_lang and self.models[model_index].lang != &quot;multi&quot;:</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="c1">#     logger.debug(f&quot;Re-loading multi-language model on GPU {model_index}.&quot;)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="c1">#     self.models[model_index] = FasterWhisperModel(</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="c1">#         model=WhisperModel(</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="c1">#             self.model_path,</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="c1">#             device=self.device,</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="c1">#             device_index=model_index,</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="c1">#             compute_type=self.compute_type,</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="c1">#         ),</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="c1">#         lang=source_lang,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="c1">#     )</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="n">vocab</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vocab</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="ow">and</span> <span class="n">vocab</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="p">):</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="n">words</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Vocab: </span><span class="si">{</span><span class="n">words</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="n">prompt</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>            <span class="n">audio</span> <span class="o">=</span> <span class="n">audio</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">TensorShare</span><span class="p">):</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="n">ts</span> <span class="o">=</span> <span class="n">audio</span><span class="o">.</span><span class="n">to_tensors</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">Backend</span><span class="o">.</span><span class="n">NUMPY</span><span class="p">)</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>            <span class="n">audio</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="s2">&quot;audio&quot;</span><span class="p">]</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="n">segments</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>            <span class="n">audio</span><span class="p">,</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="n">language</span><span class="o">=</span><span class="n">source_lang</span><span class="p">,</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>            <span class="n">initial_prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>            <span class="n">repetition_penalty</span><span class="o">=</span><span class="n">repetition_penalty</span><span class="p">,</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="n">compression_ratio_threshold</span><span class="o">=</span><span class="n">compression_ratio_threshold</span><span class="p">,</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>            <span class="n">log_prob_threshold</span><span class="o">=</span><span class="n">log_prob_threshold</span><span class="p">,</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="n">no_speech_threshold</span><span class="o">=</span><span class="n">no_speech_threshold</span><span class="p">,</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="n">condition_on_previous_text</span><span class="o">=</span><span class="n">condition_on_previous_text</span><span class="p">,</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>            <span class="n">suppress_blank</span><span class="o">=</span><span class="n">suppress_blank</span><span class="p">,</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="n">word_timestamps</span><span class="o">=</span><span class="n">word_timestamps</span><span class="p">,</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="n">vad_filter</span><span class="o">=</span><span class="n">internal_vad</span><span class="p">,</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="n">vad_parameters</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>                <span class="s2">&quot;min_speech_duration_ms&quot;</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>                <span class="s2">&quot;min_silence_duration_ms&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                <span class="s2">&quot;speech_pad_ms&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                <span class="s2">&quot;window_size_samples&quot;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="p">},</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="p">)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="n">segments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">segments</span><span class="p">:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>                <span class="s2">&quot;Empty transcription result. Trying with vad_filter=True.&quot;</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>            <span class="p">)</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="n">segments</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>                <span class="n">audio</span><span class="p">,</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>                <span class="n">language</span><span class="o">=</span><span class="n">source_lang</span><span class="p">,</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>                <span class="n">initial_prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>                <span class="n">repetition_penalty</span><span class="o">=</span><span class="n">repetition_penalty</span><span class="p">,</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>                <span class="n">compression_ratio_threshold</span><span class="o">=</span><span class="n">compression_ratio_threshold</span><span class="p">,</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>                <span class="n">log_prob_threshold</span><span class="o">=</span><span class="n">log_prob_threshold</span><span class="p">,</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>                <span class="n">no_speech_threshold</span><span class="o">=</span><span class="n">no_speech_threshold</span><span class="p">,</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>                <span class="n">condition_on_previous_text</span><span class="o">=</span><span class="n">condition_on_previous_text</span><span class="p">,</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>                <span class="n">suppress_blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                <span class="n">word_timestamps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>                <span class="n">vad_filter</span><span class="o">=</span><span class="kc">False</span> <span class="k">if</span> <span class="n">internal_vad</span> <span class="k">else</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="p">)</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="n">_outputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">segment</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span> <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">]</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="n">outputs</span> <span class="o">=</span> <span class="n">TranscriptionOutput</span><span class="p">(</span><span class="n">segments</span><span class="o">=</span><span class="n">_outputs</span><span class="p">)</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="k">for</span> <span class="n">audio_index</span><span class="p">,</span> <span class="n">audio_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">audio</span><span class="p">):</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>            <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">multi_channel</span><span class="p">(</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>                    <span class="n">audio_file</span><span class="p">,</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>                    <span class="n">source_lang</span><span class="o">=</span><span class="n">source_lang</span><span class="p">,</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>                    <span class="n">speaker_id</span><span class="o">=</span><span class="n">audio_index</span><span class="p">,</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>                    <span class="n">suppress_blank</span><span class="o">=</span><span class="n">suppress_blank</span><span class="p">,</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>                    <span class="n">word_timestamps</span><span class="o">=</span><span class="n">word_timestamps</span><span class="p">,</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>                    <span class="n">internal_vad</span><span class="o">=</span><span class="n">internal_vad</span><span class="p">,</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>                    <span class="n">repetition_penalty</span><span class="o">=</span><span class="n">repetition_penalty</span><span class="p">,</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>                    <span class="n">compression_ratio_threshold</span><span class="o">=</span><span class="n">compression_ratio_threshold</span><span class="p">,</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>                    <span class="n">log_prob_threshold</span><span class="o">=</span><span class="n">log_prob_threshold</span><span class="p">,</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>                    <span class="n">no_speech_threshold</span><span class="o">=</span><span class="n">no_speech_threshold</span><span class="p">,</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>                    <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>                <span class="p">)</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="k">return</span> <span class="n">outputs</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.transcribe_service.TranscribeService.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="n">compute_type</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">device_index</span><span class="p">,</span> <span class="n">extra_languages</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extra_languages_model_paths</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize the Transcribe Service.</p>
<p>This service uses the WhisperModel from faster-whisper to transcribe audio files.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Path to the model checkpoint. This can be a local path or a URL.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>compute_type</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Compute type to use for inference. Can be "int8", "int8_float16", "int16" or "float_16".</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>device</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Device to use for inference. Can be "cpu" or "cuda".</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>device_index</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, <span title="typing.List">List</span>[int]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Index of the device to use for inference.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>extra_languages</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[str], None]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of extra languages to transcribe. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>extra_languages_model_paths</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[str], None]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of paths to the extra language models. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/transcribe_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="n">model_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="n">compute_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="n">device_index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="n">extra_languages</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="n">extra_languages_model_paths</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the Transcribe Service.</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    This service uses the WhisperModel from faster-whisper to transcribe audio files.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        model_path (str):</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">            Path to the model checkpoint. This can be a local path or a URL.</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        compute_type (str):</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">            Compute type to use for inference. Can be &quot;int8&quot;, &quot;int8_float16&quot;, &quot;int16&quot; or &quot;float_16&quot;.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        device (str):</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">            Device to use for inference. Can be &quot;cpu&quot; or &quot;cuda&quot;.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        device_index (Union[int, List[int]]):</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">            Index of the device to use for inference.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        extra_languages (Union[List[str], None]):</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">            List of extra languages to transcribe. Defaults to None.</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        extra_languages_model_paths (Union[List[str], None]):</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">            List of paths to the extra language models. Defaults to None.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">compute_type</span> <span class="o">=</span> <span class="n">compute_type</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span> <span class="o">=</span> <span class="n">model_path</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">WhisperModel</span><span class="p">(</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">,</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="n">device_index</span><span class="o">=</span><span class="n">device_index</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="n">compute_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compute_type</span><span class="p">,</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="p">)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">extra_lang</span> <span class="o">=</span> <span class="n">extra_languages</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">extra_lang_models</span> <span class="o">=</span> <span class="n">extra_languages_model_paths</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.transcribe_service.TranscribeService.async_live_transcribe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">async_live_transcribe</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">source_lang</span><span class="p">,</span> <span class="n">model_index</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Async generator for live transcriptions.</p>
<p>This method wraps the live_transcribe method to make it async.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>audio</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Audio tensor.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>source_lang</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Language of the audio file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model_index</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Index of the model to use.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Yields:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Iterable">Iterable</span>[dict]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Iterable[dict]: Iterable of transcribed segments.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/transcribe_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">async_live_transcribe</span><span class="p">(</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>    <span class="n">audio</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="n">source_lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="n">model_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Async generator for live transcriptions.</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">    This method wraps the live_transcribe method to make it async.</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">        audio (torch.Tensor): Audio tensor.</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">        source_lang (str): Language of the audio file.</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">        model_index (int): Index of the model to use.</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">    Yields:</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">        Iterable[dict]: Iterable of transcribed segments.</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">live_transcribe</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">source_lang</span><span class="p">,</span> <span class="n">model_index</span><span class="p">):</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="k">yield</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.transcribe_service.TranscribeService.live_transcribe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">live_transcribe</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">source_lang</span><span class="p">,</span> <span class="n">model_index</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Transcribe audio from a WebSocket connection.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>audio</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Audio tensor.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>source_lang</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Language of the audio file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model_index</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Index of the model to use.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Yields:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Iterable">Iterable</span>[dict]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Iterable[dict]: Iterable of transcribed segments.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/transcribe_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="k">def</span> <span class="nf">live_transcribe</span><span class="p">(</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="n">audio</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>    <span class="n">source_lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="n">model_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">    Transcribe audio from a WebSocket connection.</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">        audio (torch.Tensor): Audio tensor.</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">        source_lang (str): Language of the audio file.</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">        model_index (int): Index of the model to use.</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">    Yields:</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">        Iterable[dict]: Iterable of transcribed segments.</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="n">segments</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="n">audio</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="n">language</span><span class="o">=</span><span class="n">source_lang</span><span class="p">,</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="n">suppress_blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="n">word_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="p">)</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>    <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="k">yield</span> <span class="n">segment</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.transcribe_service.TranscribeService.multi_channel" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">multi_channel</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">source_lang</span><span class="p">,</span> <span class="n">speaker_id</span><span class="p">,</span> <span class="n">suppress_blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">word_timestamps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">internal_vad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">repetition_penalty</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">compression_ratio_threshold</span><span class="o">=</span><span class="mf">2.4</span><span class="p">,</span> <span class="n">log_prob_threshold</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">no_speech_threshold</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">condition_on_previous_text</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Transcribe an audio file using the faster-whisper original pipeline.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>audio</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[str, <span title="torch.Tensor">Tensor</span>, <span title="tensorshare.TensorShare">TensorShare</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Audio file path or loaded audio.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>source_lang</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Language of the audio file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>speaker_id</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Speaker ID used in the diarization.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>suppress_blank</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to suppress blank at the beginning of the sampling.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>word_timestamps</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to return word timestamps.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>internal_vad</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to use faster-whisper's VAD or not.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>repetition_penalty</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Repetition penalty to use during generation beamed search.</p>
            </div>
          </td>
          <td>
                <code>1.0</code>
          </td>
        </tr>
        <tr>
          <td><code>compression_ratio_threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the gzip compression ratio is above this value, treat as failed.</p>
            </div>
          </td>
          <td>
                <code>2.4</code>
          </td>
        </tr>
        <tr>
          <td><code>log_prob_threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the average log probability over sampled tokens is below this value, treat as failed.</p>
            </div>
          </td>
          <td>
                <code>-1.0</code>
          </td>
        </tr>
        <tr>
          <td><code>no_speech_threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the no_speech probability is higher than this value AND the average log probability
over sampled tokens is below <code>log_prob_threshold</code>, consider the segment as silent.</p>
            </div>
          </td>
          <td>
                <code>0.6</code>
          </td>
        </tr>
        <tr>
          <td><code>condition_on_previous_text</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, the previous output of the model is provided as a prompt for the next window;
disabling may make the text inconsistent across windows, but the model becomes less prone
to getting stuck in a failure loop, such as repetition looping or timestamps going out of sync.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>prompt</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Initial prompt to use for the generation.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>MultiChannelTranscriptionOutput</code></td>          <td>
                <code><span title="wordcab_transcribe.models.MultiChannelTranscriptionOutput">MultiChannelTranscriptionOutput</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Multi-channel transcription segments in a list.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/transcribe_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="k">def</span> <span class="nf">multi_channel</span><span class="p">(</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>    <span class="n">audio</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">TensorShare</span><span class="p">],</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>    <span class="n">source_lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="n">speaker_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="n">suppress_blank</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>    <span class="n">word_timestamps</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>    <span class="n">internal_vad</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="n">repetition_penalty</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>    <span class="n">compression_ratio_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.4</span><span class="p">,</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>    <span class="n">log_prob_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>    <span class="n">no_speech_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>    <span class="n">condition_on_previous_text</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>    <span class="n">prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MultiChannelTranscriptionOutput</span><span class="p">:</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">    Transcribe an audio file using the faster-whisper original pipeline.</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">        audio (Union[str, torch.Tensor, TensorShare]): Audio file path or loaded audio.</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">        source_lang (str): Language of the audio file.</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">        speaker_id (int): Speaker ID used in the diarization.</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">        suppress_blank (bool):</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">            Whether to suppress blank at the beginning of the sampling.</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">        word_timestamps (bool):</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">            Whether to return word timestamps.</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">        internal_vad (bool):</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">            Whether to use faster-whisper&#39;s VAD or not.</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">        repetition_penalty (float):</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">            Repetition penalty to use during generation beamed search.</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">        compression_ratio_threshold (float):</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">            If the gzip compression ratio is above this value, treat as failed.</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">        log_prob_threshold (float):</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">            If the average log probability over sampled tokens is below this value, treat as failed.</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">        no_speech_threshold (float):</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">            If the no_speech probability is higher than this value AND the average log probability</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">            over sampled tokens is below `log_prob_threshold`, consider the segment as silent.</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">        condition_on_previous_text (bool):</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">            If True, the previous output of the model is provided as a prompt for the next window;</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">            disabling may make the text inconsistent across windows, but the model becomes less prone</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">            to getting stuck in a failure loop, such as repetition looping or timestamps going out of sync.</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">        prompt (Optional[str]): Initial prompt to use for the generation.</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">        MultiChannelTranscriptionOutput: Multi-channel transcription segments in a list.</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="n">_audio</span> <span class="o">=</span> <span class="n">audio</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">TensorShare</span><span class="p">):</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">audio</span><span class="o">.</span><span class="n">to_tensors</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">Backend</span><span class="o">.</span><span class="n">NUMPY</span><span class="p">)</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="n">_audio</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="s2">&quot;audio&quot;</span><span class="p">]</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>    <span class="n">final_segments</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>    <span class="n">segments</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="n">_audio</span><span class="p">,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>        <span class="n">language</span><span class="o">=</span><span class="n">source_lang</span><span class="p">,</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>        <span class="n">initial_prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="n">repetition_penalty</span><span class="o">=</span><span class="n">repetition_penalty</span><span class="p">,</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>        <span class="n">compression_ratio_threshold</span><span class="o">=</span><span class="n">compression_ratio_threshold</span><span class="p">,</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="n">log_prob_threshold</span><span class="o">=</span><span class="n">log_prob_threshold</span><span class="p">,</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="n">no_speech_threshold</span><span class="o">=</span><span class="n">no_speech_threshold</span><span class="p">,</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="n">condition_on_previous_text</span><span class="o">=</span><span class="n">condition_on_previous_text</span><span class="p">,</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="n">suppress_blank</span><span class="o">=</span><span class="n">suppress_blank</span><span class="p">,</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="n">word_timestamps</span><span class="o">=</span><span class="n">word_timestamps</span><span class="p">,</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="n">vad_filter</span><span class="o">=</span><span class="n">internal_vad</span><span class="p">,</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="n">vad_parameters</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>            <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>            <span class="s2">&quot;min_speech_duration_ms&quot;</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>            <span class="s2">&quot;min_silence_duration_ms&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>            <span class="s2">&quot;speech_pad_ms&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>            <span class="s2">&quot;window_size_samples&quot;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>        <span class="p">},</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>    <span class="p">)</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>    <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="n">_segment</span> <span class="o">=</span> <span class="n">MultiChannelSegment</span><span class="p">(</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>            <span class="n">start</span><span class="o">=</span><span class="n">segment</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>            <span class="n">end</span><span class="o">=</span><span class="n">segment</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>            <span class="n">text</span><span class="o">=</span><span class="n">segment</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>            <span class="n">words</span><span class="o">=</span><span class="p">[</span><span class="n">Word</span><span class="p">(</span><span class="o">**</span><span class="n">word</span><span class="o">.</span><span class="n">_asdict</span><span class="p">())</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">segment</span><span class="o">.</span><span class="n">words</span><span class="p">],</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>            <span class="n">speaker</span><span class="o">=</span><span class="n">speaker_id</span><span class="p">,</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="p">)</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="n">final_segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_segment</span><span class="p">)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>    <span class="k">return</span> <span class="n">MultiChannelTranscriptionOutput</span><span class="p">(</span><span class="n">segments</span><span class="o">=</span><span class="n">final_segments</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">




  <div class="doc doc-contents first">
  
      <p>Voice Activation Detection (VAD) Service for audio files.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="src.wordcab_transcribe.services.vad_service.VadService" class="doc doc-heading">
          <code>VadService</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>VAD Service for audio files.</p>

            <details class="quote">
              <summary>Source code in <code>src/wordcab_transcribe/services/vad_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="k">class</span> <span class="nc">VadService</span><span class="p">:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;VAD Service for audio files.&quot;&quot;&quot;</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the VAD Service.&quot;&quot;&quot;</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sample_rate</span> <span class="o">=</span> <span class="mi">16000</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">VadOptions</span><span class="p">(</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>            <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>            <span class="n">min_speech_duration_ms</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>            <span class="n">max_speech_duration_s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>            <span class="n">min_silence_duration_ms</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>            <span class="n">window_size_samples</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>            <span class="n">speech_pad_ms</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="p">)</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">waveform</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">group_timestamps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        Use the VAD model to get the speech timestamps. Multi-channel pipeline.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">            waveform (torch.Tensor): Audio tensor.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">            group_timestamps (Optional[bool], optional): Group timestamps. Defaults to True.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">            Tuple[Union[List[dict], List[List[dict]]], torch.Tensor]: Speech timestamps and audio tensor.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="k">if</span> <span class="n">waveform</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>            <span class="n">waveform</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="n">speech_timestamps</span> <span class="o">=</span> <span class="n">get_speech_timestamps</span><span class="p">(</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="n">audio</span><span class="o">=</span><span class="n">waveform</span><span class="p">,</span> <span class="n">vad_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="p">)</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="n">_speech_timestamps_list</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>            <span class="p">{</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">ts</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">ts</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]}</span> <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">speech_timestamps</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="p">]</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="k">if</span> <span class="n">group_timestamps</span><span class="p">:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>            <span class="n">speech_timestamps_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_timestamps</span><span class="p">(</span><span class="n">_speech_timestamps_list</span><span class="p">)</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>            <span class="n">speech_timestamps_list</span> <span class="o">=</span> <span class="n">_speech_timestamps_list</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="k">return</span> <span class="n">speech_timestamps_list</span><span class="p">,</span> <span class="n">waveform</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="k">def</span> <span class="nf">group_timestamps</span><span class="p">(</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.0</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]:</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        Group timestamps based on a threshold.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">            timestamps (List[dict]): List of timestamps.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            threshold (float, optional): Threshold to use for grouping. Defaults to 3.0.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">            List[List[dict]]: List of grouped timestamps.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="n">grouped_segments</span> <span class="o">=</span> <span class="p">[[]]</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)):</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>                <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>                <span class="ow">and</span> <span class="p">(</span><span class="n">timestamps</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timestamps</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">threshold</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="p">):</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>                <span class="n">grouped_segments</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="n">grouped_segments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timestamps</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="k">return</span> <span class="n">grouped_segments</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">def</span> <span class="nf">save_audio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">audio</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        Save audio tensor to file.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">            filepath (str): Path to save the audio file.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">            audio (torch.Tensor): Audio tensor.</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="n">torchaudio</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="n">filepath</span><span class="p">,</span> <span class="n">audio</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_rate</span><span class="p">,</span> <span class="n">bits_per_sample</span><span class="o">=</span><span class="mi">16</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.vad_service.VadService.__call__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="n">group_timestamps</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Use the VAD model to get the speech timestamps. Multi-channel pipeline.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>waveform</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Audio tensor.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>group_timestamps</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[bool]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Group timestamps. Defaults to True.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Tuple">Tuple</span>[<span title="typing.Union">Union</span>[<span title="typing.List">List</span>[dict], <span title="typing.List">List</span>[<span title="typing.List">List</span>[dict]]], <span title="torch.Tensor">Tensor</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tuple[Union[List[dict], List[List[dict]]], torch.Tensor]: Speech timestamps and audio tensor.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/vad_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">waveform</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">group_timestamps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    Use the VAD model to get the speech timestamps. Multi-channel pipeline.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        waveform (torch.Tensor): Audio tensor.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        group_timestamps (Optional[bool], optional): Group timestamps. Defaults to True.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        Tuple[Union[List[dict], List[List[dict]]], torch.Tensor]: Speech timestamps and audio tensor.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="k">if</span> <span class="n">waveform</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="n">waveform</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="n">speech_timestamps</span> <span class="o">=</span> <span class="n">get_speech_timestamps</span><span class="p">(</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="n">audio</span><span class="o">=</span><span class="n">waveform</span><span class="p">,</span> <span class="n">vad_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="p">)</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="n">_speech_timestamps_list</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="p">{</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">ts</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">ts</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]}</span> <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">speech_timestamps</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="p">]</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="k">if</span> <span class="n">group_timestamps</span><span class="p">:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">speech_timestamps_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_timestamps</span><span class="p">(</span><span class="n">_speech_timestamps_list</span><span class="p">)</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="n">speech_timestamps_list</span> <span class="o">=</span> <span class="n">_speech_timestamps_list</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="k">return</span> <span class="n">speech_timestamps_list</span><span class="p">,</span> <span class="n">waveform</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.vad_service.VadService.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize the VAD Service.</p>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/vad_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the VAD Service.&quot;&quot;&quot;</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sample_rate</span> <span class="o">=</span> <span class="mi">16000</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">VadOptions</span><span class="p">(</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="n">min_speech_duration_ms</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="n">max_speech_duration_s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="n">min_silence_duration_ms</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="n">window_size_samples</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="n">speech_pad_ms</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.vad_service.VadService.group_timestamps" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">group_timestamps</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Group timestamps based on a threshold.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>timestamps</code></td>
          <td>
                <code><span title="typing.List">List</span>[dict]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of timestamps.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Threshold to use for grouping. Defaults to 3.0.</p>
            </div>
          </td>
          <td>
                <code>3.0</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[dict]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List[List[dict]]: List of grouped timestamps.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/vad_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span>
<span class="normal"><a href="#__codelineno-0-97">97</a></span>
<span class="normal"><a href="#__codelineno-0-98">98</a></span>
<span class="normal"><a href="#__codelineno-0-99">99</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="k">def</span> <span class="nf">group_timestamps</span><span class="p">(</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.0</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]:</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    Group timestamps based on a threshold.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        timestamps (List[dict]): List of timestamps.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        threshold (float, optional): Threshold to use for grouping. Defaults to 3.0.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        List[List[dict]]: List of grouped timestamps.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="n">grouped_segments</span> <span class="o">=</span> <span class="p">[[]]</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)):</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="ow">and</span> <span class="p">(</span><span class="n">timestamps</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timestamps</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">threshold</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="p">):</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="n">grouped_segments</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="n">grouped_segments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timestamps</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="k">return</span> <span class="n">grouped_segments</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="src.wordcab_transcribe.services.vad_service.VadService.save_audio" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">save_audio</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">audio</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Save audio tensor to file.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>filepath</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Path to save the audio file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>audio</code></td>
          <td>
                <code><span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Audio tensor.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/wordcab_transcribe/services/vad_service.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="k">def</span> <span class="nf">save_audio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">audio</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    Save audio tensor to file.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        filepath (str): Path to save the audio file.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        audio (torch.Tensor): Audio tensor.</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="n">torchaudio</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="n">filepath</span><span class="p">,</span> <span class="n">audio</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_rate</span><span class="p">,</span> <span class="n">bits_per_sample</span><span class="o">=</span><span class="mi">16</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2023-10-12T12:17:23+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2023-10-12</span>
      
        <br>
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2023-10-12T12:17:23+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2023-10-12</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright (c) 2023-present Wordcab <info@wordcab.com>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/wordcab" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/Wordcab" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/wordcab" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.tabs.link"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.aecac24b.min.js"></script>
      
        <script src="../../js/timeago.min.js"></script>
      
        <script src="../../js/timeago_mkdocs_material.js"></script>
      
    
  </body>
</html>